"use strict";exports.id=467,exports.ids=[467],exports.modules={2006:(e,a,t)=>{t.d(a,{ZP:()=>m,cancelProjectInvitation:()=>c,qx:()=>o});var s=t(4099);let r=process.env.NEXT_PUBLIC_BACKEND_API_URL||"http://localhost:8000",l=s.Z.create({baseURL:r,withCredentials:!0,timeout:3e4,headers:{"Content-Type":"application/json"}});l.interceptors.request.use(e=>e,e=>Promise.reject(e)),l.interceptors.response.use(e=>e,async e=>{let a=e.config;if(e.response?.status===401&&!a._retry){a._retry=!0;try{localStorage.getItem("refresh_token")}catch(e){}}return Promise.reject(e)});let i=e=>e.response?{message:e.response.data?.message||"API 요청 중 오류가 발생했습니다.",code:e.response.data?.code,status:e.response.status,details:e.response.data}:e.request?{message:"서버에 연결할 수 없습니다. 네트워크를 확인해주세요.",status:0}:{message:e.message||"알 수 없는 오류가 발생했습니다.",status:-1},n=async e=>{try{let a=await e();if(!a.data.success)throw Error(a.data.message||"API 요청이 실패했습니다.");return a.data.result}catch(e){throw i(e)}},c=async(e,a)=>n(()=>l.delete(`/projects/invite_project/${e}`,{data:{invitation_id:a}})),d=e=>e.split("/").pop()?.split("\\").pop()||"Unknown File",o={fetchProjectList:async e=>n(async()=>{let a=new URLSearchParams;e?.query&&a.append("search",e.query),e?.status&&a.append("status",e.status),e?.manager&&a.append("manager",e.manager),e?.consumer&&a.append("consumer",e.consumer),e?.sortBy&&a.append("sort_by",e.sortBy),e?.sortOrder&&a.append("sort_order",e.sortOrder),e?.limit&&a.append("limit",e.limit.toString()),e?.offset&&a.append("offset",e.offset.toString());let t=a.toString(),s=t?`/projects/project_list?${t}`:"/projects/project_list";return l.get(s)}),fetchProject:async e=>n(()=>l.get(`/projects/detail/${e}`)),createProject:async e=>n(()=>l.post("/projects/create",e,{headers:{"Content-Type":"multipart/form-data"}})),updateProject:async(e,a)=>n(()=>l.post(`/projects/detail/${e}`,a,{headers:{"Content-Type":"multipart/form-data"}})),deleteProject:async e=>n(()=>l.delete(`/projects/detail/${e}`)),inviteProjectMember:async(e,a)=>n(()=>l.post(`/projects/invite_project/${e}`,{email:a})),cancelProjectInvitation:c,acceptProjectInvitation:async(e,a)=>n(()=>l.get(`/projects/invite/${e}/${a}`)),updateMemberRating:async(e,a,t)=>n(()=>l.post(`/projects/member/${e}/${a}`,{rating:t})),deleteProjectFile:async e=>n(()=>l.delete(`/projects/file/delete/${e}`)),uploadProjectFiles:async(e,a)=>{let t=new FormData;return a.forEach(e=>{t.append("files",e)}),t.append("project_id",e.toString()),n(()=>l.post(`/projects/upload/${e}`,t,{headers:{"Content-Type":"multipart/form-data"}}))},createProjectMemo:async(e,a,t)=>n(()=>l.post(`/projects/memo/${e}`,{content:a,date:t})),deleteProjectMemo:async e=>n(()=>l.delete(`/projects/memo/${e}`)),updateProjectDates:async(e,a)=>n(()=>l.post(`/projects/date_update/${e}`,a)),fetchProjectStatistics:async()=>n(()=>l.get("/projects/statistics")),fetchSampleFiles:async()=>n(()=>l.get("/projects/sample_files")),extractFileName:d,downloadFile:(e,a)=>{if(!e)return;let t=document.createElement("a");t.href=e,t.download=a||d(e),t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t)},createProjectFormData:(e,a,t,s)=>{let r=new FormData;return r.append("inputs",JSON.stringify(e)),r.append("process",JSON.stringify(a)),t.forEach(e=>{r.append("files",e)}),s&&r.append("members",JSON.stringify(s)),r},handleApiError:i,isProject:e=>e&&"object"==typeof e&&"number"==typeof e.id&&"string"==typeof e.name&&"string"==typeof e.description&&Array.isArray(e.files)&&Array.isArray(e.member_list),isApiError:e=>e&&"object"==typeof e&&"string"==typeof e.message&&"number"==typeof e.status},m=o},6467:(e,a,t)=>{t.d(a,{b3:()=>E,fx:()=>u,vz:()=>C,$b:()=>n,l2:()=>_});var s=t(326),r=t(7577),l=t.n(r);let i=({inputs:e,onChange:a,errors:t={},disabled:r=!1})=>{let{name:l,manager:i,consumer:n,description:c}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"part",children:[s.jsx("div",{className:"s_title",children:"프로젝트 이름"}),s.jsx("input",{type:"text",name:"name",placeholder:"프로젝트 이름",className:`ty01 mt10 ${t.name?"error":""}`,value:l,onChange:a,maxLength:50,disabled:r,"aria-label":"프로젝트 이름","aria-describedby":t.name?"name-error":void 0,"aria-invalid":!!t.name}),t.name&&s.jsx("div",{id:"name-error",className:"error-message",role:"alert",children:t.name})]}),(0,s.jsxs)("div",{className:"part",children:[s.jsx("div",{className:"s_title",children:"담당자"}),s.jsx("input",{type:"text",name:"manager",placeholder:"담당자",className:`ty01 mt10 ${t.manager?"error":""}`,value:i,onChange:a,maxLength:50,disabled:r,"aria-label":"담당자","aria-describedby":t.manager?"manager-error":void 0,"aria-invalid":!!t.manager}),t.manager&&s.jsx("div",{id:"manager-error",className:"error-message",role:"alert",children:t.manager})]}),(0,s.jsxs)("div",{className:"part",children:[s.jsx("div",{className:"s_title",children:"고객사"}),s.jsx("input",{type:"text",name:"consumer",placeholder:"고객사",className:`ty01 mt10 ${t.consumer?"error":""}`,value:n,onChange:a,maxLength:50,disabled:r,"aria-label":"고객사","aria-describedby":t.consumer?"consumer-error":void 0,"aria-invalid":!!t.consumer}),t.consumer&&s.jsx("div",{id:"consumer-error",className:"error-message",role:"alert",children:t.consumer})]}),(0,s.jsxs)("div",{className:"part",children:[s.jsx("div",{className:"s_title",children:"프로젝트 세부 설명(100자)"}),s.jsx("textarea",{name:"description",className:`mt10 ${t.description?"error":""}`,cols:30,rows:10,placeholder:"프로젝트 세부 설명",value:c,maxLength:100,onChange:a,disabled:r,"aria-label":"프로젝트 세부 설명","aria-describedby":t.description?"description-error":void 0,"aria-invalid":!!t.description}),t.description&&s.jsx("div",{id:"description-error",className:"error-message",role:"alert",children:t.description}),(0,s.jsxs)("div",{className:"char-count",children:[c.length,"/100"]})]})]})};i.displayName="ProjectInput";let n=(0,r.memo)(i);var c=t(479),d=t(4656);let o=[{key:"basic_plan",text:"기초기획안 작성"},{key:"story_board",text:"스토리보드 작성"},{key:"filming",text:"촬영 (계획/진행)"},{key:"video_edit",text:"비디오 편집"},{key:"post_work",text:"후반 작업"},{key:"video_preview",text:"비디오 시사 (피드백)"},{key:"confirmation",text:"최종 컨펌"},{key:"video_delivery",text:"영상 납품"}],m=(0,r.forwardRef)(({value:e,onClick:a,placeholder:t,disabled:r=!1},l)=>s.jsx("button",{type:"button",className:`example-custom-input ${e?"":"off"} ${r?"disabled":""}`,onClick:a,ref:l,disabled:r,"aria-label":t,children:e||t}));m.displayName="ExampleCustomInput";let p=({process:e,set_process:a,disabled:t=!1})=>{let l=(0,r.useCallback)((t,s,r)=>{let l=[...e];l[t]={startDate:l[t]?.startDate||null,endDate:l[t]?.endDate||null,phase_name:l[t]?.phase_name||"",...l[t],[s]:r},"startDate"===s&&l[t].endDate&&r&&l[t].endDate&&r>l[t].endDate&&(l[t]={...l[t],endDate:r}),a(l)},[e,a]),i=(0,r.useCallback)((a,t)=>{let s=e[t]?.startDate;return!!s&&new Date(s).setHours(0,0,0,0)<=new Date(a).setHours(0,0,0,0)},[e]),n=(0,r.useCallback)((a,t)=>{let s=e[t]?.startDate;return!!s&&(new Date(s).setHours(0,0,0,0)!==new Date(a).setHours(0,0,0,0)||new Date(s)<new Date(a))},[e]);return s.jsx("ul",{className:"dataprocess",children:e.map((e,a)=>{let r=o[a]||{text:`단계 ${a+1}`};return(0,s.jsxs)("li",{children:[s.jsx("div",{className:"type",children:r.text}),s.jsx("div",{className:"select start",children:s.jsx(c.ZP,{locale:d.Z,placeholderText:"시작 날짜",selected:e.startDate,onChange:e=>l(a,"startDate",e),showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:10,dateFormat:"yyyy-MM-dd HH:mm",customInput:s.jsx(m,{placeholder:"시작 날짜",disabled:t}),disabled:t,"aria-label":`${r.text} 시작 날짜`})}),s.jsx("div",{className:"select end",children:s.jsx(c.ZP,{locale:d.Z,placeholderText:"종료 날짜",selected:e.endDate,onChange:e=>l(a,"endDate",e),showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:10,dateFormat:"yyyy-MM-dd HH:mm",disabled:!e.startDate||t,filterDate:e=>i(e,a),filterTime:e=>n(e,a),customInput:s.jsx(m,{placeholder:"종료 날짜",disabled:!e.startDate||t}),"aria-label":`${r.text} 종료 날짜`})})]},a)})})};p.displayName="ProcessDate";let u=(0,r.memo)(p);var h=t(7967),j=t.n(h),x=t(6255),y=t(1006);let b={basic_plan:["기초기획안","작성"],story_board:["스토리보드","작성"],filming:["촬영","(계획/진행)"],video_edit:["비디오 편집"],post_work:["후반 작업"],video_preview:["비디오 시사","(피드백)"],confirmation:["최종 컨펌"],video_delivery:["영상 납품"]},g=(0,r.memo)(({project:e,phase:a,onProjectClick:t})=>{let r=e[a],l=()=>{t?.(e)};return s.jsx(y.o5,{children:(0,s.jsxs)("div",{className:"inner03",onClick:l,role:"button",tabIndex:0,onKeyPress:e=>{("Enter"===e.key||" "===e.key)&&l()},"aria-label":`${e.name} 프로젝트`,children:[s.jsx("div",{className:"name",children:e.name}),r?.start_date&&r?.end_date?(0,s.jsxs)("div",{className:"day",children:[s.jsx("span",{children:j()(r.start_date).format("YYYY.MM.DD.dd")}),(0,s.jsxs)("span",{children:["~ ",j()(r.end_date).format("YYYY.MM.DD.dd")]})]}):s.jsx("span",{className:"no-date",children:"날짜를 입력해주세요."})]})})});g.displayName="ProjectSlide";let f=(0,r.memo)(({phase:e,projects:a,onProjectClick:t})=>{let i=(0,r.useMemo)(()=>{let t=new Date().setHours(0,0,0,0);return a.filter(a=>{let s=a[e];return!s?.end_date||new Date(s.end_date).setHours(0,0,0,0)>=t}).sort((a,t)=>{let s=a[e],r=t[e],l=new Date(s?.end_date?s.end_date:"9999-12-31"),i=new Date(r?.end_date?r.end_date:"9999-12-31");return l.getTime()-i.getTime()})},[a,e]),n=b[e];return 0===i.length?null:(0,s.jsxs)("div",{className:"process flex space_between align_center",children:[s.jsx("div",{className:"s_title",children:n.map((e,a)=>(0,s.jsxs)(l().Fragment,{children:[e,a<n.length-1&&s.jsx("br",{})]},a))}),s.jsx(y.tq,{modules:[x.W_,x.tl,x.LW,x.s5],spaceBetween:0,slidesPerView:5,pagination:{clickable:!0},scrollbar:{draggable:!0},navigation:!0,breakpoints:{320:{slidesPerView:1},768:{slidesPerView:3},1024:{slidesPerView:4},1200:{slidesPerView:5}},className:`project-phase-swiper phase-${e}`,children:i.map(a=>s.jsx(g,{project:a,phase:e,...t&&{onProjectClick:t}},`${e}-${a.id}`))})]})});f.displayName="ProjectPhase";let v=({project_list:e,onProjectClick:a,showAllPhases:t=!0})=>e&&0!==e.length?s.jsx("div",{className:"list_box mt100",children:["basic_plan","story_board","filming","video_edit","post_work","video_preview","confirmation","video_delivery"].map(t=>s.jsx(f,{phase:t,projects:e,...a&&{onProjectClick:a}},t))}):s.jsx("div",{className:"list_box mt100",children:s.jsx("div",{className:"empty-state",children:s.jsx("p",{children:"표시할 프로젝트가 없습니다."})})});v.displayName="ProjectList";let _=(0,r.memo)(v);var N=t(6226),w=t(2006);let k={src:"/_next/static/media/down_icon.40eeaf29.svg",height:512,width:512,blurWidth:0,blurHeight:0},P=(0,r.memo)(({current_project:e,isAdmin:a=!1,onEdit:t})=>{let[l,i]=(0,r.useState)(!1),n=(0,r.useRef)(null),[c,d]=(0,r.useState)(0);(0,r.useEffect)(()=>{n.current&&d(n.current.scrollHeight)},[l,e]);let o=(0,r.useCallback)(()=>{i(e=>!e)},[]),m=(0,r.useCallback)(e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),o())},[o]),p=(0,r.useCallback)((e,a)=>{w.qx.downloadFile(e,a)},[]),u={height:l?`${c}px`:"0",overflow:"hidden",transition:"height 0.3s ease-in-out"};return(0,s.jsxs)("div",{className:"info_wrap",children:[(0,s.jsxs)("div",{className:"name_box flex align_center space_between",children:[(0,s.jsxs)("div",{className:"flex align_center start",children:[(0,s.jsxs)("button",{type:"button",className:`toggle-btn ${l?"on":""}`,onClick:o,onKeyPress:m,"aria-expanded":l,"aria-controls":"project-details","aria-label":`프로젝트 상세 정보 ${l?"닫기":"열기"}`,children:[s.jsx("span",{className:"sr-only",children:l?"상세 정보 닫기":"상세 정보 열기"}),s.jsx("span",{className:"toggle-icon","aria-hidden":"true",children:l?"−":"+"})]}),s.jsx("h1",{className:"s_title",children:e.name})]}),(0,s.jsxs)("div",{className:"update-info",children:["최종 업데이트 날짜 |"," ",s.jsx("time",{dateTime:e.updated,children:j()(e.updated).format("YYYY.MM.DD")})]})]}),s.jsx("div",{id:"project-details",className:"box",style:u,role:"region","aria-labelledby":"project-name",children:(0,s.jsxs)("div",{ref:n,className:"inner",children:[(0,s.jsxs)("section",{className:"explanation",children:[s.jsx("div",{className:"ss_title",children:s.jsx("span",{children:"프로젝트 설명"})}),s.jsx("p",{children:e.description})]}),(0,s.jsxs)("section",{className:"member",children:[s.jsx("div",{className:"ss_title",children:s.jsx("span",{children:"멤버"})}),(0,s.jsxs)("ul",{children:[(0,s.jsxs)("li",{className:"admin",children:[s.jsx("div",{className:"img","aria-hidden":"true"}),(0,s.jsxs)("div",{className:"txt",children:[s.jsx("strong",{children:e.owner_nickname}),s.jsx("span",{className:"role",children:"(관리자)"}),s.jsx("span",{className:"email",children:e.owner_email})]})]}),e.member_list.map(e=>(0,s.jsxs)("li",{className:"manager"===e.rating?"admin":"basic",children:[s.jsx("div",{className:"img","aria-hidden":"true"}),(0,s.jsxs)("div",{className:"txt",children:[s.jsx("strong",{children:e.nickname}),(0,s.jsxs)("span",{className:"role",children:["(","manager"===e.rating?"관리자":"일반",")"]}),s.jsx("span",{className:"email",children:e.email})]})]},e.id))]})]}),(0,s.jsxs)("section",{className:"info",children:[s.jsx("div",{className:"ss_title",children:s.jsx("span",{children:"프로젝트 정보"})}),(0,s.jsxs)("dl",{className:"info-list",children:[(0,s.jsxs)("div",{className:"info-item",children:[s.jsx("dt",{children:"작업자"}),s.jsx("dd",{children:e.manager})]}),(0,s.jsxs)("div",{className:"info-item",children:[s.jsx("dt",{children:"고객사"}),s.jsx("dd",{children:e.consumer})]}),(0,s.jsxs)("div",{className:"info-item",children:[(0,s.jsxs)("dt",{children:["프로젝트",s.jsx("br",{}),"생성일"]}),s.jsx("dd",{children:s.jsx("time",{dateTime:e.created,children:j()(e.created).format("YYYY.MM.DD")})})]}),(0,s.jsxs)("div",{className:"info-item",children:[s.jsx("dt",{children:"등록 파일"}),s.jsx("dd",{children:0===e.files.length?s.jsx("span",{className:"no-files",children:"등록된 파일이 없습니다."}):s.jsx("div",{className:"files-list",children:e.files.map(e=>{let a=w.qx.extractFileName(e.file_name);return(0,s.jsxs)("button",{type:"button",className:"file-download",onClick:()=>p(e.files,a),"aria-label":`${a} 다운로드`,children:[s.jsx("span",{className:"file-name",children:a}),s.jsx("i",{className:"download-icon","aria-hidden":"true",children:s.jsx(N.default,{src:k,alt:"",width:16,height:16})})]},e.id)})})})]})]})]}),a&&t&&s.jsx("div",{className:"action-buttons",children:s.jsx("button",{type:"button",className:"submit",onClick:t,"aria-label":"프로젝트 편집",children:"프로젝트 편집"})})]})})]})});P.displayName="ProjectInfo";let C=P;var D=t(1439),$=t(3568);let A=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),S=(0,r.memo)(({project_id:e,set_current_project:a,pending_list:l,disabled:i=!1})=>{let[n,c]=(0,r.useState)([""]),[d,o]=(0,r.useState)({}),{fetchProject:m,inviteMember:p}=(0,$.Z0)(),u=(0,r.useCallback)((e,a)=>{let t=[...n];t[e]=a,c(t)},[n]),h=(0,r.useCallback)(()=>{c(e=>[...e,""])},[]),j=(0,r.useCallback)(e=>{if(n.length<=1)return;let a=[...n];a.splice(e,1),c(a)},[n]),x=(0,r.useCallback)(async(a,t)=>{if(!t.trim()){D.Am.error("이메일을 입력해주세요.");return}if(!A(t)){D.Am.error("올바른 이메일 형식을 입력해주세요.");return}if(l.some(e=>e.email===t)){D.Am.error("이미 초대된 이메일입니다.");return}try{o(e=>({...e,[a]:!0})),await p(e,t),u(a,""),await m(e)}catch(e){}finally{o(e=>({...e,[a]:!1}))}},[e,l,p,m,a,u]),y=(0,r.useCallback)(async a=>{if(window.confirm("초대를 취소하시겠습니까?"))try{let{cancelProjectInvitation:s}=await Promise.resolve().then(t.bind(t,2006));await s(e,a),await m(e),D.Am.success("초대가 취소되었습니다.")}catch(e){D.Am.error("초대 취소에 실패했습니다.")}},[e,m,a]),b=(0,r.useCallback)((e,a,t)=>{"Enter"===e.key&&(e.preventDefault(),x(a,t))},[x]);return(0,s.jsxs)("div",{className:"invite-input-container",children:[l.map((e,a)=>(0,s.jsxs)("div",{className:"pr mt10",children:[s.jsx("input",{type:"email",value:e.email,className:"ty01 pending",placeholder:"이메일 입력",readOnly:!0,"aria-label":`초대 대기중인 이메일: ${e.email}`}),s.jsx("span",{className:"pend","aria-label":"초대 상태",children:"초대됨"}),s.jsx("button",{type:"button",className:"del",onClick:()=>y(e.id),disabled:i,"aria-label":`${e.email} 초대 취소`,children:"삭제"})]},`pending-${e.id}`)),n.map((e,a)=>(0,s.jsxs)("div",{className:"pr mt10",children:[s.jsx("input",{type:"email",value:e,onChange:e=>u(a,e.target.value),onKeyPress:t=>b(t,a,e),className:"ty01",placeholder:"이메일 입력",disabled:i,"aria-label":`멤버 초대 이메일 ${a+1}`,"aria-describedby":`email-help-${a}`}),s.jsx("button",{type:"button",className:"cert",onClick:()=>x(a,e),disabled:i||d[a]||!e.trim(),"aria-label":"초대 보내기",children:d[a]?"전송중...":"보내기"}),n.length>1&&s.jsx("button",{type:"button",className:"del",onClick:()=>j(a),disabled:i,"aria-label":"입력 필드 삭제",children:"삭제"}),s.jsx("div",{id:`email-help-${a}`,className:"sr-only",children:"Enter 키를 눌러서 초대를 보낼 수 있습니다."})]},`email-${a}`)),s.jsx("button",{type:"button",className:"add",onClick:h,disabled:i,"aria-label":"새 멤버 초대 필드 추가",children:"+ 멤버 추가"}),s.jsx("div",{className:"invite-help mt10",children:s.jsx("small",{children:"올바른 이메일 주소를 입력하고 '보내기'를 클릭하면 초대 메일이 발송됩니다."})})]})});S.displayName="InviteInput";let E=S},3568:(e,a,t)=>{t.d(a,{FL:()=>o,Z0:()=>c,b5:()=>d,ti:()=>m});var s=t(7577),r=t(5047),l=t(9543),i=t(1439),n=t(2006);let c=()=>{let[e,a]=(0,s.useState)([]),[t,c]=(0,s.useState)(null),[d,o]=(0,s.useState)(!1),[m,p]=(0,s.useState)(null),u=(0,r.useRouter)(),h=(0,l.I0)(),{project_list:j}=(0,l.v9)(e=>e.ProjectStore),x=(0,s.useCallback)(async e=>{try{o(!0),p(null);let t=await n.ZP.fetchProjectList(e);a(t),h({type:"SET_PROJECT_LIST",payload:t})}catch(a){let e=n.ZP.isApiError(a)?a.message:"프로젝트 목록을 불러오는데 실패했습니다.";p(e),i.Am.error(e)}finally{o(!1)}},[h]),y=(0,s.useCallback)(async e=>{try{o(!0),p(null);let a=await n.ZP.fetchProject(e);return c(a),a}catch(a){let e=n.ZP.isApiError(a)?a.message:"프로젝트를 불러오는데 실패했습니다.";throw p(e),i.Am.error(e),a}finally{o(!1)}},[]),b=(0,s.useCallback)(async e=>{try{o(!0),p(null);let a=await n.ZP.createProject(e);return await x(),i.Am.success("프로젝트가 성공적으로 생성되었습니다."),u.push("/Calendar"),await y(a.id)}catch(a){let e=n.ZP.isApiError(a)?a.message:"프로젝트 생성에 실패했습니다.";throw p(e),i.Am.error(e),a}finally{o(!1)}},[x,y,u]),g=(0,s.useCallback)(async(e,a)=>{try{o(!0),p(null);let t=await n.ZP.updateProject(e,a);return c(t),await x(),i.Am.success("프로젝트가 성공적으로 업데이트되었습니다."),u.push("/Calendar"),t}catch(a){let e=n.ZP.isApiError(a)?a.message:"프로젝트 업데이트에 실패했습니다.";throw p(e),i.Am.error(e),a}finally{o(!1)}},[x,u]),f=(0,s.useCallback)(async e=>{if(window.confirm("프로젝트를 삭제하시겠습니까?"))try{o(!0),p(null),await n.ZP.deleteProject(e),t?.id===Number(e)&&c(null),await x(),i.Am.success("프로젝트가 성공적으로 삭제되었습니다."),u.push("/Calendar")}catch(a){let e=n.ZP.isApiError(a)?a.message:"프로젝트 삭제에 실패했습니다.";throw p(e),i.Am.error(e),a}finally{o(!1)}},[t,x,u]),v=(0,s.useCallback)(async(e,a)=>{try{await n.ZP.inviteProjectMember(e,a),t?.id===Number(e)&&await y(e),i.Am.success("멤버 초대가 완료되었습니다.")}catch(a){let e=n.ZP.isApiError(a)?a.message:"멤버 초대에 실패했습니다.";throw p(e),i.Am.error(e),a}},[t,y]),_=(0,s.useCallback)(async(e,a,s)=>{try{await n.ZP.updateMemberRating(e,a,s),t?.id===Number(e)&&await y(e),i.Am.success("멤버 권한이 변경되었습니다.")}catch(a){let e=n.ZP.isApiError(a)?a.message:"멤버 권한 변경에 실패했습니다.";throw p(e),i.Am.error(e),a}},[t,y]),N=(0,s.useCallback)(async e=>{if(window.confirm("파일을 삭제하시겠습니까?"))try{await n.ZP.deleteProjectFile(e),t&&await y(t.id),i.Am.success("파일이 삭제되었습니다.")}catch(a){let e=n.ZP.isApiError(a)?a.message:"파일 삭제에 실패했습니다.";throw p(e),i.Am.error(e),a}},[t,y]),w=(0,s.useCallback)(async()=>{await x(),t&&await y(t.id)},[x,y,t]),k=(0,s.useCallback)(()=>{p(null)},[]);return(0,s.useEffect)(()=>{x()},[x]),{projects:e,currentProject:t,loading:d,error:m,fetchProjects:x,fetchProject:y,createProject:b,updateProject:g,deleteProject:f,inviteMember:v,updateMemberRating:_,deleteFile:N,refetch:w,clearError:k}},d=e=>{let a=()=>({name:e?.name||"",description:e?.description||"",manager:e?.manager||"",consumer:e?.consumer||""}),t=()=>[{startDate:null,endDate:null,phase_name:"basic_plan"},{startDate:null,endDate:null,phase_name:"story_board"},{startDate:null,endDate:null,phase_name:"filming"},{startDate:null,endDate:null,phase_name:"video_edit"},{startDate:null,endDate:null,phase_name:"post_work"},{startDate:null,endDate:null,phase_name:"video_preview"},{startDate:null,endDate:null,phase_name:"confirmation"},{startDate:null,endDate:null,phase_name:"video_delivery"}],[r,l]=(0,s.useState)(a),[d,o]=(0,s.useState)(t),[m,p]=(0,s.useState)([]),[u,h]=(0,s.useState)({isValid:!1,errors:{}}),[j,x]=(0,s.useState)(!1),{createProject:y,updateProject:b}=c(),g=(0,s.useCallback)(e=>{let{name:a,value:t}=e.target;l(e=>({...e,[a]:t})),_()},[]),f=(0,s.useCallback)(e=>{let a=Array.from(e.target.files||[]);p(e=>[...e,...a])},[]),v=(0,s.useCallback)(e=>{p(a=>a.filter((a,t)=>t!==e))},[]),_=(0,s.useCallback)(()=>{let e={};r.name.trim()?r.name.length>50&&(e.name="프로젝트 이름은 50자 이내로 입력해주세요."):e.name="프로젝트 이름을 입력해주세요.",r.description.trim()?r.description.length>100&&(e.description="프로젝트 설명은 100자 이내로 입력해주세요."):e.description="프로젝트 설명을 입력해주세요.",r.manager.trim()?r.manager.length>50&&(e.manager="담당자는 50자 이내로 입력해주세요."):e.manager="담당자를 입력해주세요.",r.consumer.trim()?r.consumer.length>50&&(e.consumer="고객사는 50자 이내로 입력해주세요."):e.consumer="고객사를 입력해주세요.";let a={isValid:0===Object.keys(e).length,errors:e};return h(a),a},[r]),N=(0,s.useCallback)(()=>{l(a()),o(t()),p([]),h({isValid:!1,errors:{}})},[]),w=(0,s.useCallback)(async(a,t)=>{if(!_().isValid){i.Am.error("입력란을 모두 채워주세요.");return}try{x(!0);let s=n.ZP.createProjectFormData(r,d,m,e?.member_list);"create"===a?await y(s):"update"===a&&t&&await b(t,s),N()}catch(e){}finally{x(!1)}},[r,d,m,e,_,y,b,N]);return(0,s.useEffect)(()=>{e&&(l({name:e.name,description:e.description,manager:e.manager,consumer:e.consumer}),o(["basic_plan","story_board","filming","video_edit","post_work","video_preview","confirmation","video_delivery"].map(a=>{let t=e[a];return{startDate:t?.start_date?new Date(t.start_date):null,endDate:t?.end_date?new Date(t.end_date):null,phase_name:a}})))},[e]),{inputs:r,process:d,files:m,validation:u,isSubmitting:j,onChange:g,setProcess:o,onFileChange:f,onFileDelete:v,validateForm:_,resetForm:N,handleSubmit:w}},o=()=>{let[e,a]=(0,s.useState)([]),[t,r]=(0,s.useState)([]),l=(0,s.useCallback)(e=>{let t=Array.from(e.target.files||[]);a(e=>[...e,...t]);let s=t.map(e=>({file:e,status:"pending",progress:0}));r(e=>[...e,...s])},[]),i=(0,s.useCallback)(e=>{a(a=>a.filter((a,t)=>t!==e)),r(a=>a.filter((a,t)=>t!==e))},[]),c=(0,s.useCallback)(async a=>{if(0===e.length)return[];try{r(e=>e.map(e=>({...e,status:"uploading"})));let t=await n.ZP.uploadProjectFiles(a,e);return r(e=>e.map(e=>({...e,status:"completed",progress:100}))),t}catch(e){throw r(e=>e.map(e=>({...e,status:"error",error:"업로드에 실패했습니다."}))),e}},[e]);return{files:e,uploadStates:t,onFileChange:l,onFileDelete:i,uploadFiles:c,clearFiles:(0,s.useCallback)(()=>{a([]),r([])},[])}},m=e=>{let{user:a}=(0,l.v9)(e=>e.ProjectStore),t=(0,s.useCallback)(()=>!!e&&!!a&&(a===e.owner_email||e.member_list.some(e=>e.email===a&&"manager"===e.rating)),[e,a]),r=(0,s.useCallback)(()=>t(),[t]),i=(0,s.useCallback)(()=>t(),[t]),n=(0,s.useCallback)(()=>t(),[t]),c=(0,s.useCallback)(()=>t(),[t]);return{isAdmin:t(),canEdit:r(),canDelete:i(),canInvite:n(),canManageMembers:c()}}}};
(()=>{var e={};e.id=698,e.ids=[698],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},7790:e=>{"use strict";e.exports=require("assert")},4770:e=>{"use strict";e.exports=require("crypto")},7702:e=>{"use strict";e.exports=require("events")},2048:e=>{"use strict";e.exports=require("fs")},2615:e=>{"use strict";e.exports=require("http")},8791:e=>{"use strict";e.exports=require("https")},9801:e=>{"use strict";e.exports=require("os")},5315:e=>{"use strict";e.exports=require("path")},6162:e=>{"use strict";e.exports=require("stream")},4175:e=>{"use strict";e.exports=require("tty")},7360:e=>{"use strict";e.exports=require("url")},1764:e=>{"use strict";e.exports=require("util")},1568:e=>{"use strict";e.exports=require("zlib")},5440:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>l.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>c,routeModule:()=>p,tree:()=>d}),a(1758),a(5866),a(1506);var r=a(3191),s=a(8716),n=a(7922),l=a.n(n),o=a(5231),i={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>o[e]);a.d(t,i);let d=["",{children:["(main)",{children:["calendar",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,1758)),"C:\\Users\\유석근PD\\Desktop\\developments\\Videoplanet\\app\\(main)\\calendar\\page.tsx"]}]},{}]},{"not-found":[()=>Promise.resolve().then(a.t.bind(a,5866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,1506)),"C:\\Users\\유석근PD\\Desktop\\developments\\Videoplanet\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,5866,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\유석근PD\\Desktop\\developments\\Videoplanet\\app\\(main)\\calendar\\page.tsx"],m="/(main)/calendar/page",u={require:a,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/(main)/calendar/page",pathname:"/calendar",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},6532:(e,t,a)=>{Promise.resolve().then(a.bind(a,9131))},9131:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ee});var r=a(326),s=a(7577),n=a.n(s),l=a(9543),o=a(5047),i=a(8029),d=a.n(i),c=a(1905);function m(e){return["small","middle","large"].includes(e)}function u(e){return!!e&&"number"==typeof e&&!Number.isNaN(e)}var p=a(5190),h=a(8228);let y=n().createContext({latestIndex:0}),v=y.Provider,g=e=>{let{className:t,index:a,children:r,split:n,style:l}=e,{latestIndex:o}=s.useContext(y);return null==r?null:s.createElement(s.Fragment,null,s.createElement("div",{className:t,style:l},r),a<o&&n&&s.createElement("span",{className:`${t}-split`},n))};var j=a(7892),x=function(e,t){var a={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(a[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(a[r[s]]=e[r[s]]);return a};let _=s.forwardRef((e,t)=>{var a,r,n;let{getPrefixCls:l,space:o,direction:i}=s.useContext(p.E_),{size:h=null!==(a=null==o?void 0:o.size)&&void 0!==a?a:"small",align:y,className:_,rootClassName:w,children:f,direction:D="horizontal",prefixCls:b,split:k,style:P,wrap:N=!1,classNames:C,styles:M}=e,I=x(e,["size","align","className","rootClassName","children","direction","prefixCls","split","style","wrap","classNames","styles"]),[S,E]=Array.isArray(h)?h:[h,h],$=m(E),T=m(S),V=u(E),A=u(S),O=(0,c.Z)(f,{keepEmpty:!0}),q=void 0===y&&"horizontal"===D?"center":y,F=l("space",b),[U,Y,L]=(0,j.Z)(F),H=d()(F,null==o?void 0:o.className,Y,`${F}-${D}`,{[`${F}-rtl`]:"rtl"===i,[`${F}-align-${q}`]:q,[`${F}-gap-row-${E}`]:$,[`${F}-gap-col-${S}`]:T},_,w,L),Z=d()(`${F}-item`,null!==(r=null==C?void 0:C.item)&&void 0!==r?r:null===(n=null==o?void 0:o.classNames)||void 0===n?void 0:n.item),B=0,R=O.map((e,t)=>{var a,r;null!=e&&(B=t);let n=(null==e?void 0:e.key)||`${Z}-${t}`;return s.createElement(g,{className:Z,key:n,index:t,split:k,style:null!==(a=null==M?void 0:M.item)&&void 0!==a?a:null===(r=null==o?void 0:o.styles)||void 0===r?void 0:r.item},e)}),K=s.useMemo(()=>({latestIndex:B}),[B]);if(0===O.length)return null;let z={};return N&&(z.flexWrap="wrap"),!T&&A&&(z.columnGap=S),!$&&V&&(z.rowGap=E),U(s.createElement("div",Object.assign({ref:t,className:H,style:Object.assign(Object.assign(Object.assign({},z),null==o?void 0:o.style),P)},I),s.createElement(v,{value:K},R)))});_.Compact=h.ZP;var w=a(5925),f=a(3077),D=a(6803);let b={basic_plan:{name:"기초기획안 작성",color:"#0131ff",order:1},story_board:{name:"스토리보드 작성",color:"#ff6b35",order:2},filming:{name:"촬영(계획/진행)",color:"#f7931e",order:3},video_edit:{name:"비디오 편집",color:"#ffcd3c",order:4},post_work:{name:"후반 작업",color:"#c5d86d",order:5},video_preview:{name:"비디오 시사",color:"#00a8cc",order:6},confirmation:{name:"최종 컨펌",color:"#0085c3",order:7},video_delivery:{name:"영상 납품",color:"#4c5c68",order:8}},k={currentView:"월",currentDate:new Date,selectedDate:null,viewData:[],projects:[],filteredProjects:[],selectedProjectIds:[],userMemos:[],isLoading:!1,error:null},{Option:P}=w.default;var N=a(479),C=a(2486);let M=(0,s.memo)(({ModalTitle:e,ModalText:t,visible:a=!1,onCancel:s,width:n,style:l,className:o})=>(0,r.jsxs)(C.Z,{footer:!1,centered:!0,...n&&{width:n},...l&&{style:l},open:a,...s&&{onCancel:s},closable:!1,...o&&{className:o},maskClosable:!0,destroyOnClose:!0,children:[e&&r.jsx("div",{className:"modal-title",children:e}),t&&r.jsx("div",{className:"modal-content",children:t})]}));var I=a(4099);let S=(()=>{let e=I.Z.create({baseURL:process.env.NEXT_PUBLIC_BACKEND_API_URL||"http://localhost:8000",timeout:1e4,headers:{"Content-Type":"application/json"}});return e.interceptors.request.use(e=>e,e=>(console.error("Request interceptor error:",e),Promise.reject(e))),e.interceptors.response.use(e=>e,async t=>{let a=t.config;if(t.response?.status===401&&!a._retry){a._retry=!0;try{let t=localStorage.getItem("refresh_token");if(t){let r=(await I.Z.post(`${process.env.NEXT_PUBLIC_BACKEND_API_URL}/auth/token/refresh/`,{refresh:t})).data.access;return localStorage.setItem("access_token",r),a.headers.Authorization=`Bearer ${r}`,e(a)}}catch(e){console.error("Token refresh failed:",e)}}return Promise.reject(t)}),e})(),E=e=>e.response?{message:e.response.data?.message||"API 오류가 발생했습니다.",status:e.response.status,field:e.response.data?.field}:e.request?{message:"네트워크 오류가 발생했습니다.",status:0}:{message:e.message||"알 수 없는 오류가 발생했습니다.",status:-1},$=e=>"object"==typeof e&&null!==e&&"number"==typeof e.id&&"string"==typeof e.memo&&e.date,T={updateProjectPhase:async e=>{try{let{projectId:t,phaseKey:a,startDate:r,endDate:s}=e,n={[a]:{start_date:r?.toISOString(),end_date:s?.toISOString()}},l=await S.post(`/projects/date_update/${t}`,n);if(l.data.success&&l.data.phase)return l.data.phase;throw Error("프로젝트 단계 업데이트에 실패했습니다.")}catch(e){throw console.error("프로젝트 단계 업데이트 실패:",e),E(e)}},createProjectMemo:async(e,t)=>{try{let a=await S.post(`/projects/memo/${t}`,e);if(a.data.success&&$(a.data.memo))return a.data.memo;throw Error("메모 작성에 실패했습니다.")}catch(e){throw console.error("프로젝트 메모 작성 실패:",e),E(e)}},deleteProjectMemo:async(e,t)=>{try{if(!(await S.delete(`/projects/memo/${t}`,{data:{memo_id:e}})).data.success)throw Error("메모 삭제에 실패했습니다.")}catch(e){throw console.error("프로젝트 메모 삭제 실패:",e),E(e)}},createUserMemo:async e=>{try{let t=await S.post("/auth/user_memo",e);if(t.data.success&&$(t.data.memo))return t.data.memo;throw Error("사용자 메모 작성에 실패했습니다.")}catch(e){throw console.error("사용자 메모 작성 실패:",e),E(e)}},deleteUserMemo:async e=>{try{if(!(await S.delete(`/auth/user_memo/${e}`)).data.success)throw Error("사용자 메모 삭제에 실패했습니다.")}catch(e){throw console.error("사용자 메모 삭제 실패:",e),E(e)}},formatDateForApi:e=>{let t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${r}`}},V=({day:e,month:t,year:a,current_project:l,project_list:i,user_memos:c,is_admin:m,refetch:u})=>{let p=(0,o.useRouter)(),h=(0,o.useParams)(),y=h?.project_id,[v,g]=(0,s.useState)(!1),[j,x]=(0,s.useState)(null),[_,w]=(0,s.useState)(null),[f,D]=(0,s.useState)(null),[b,k]=(0,s.useState)(""),P=e=>new Date(e).setHours(0,0,0,0),C=t=>t===e.setHours(0,0,0,0),I=e.getMonth()===new Date().getMonth()&&e.getFullYear()===new Date().getFullYear()&&e.getDate()===new Date().getDate(),S=async()=>{if(0===b.length){alert("메모를 작성해주세요.");return}try{let r={date:`${a}-${t+1}-${e.getDate()}`,memo:b};m&&y?await T.createProjectMemo(r,parseInt(y)):window.location.pathname.includes("/calendar")&&await T.createUserMemo(r),k(""),u(),g(!1)}catch(e){e.response?.data?.message?alert(e.response.data.message):alert("메모 작성에 실패했습니다.")}},E=async e=>{try{m&&y?await T.deleteProjectMemo(e.id,parseInt(y)):window.location.pathname.includes("/calendar")&&await T.deleteUserMemo(e.id),u(),x(null)}catch(e){e.response?.data?.message?alert(e.response.data.message):alert("메모 삭제에 실패했습니다.")}},$=async()=>{if(!_.start_date||!_.end_date){alert("날짜를 입력해주세요.");return}if(new Date(_.start_date)>=new Date(_.end_date)){alert("종료 날짜는 시작 날짜보다 늦어야 합니다.");return}try{await T.updateProjectPhase({projectId:parseInt(y),phaseKey:_.phase_key,startDate:new Date(_.start_date),endDate:new Date(_.end_date)}),u(),w(null)}catch(e){e.response?.data?.message?alert(e.response.data.message):alert("일정 변경에 실패했습니다.")}},V=e=>{let t=new Date;return e>=t||e.toDateString()===t.toDateString()},A=v&&r.jsx(M,{visible:!0,ModalTitle:r.jsx(r.Fragment,{}),ModalText:(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"day",children:[a,"년 ",t+1,"월 ",e.getDate(),"일"]}),r.jsx("textarea",{className:"mt20",name:"textarea",placeholder:"메모를 입력해주세요.",cols:30,rows:10,value:b,onChange:e=>k(e.target.value)}),(0,r.jsxs)("div",{className:"btn_wrap",children:[r.jsx("button",{className:"submit",onClick:S,children:"등록"}),r.jsx("button",{className:"cancel",onClick:()=>g(!1),children:"닫기"})]})]})}),O=j&&r.jsx(M,{visible:!0,ModalTitle:r.jsx(r.Fragment,{}),ModalText:(0,r.jsxs)("div",{children:[r.jsx("div",{className:"memo_txt",children:j.memo}),(0,r.jsxs)("div",{className:"btn_wrap",children:[(m||window.location.pathname.includes("/calendar"))&&r.jsx("button",{className:"submit",onClick:()=>E(j),children:"삭제"}),r.jsx("button",{onClick:()=>x(null),className:"cancel",children:"닫기"})]})]})}),q=_&&r.jsx(M,{visible:!0,ModalTitle:r.jsx(r.Fragment,{}),ModalText:(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"selec_wrap",children:[r.jsx("div",{className:"select",children:r.jsx(N.ZP,{placeholderText:"시작 날짜",selected:_.start_date?new Date(_.start_date):null,onChange:e=>w({..._,start_date:e}),showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:10,dateFormat:"yyyy-MM-dd HH:mm",filterDate:V})}),r.jsx("div",{className:"select",children:r.jsx(N.ZP,{placeholderText:"종료 날짜",filterDate:e=>new Date(_.start_date).setHours(0,0,0,0)<=new Date(e).getTime()&&V(e),selected:_.end_date?new Date(_.end_date):null,onChange:e=>w({..._,end_date:e}),showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:10,dateFormat:"yyyy-MM-dd HH:mm",disabled:!_.start_date})})]}),(0,r.jsxs)("div",{className:"btn_wrap",children:[r.jsx("button",{className:"submit",onClick:$,children:"변경하기"}),r.jsx("button",{className:"cancel",onClick:()=>w(null),children:"닫기"})]})]})});return(0,r.jsxs)("div",{...(()=>{let r=0===e.getDay()||6===e.getDay();return{style:{opacity:e.getMonth()<t||e.getFullYear()<a||e.getMonth()>t||e.getFullYear()>a?"0.3":"1",color:r?"red":"#000"}}})(),children:[A,O,q,r.jsx("p",{style:{cursor:m||window.location.pathname.includes("/calendar")?"pointer":"auto"},onClick:()=>{(m||window.location.pathname.includes("/calendar"))&&g(!0)},children:I?r.jsx("div",{className:"today",children:e.getDate()}):e.getDate()}),l?[{key:"basic_plan",name:"기초기획안 작성",className:"first"},{key:"story_board",name:"스토리보드 작성",className:"second"},{key:"filming",name:"촬영(계획/진행)",className:"third"},{key:"video_edit",name:"비디오 편집",className:"fourth"},{key:"post_work",name:"후반 작업",className:"fifth"},{key:"video_preview",name:"비디오 시사",className:"sixth"},{key:"confirmation",name:"최종 컨펌",className:"seven"},{key:"video_delivery",name:"영상 납품",className:"eighth"}].map(t=>{let a=l[t.key];if(!a?.start_date||!a?.end_date)return r.jsx("span",{},t.key);let s=P(a.start_date),o=P(a.end_date),i=P(e);return i<s||i>o?r.jsx("span",{},t.key):(0,r.jsxs)(n().Fragment,{children:[r.jsx("span",{onClick:()=>{m&&w({...a,phase_key:t.key})},onMouseOver:()=>D(t.name),onMouseLeave:()=>D(null),style:{cursor:m?"pointer":"auto"},className:d()(t.className,{start:C(s),end:C(o)})}),f===t.name&&r.jsx("div",{className:"Modal",children:f})]},t.key)}):null,i?i.map((t,a)=>{let s=P(t.first_date),l=P(t.end_date),o=P(e);return o<s||o>l?r.jsx("span",{},a):(0,r.jsxs)(n().Fragment,{children:[r.jsx("span",{onMouseOver:()=>D(a),onMouseLeave:()=>D(null),onClick:()=>p.push(`/projects/${t.id}/view`),className:d()({start:C(s),end:C(l)}),style:{background:t.color,cursor:"pointer"}}),f===a&&r.jsx("div",{className:"Modal",children:t.name})]},a)}):null,[...l?.memo||[],...c||[]].map((t,a)=>P(t.date)!==P(e)?null:r.jsx("span",{className:"memo",onClick:()=>x(t),style:{color:"#23262d",cursor:"pointer"},children:t.memo},a))]})},A=(0,s.memo)(({index:e,week:t,month:a,year:s,type:n,day:l,current_project:o,project_list:i,user_memos:d,is_admin:c,refetch:m})=>{let u=["일","월","화","수","목","금","토"];return(0,r.jsxs)(r.Fragment,{children:[0===e&&r.jsx("div",{className:"th",children:"일"!==n?u.map((e,t)=>r.jsx("div",{className:0===t||6===t?"holiday":"",children:e},t)):r.jsx("div",{className:l&&(0===l.getDay()||6===l.getDay())?"holiday":"",children:l&&u[l.getDay()]})}),"월"===n&&t&&r.jsx("div",{className:"td",children:r.jsx("div",{className:"week",children:t.map((e,t)=>r.jsx(V,{day:e,month:a,year:s,current_project:o,project_list:i,user_memos:d,is_admin:c,refetch:m,index:0,type:n},t))})}),"주"===n&&t&&r.jsx("div",{className:"td",children:r.jsx("div",{className:"week",children:t.map((e,t)=>r.jsx(V,{day:e,month:a,year:s,current_project:o,project_list:i,user_memos:d,is_admin:c,refetch:m,index:0,type:n},t))})}),"일"===n&&l&&r.jsx("div",{className:"td",children:r.jsx("div",{className:"week",children:r.jsx(V,{day:l,month:a,year:s,current_project:o,project_list:i,user_memos:d,is_admin:c,refetch:m,index:0,type:n})})})]})}),O=(0,s.memo)(({viewData:e,currentView:t,navigation:a,projects:s,userMemos:n,isAdmin:l,onEventClick:o,onDateClick:i,onRefetch:d})=>{let c=e=>e.map((e,o)=>Array.isArray(e.dates)?r.jsx(A,{index:o,week:e.dates.map(e=>e.date),month:a.month,year:a.year,type:t,current_project:void 0,project_list:s,user_memos:n,is_admin:l,refetch:d},o):null),m=e=>Array.isArray(e)?r.jsx(A,{index:0,week:e.map(e=>e.date),month:a.month,year:a.year,type:t,current_project:void 0,project_list:s,user_memos:n,is_admin:l,refetch:d}):null,u=e=>Array.isArray(e)&&0!==e.length?r.jsx(A,{index:0,month:a.month,year:a.year,type:t,day:e[0]?.date||new Date,current_project:void 0,project_list:s,user_memos:n,is_admin:l,refetch:d}):null;return r.jsx("div",{className:"일"===t?"calendar_box day":"calendar_box",role:"main","aria-label":"캘린더 본체",children:(()=>{switch(t){case"월":return c(e);case"주":return m(e);case"일":return u(e);default:return null}})()})}),q=(0,s.memo)(({stats:e,className:t=""})=>r.jsx("div",{className:`part mt100 ${t}`,children:(0,r.jsxs)("ul",{className:"schedule",children:[(0,r.jsxs)("li",{children:["전체 ",r.jsx("br",{}),"프로젝트 ",r.jsx("span",{children:e.totalProjects})]}),(0,r.jsxs)("li",{children:["이번 달 ",r.jsx("br",{}),"프로젝트 ",r.jsx("span",{children:e.thisMonthProjects})]}),(0,r.jsxs)("li",{children:["다음 달 ",r.jsx("br",{}),"프로젝트 ",r.jsx("span",{children:e.nextMonthProjects})]}),(0,r.jsxs)("li",{children:["진행 중 ",r.jsx("br",{}),"프로젝트 ",r.jsx("span",{children:e.activeProjects})]})]})}));var F=a(7967),U=a.n(F),Y=a(6255),L=a(1006);let H=({title:e,projects:t,phaseKey:a})=>{let s=t.filter(e=>{let t=e.phases[a];return!t.endDate||t.endDate&&t.endDate.getTime()>=new Date().setHours(0,0,0,0)}).sort((e,t)=>{let r=e.phases[a].endDate,s=t.phases[a].endDate;return r||s?r?s?r.getTime()-s.getTime():-1:1:0});return(0,r.jsxs)("div",{className:"process flex space_between align_center",children:[r.jsx("div",{className:"s_title",dangerouslySetInnerHTML:{__html:e}}),(0,r.jsxs)(L.tq,{modules:[Y.W_,Y.tl,Y.LW,Y.s5],spaceBetween:0,slidesPerView:5,pagination:{clickable:!0},scrollbar:{draggable:!0},navigation:!0,breakpoints:{320:{slidesPerView:1,spaceBetween:10},640:{slidesPerView:2,spaceBetween:15},768:{slidesPerView:3,spaceBetween:20},1024:{slidesPerView:4,spaceBetween:20},1200:{slidesPerView:5,spaceBetween:0}},children:[s.map(e=>{let t=e.phases[a];return r.jsx(L.o5,{children:(0,r.jsxs)("div",{className:"inner03",children:[r.jsx("div",{className:"name",title:e.name,children:e.name}),t.startDate&&t.endDate?(0,r.jsxs)("div",{className:"day",children:[r.jsx("span",{children:U()(t.startDate).format("YYYY.MM.DD.dd")}),(0,r.jsxs)("span",{children:["~ ",U()(t.endDate).format("YYYY.MM.DD.dd")]})]}):r.jsx("span",{className:"no-date",children:"날짜를 입력해주세요."}),r.jsx("div",{className:"project-color-indicator",style:{backgroundColor:e.color}})]})},e.id)}),0===s.length&&r.jsx(L.o5,{children:r.jsx("div",{className:"inner03 no-projects",children:r.jsx("div",{className:"name",children:"진행 중인 프로젝트가 없습니다."})})})]})]})},Z=(0,s.memo)(({projects:e=[],className:t=""})=>r.jsx("div",{className:`list_box mt100 ${t}`,children:[{key:"basic_plan",title:"기초기획안 <br />작성"},{key:"story_board",title:"스토리보드 <br />작성"},{key:"filming",title:"촬영 <br />(계획/진행)"},{key:"video_edit",title:"비디오 편집"},{key:"post_work",title:"후반 작업"},{key:"video_preview",title:"비디오 시사 <br />(피드백)"},{key:"confirmation",title:"최종 컨펌"},{key:"video_delivery",title:"영상 납품"}].map(t=>r.jsx(H,{title:t.title,projects:e,phaseKey:t.key},t.key))})),B=(e,t)=>{let a=e.getFullYear(),r=e.getMonth(),s=e.getDate(),n=e.getDay(),l=new Date;return{year:a,month:r,date:s,day:n,isToday:e.toDateString()===l.toDateString(),isCurrentMonth:r===t,isWeekend:0===n||6===n}},R=(e,t)=>{let a=new Date(e,t,1),r=new Date(e,t+1,0),s=a.getDay(),n=r.getDate(),l=[],o=0===t?11:t-1,i=0===t?e-1:e,d=new Date(i,o+1,0).getDate();for(let e=s-1;e>=0;e--)l.push(new Date(i,o,d-e));for(let a=1;a<=n;a++)l.push(new Date(e,t,a));let c=42-l.length,m=11===t?0:t+1,u=11===t?e+1:e;for(let e=1;e<=c;e++)l.push(new Date(u,m,e));return l},K=(e,t,a)=>{let r=R(e,t),s=7*a;return r.slice(s,s+7)},z=(e,t,a)=>R(e,t)[a]||new Date(e,t,1),G=(e="월")=>{let t=(0,o.useRouter)(),a=(0,o.useSearchParams)(),r=(0,l.I0)(),{project_list:n,this_month_project:i,next_month_project:d,user_memos:c}=(0,l.v9)(e=>e.ProjectStore),[m,u]=(0,s.useState)({...k,currentView:e}),[p,h]=(0,s.useState)({year:new Date().getFullYear(),month:new Date().getMonth(),week:0,day:new Date().getDate()-1,weekIndex:0,navigatePrev:()=>{},navigateNext:()=>{}}),[y,v]=(0,s.useState)({isVisible:!1,type:null,data:null}),[g,j]=(0,s.useState)({isDragging:!1,draggedEvent:null,draggedPhase:null,dropTarget:null}),[x,_]=(0,s.useState)(!1),[w,f]=(0,s.useState)(null),D=(0,s.useMemo)(()=>n?.filter(e=>{let t=new Date(e.end_date).getMonth(),a=new Date(e.first_date).getMonth();return t===p.month||a===p.month})||[],[n,p.month]),b=(0,s.useMemo)(()=>0===m.selectedProjectIds.length?D:D.filter(e=>m.selectedProjectIds.includes(e.id)),[D,m.selectedProjectIds]),P=(0,s.useMemo)(()=>{let{year:e,month:t,weekIndex:a,day:r}=p;switch(m.currentView){case"월":{let a=R(e,t),r=[];for(let e=0;e<a.length;e+=7){let s=a.slice(e,e+7).map(e=>({date:e,dateInfo:B(e,t),events:[],memos:[]}));r.push({dates:s,weekIndex:e/7})}return r}case"주":return K(e,t,a).map(e=>({date:e,dateInfo:B(e,t),events:[],memos:[]}));case"일":{let a=z(e,t,r);return[{date:a,dateInfo:B(a,t),events:[],memos:[]}]}default:return[]}},[m.currentView,p]),N=(0,s.useMemo)(()=>({totalProjects:n?.length||0,thisMonthProjects:i?.length||0,nextMonthProjects:d?.length||0,activeProjects:n?.filter(e=>e.isActive)?.length||0,completedProjects:n?.filter(e=>!e.isActive)?.length||0,overdueProjects:0}),[n,i,d]),C=(0,s.useCallback)(e=>{u(t=>({...t,currentView:e}));let r=new URLSearchParams(a?.toString());r.set("view",e),t.push(`/calendar?${r.toString()}`)},[t,a]),M=(0,s.useCallback)(e=>{h(t=>({...t,year:e.getFullYear(),month:e.getMonth(),day:e.getDate()-1})),u(t=>({...t,selectedDate:e}))},[]),I=(0,s.useCallback)(e=>{e.includes(-1)?u(e=>({...e,selectedProjectIds:[]})):u(t=>({...t,selectedProjectIds:e}))},[]),S=(0,s.useCallback)(async e=>{try{if(_(!0),f(null),e.projectId){let t={memo:e.memo,date:T.formatDateForApi(e.date),projectId:e.projectId};await T.createProjectMemo(t,e.projectId)}else{let t={memo:e.memo,date:T.formatDateForApi(e.date)};await T.createUserMemo(t)}await L(),v({isVisible:!1,type:null,data:null})}catch(e){f(e.message||"메모 작성에 실패했습니다.")}finally{_(!1)}},[]),E=(0,s.useCallback)(async(e,t)=>{try{_(!0),f(null);let a=c?.find(t=>t.id===e);a&&(a.isUserMemo?await T.deleteUserMemo(e):await T.deleteProjectMemo(e,a.projectId),t.memo&&await S({memo:t.memo,date:t.date||a.date,projectId:a.projectId}))}catch(e){f(e.message||"메모 수정에 실패했습니다.")}finally{_(!1)}},[c,S]),$=(0,s.useCallback)(async e=>{try{_(!0),f(null);let t=c?.find(t=>t.id===e);t&&(t.isUserMemo?await T.deleteUserMemo(e):await T.deleteProjectMemo(e,t.projectId),await L(),v({isVisible:!1,type:null,data:null}))}catch(e){f(e.message||"메모 삭제에 실패했습니다.")}finally{_(!1)}},[c]),V=(0,s.useCallback)(async e=>{try{_(!0),f(null),await T.updateProjectPhase(e),await L(),v({isVisible:!1,type:null,data:null})}catch(e){f(e.message||"프로젝트 단계 업데이트에 실패했습니다.")}finally{_(!1)}},[]),A=(0,s.useCallback)(e=>{u(t=>({...t,selectedDate:e})),v({isVisible:!0,type:"memo",data:{date:e,isUserMemo:!0}})},[]),O=(0,s.useCallback)(e=>{"memo"===e.type&&v({isVisible:!0,type:"memo",data:{date:e.startDate,existingMemo:e}})},[]),q=(0,s.useCallback)(e=>{"type"in e&&"title"in e?j({isDragging:!0,draggedEvent:e,draggedPhase:null,dropTarget:null}):j({isDragging:!0,draggedEvent:null,draggedPhase:e,dropTarget:null})},[]),F=(0,s.useCallback)(async e=>{try{_(!0),f(null),"phase"===e.eventType&&e.phaseKey&&(await T.updateProjectPhase({projectId:e.projectId,phaseKey:e.phaseKey,startDate:e.targetDate,endDate:e.targetDate}),await L())}catch(e){f(e.message||"드래그 앤 드롭 업데이트에 실패했습니다.")}finally{_(!1),j({isDragging:!1,draggedEvent:null,draggedPhase:null,dropTarget:null})}},[]),U=(0,s.useCallback)(()=>{h(e=>{let{currentView:t}=m;switch(t){case"월":{let t=0===e.month?11:e.month-1,a=0===e.month?e.year-1:e.year;return{...e,year:a,month:t,weekIndex:0,day:0}}case"주":if(0!==e.weekIndex)return{...e,weekIndex:e.weekIndex-1};{let t=0===e.month?11:e.month-1,a=0===e.month?e.year-1:e.year,r=Math.ceil(R(a,t).length/7)-1;return{...e,year:a,month:t,weekIndex:r}}case"일":if(0!==e.day)return{...e,day:e.day-1};{let t=0===e.month?11:e.month-1,a=0===e.month?e.year-1:e.year,r=R(a,t);return{...e,year:a,month:t,day:r.length-1}}default:return e}})},[m.currentView]),Y=(0,s.useCallback)(()=>{h(e=>{let{currentView:t}=m;switch(t){case"월":{let t=11===e.month?0:e.month+1,a=11===e.month?e.year+1:e.year;return{...e,year:a,month:t,weekIndex:0,day:0}}case"주":{let t=Math.ceil(R(e.year,e.month).length/7)-1;if(e.weekIndex!==t)return{...e,weekIndex:e.weekIndex+1};{let t=11===e.month?0:e.month+1,a=11===e.month?e.year+1:e.year;return{...e,year:a,month:t,weekIndex:0}}}case"일":{let t=R(e.year,e.month);if(e.day!==t.length-1)return{...e,day:e.day+1};{let t=11===e.month?0:e.month+1,a=11===e.month?e.year+1:e.year;return{...e,year:a,month:t,day:0}}}default:return e}})},[m.currentView]),L=(0,s.useCallback)(async()=>{try{_(!0),f(null)}catch(e){f(e.message||"데이터를 불러오는데 실패했습니다.")}finally{_(!1)}},[r]);return(0,s.useEffect)(()=>{let e=a?.get("view");e&&["월","주","일"].includes(e)&&u(t=>({...t,currentView:e}))},[a]),{state:{...m,projects:D,filteredProjects:b,userMemos:c||[],viewData:P},handlers:{onViewChange:C,onDateChange:M,onProjectFilter:I,onMemoCreate:S,onMemoUpdate:E,onMemoDelete:$,onPhaseUpdate:V,onDateClick:A,onEventClick:O,onDragStart:q,onDragEnd:F},navigation:{...p,navigatePrev:U,navigateNext:Y},modal:y,stats:N,isLoading:x,error:w,refetch:L,setModal:v}},W=()=>{(0,l.I0)();let{project_list:e}=(0,l.v9)(e=>e.ProjectStore),[t,a]=(0,s.useState)([]),[r,n]=(0,s.useState)(!1),[o,i]=(0,s.useState)(null),d=(0,s.useMemo)(()=>e?.map(e=>({...e,firstDate:new Date(e.first_date),endDate:new Date(e.end_date),phases:{basic_plan:{id:`${e.id}-basic_plan`,name:b.basic_plan.name,key:"basic_plan",startDate:e.basic_plan?.start_date?new Date(e.basic_plan.start_date):null,endDate:e.basic_plan?.end_date?new Date(e.basic_plan.end_date):null,color:b.basic_plan.color,order:b.basic_plan.order},story_board:{id:`${e.id}-story_board`,name:b.story_board.name,key:"story_board",startDate:e.story_board?.start_date?new Date(e.story_board.start_date):null,endDate:e.story_board?.end_date?new Date(e.story_board.end_date):null,color:b.story_board.color,order:b.story_board.order},filming:{id:`${e.id}-filming`,name:b.filming.name,key:"filming",startDate:e.filming?.start_date?new Date(e.filming.start_date):null,endDate:e.filming?.end_date?new Date(e.filming.end_date):null,color:b.filming.color,order:b.filming.order},video_edit:{id:`${e.id}-video_edit`,name:b.video_edit.name,key:"video_edit",startDate:e.video_edit?.start_date?new Date(e.video_edit.start_date):null,endDate:e.video_edit?.end_date?new Date(e.video_edit.end_date):null,color:b.video_edit.color,order:b.video_edit.order},post_work:{id:`${e.id}-post_work`,name:b.post_work.name,key:"post_work",startDate:e.post_work?.start_date?new Date(e.post_work.start_date):null,endDate:e.post_work?.end_date?new Date(e.post_work.end_date):null,color:b.post_work.color,order:b.post_work.order},video_preview:{id:`${e.id}-video_preview`,name:b.video_preview.name,key:"video_preview",startDate:e.video_preview?.start_date?new Date(e.video_preview.start_date):null,endDate:e.video_preview?.end_date?new Date(e.video_preview.end_date):null,color:b.video_preview.color,order:b.video_preview.order},confirmation:{id:`${e.id}-confirmation`,name:b.confirmation.name,key:"confirmation",startDate:e.confirmation?.start_date?new Date(e.confirmation.start_date):null,endDate:e.confirmation?.end_date?new Date(e.confirmation.end_date):null,color:b.confirmation.color,order:b.confirmation.order},video_delivery:{id:`${e.id}-video_delivery`,name:b.video_delivery.name,key:"video_delivery",startDate:e.video_delivery?.start_date?new Date(e.video_delivery.start_date):null,endDate:e.video_delivery?.end_date?new Date(e.video_delivery.end_date):null,color:b.video_delivery.color,order:b.video_delivery.order}},memo:e.memo?.map(e=>({...e,date:new Date(e.date),createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at),isUserMemo:!1}))||[],isActive:!0,owner:e.owner||{id:0,name:"",email:""},members:e.members||[]}))||[],[e]),c=(0,s.useMemo)(()=>0===t.length?d:d.filter(e=>t.includes(e.id)),[d,t]),m=(0,s.useCallback)(e=>{a(e)},[]),u=(0,s.useCallback)(async e=>{try{n(!0),i(null),await T.updateProjectPhase(e)}catch(e){throw i(e.message||"프로젝트 단계 업데이트에 실패했습니다."),e}finally{n(!1)}},[]),p=(0,s.useCallback)((e,t)=>{let a=d.find(t=>t.id===e);return a?.phases[t]||null},[d]),h=(0,s.useCallback)(e=>{let t=d.find(t=>t.id===e);if(!t)return 0;let a=Object.values(t.phases);return a.filter(e=>e.startDate&&e.endDate&&new Date>e.endDate).length/a.length*100},[d]),y=(0,s.useCallback)(e=>d.map(t=>({project:t,phase:t.phases[e]})).filter(({phase:e})=>e.startDate&&e.endDate),[d]),v=(0,s.useCallback)((e=7)=>{let t=new Date,a=new Date;a.setDate(t.getDate()+e);let r=[];return d.forEach(e=>{Object.values(e.phases).forEach(s=>{if(s.endDate&&s.endDate>=t&&s.endDate<=a){let a=Math.ceil((s.endDate.getTime()-t.getTime())/864e5);r.push({project:e,phase:s,daysLeft:a})}})}),r.sort((e,t)=>e.daysLeft-t.daysLeft)},[d]),g=(0,s.useCallback)(()=>{let e=new Date,t=[];return d.forEach(a=>{Object.values(a.phases).forEach(r=>{if(r.endDate&&r.endDate<e){let s=Math.ceil((e.getTime()-r.endDate.getTime())/864e5);t.push({project:a,phase:r,daysOverdue:s})}})}),t.sort((e,t)=>t.daysOverdue-e.daysOverdue)},[d]),j=(0,s.useCallback)((e,t)=>!0,[]),x=(0,s.useCallback)(e=>{let t=[];e.startDate||t.push("시작 날짜를 선택해주세요."),e.endDate||t.push("종료 날짜를 선택해주세요."),e.startDate&&e.endDate&&e.startDate>=e.endDate&&t.push("종료 날짜는 시작 날짜보다 늦어야 합니다.");let a=new Date;return a.setHours(0,0,0,0),e.startDate&&e.startDate<a&&t.push("시작 날짜는 오늘 이후여야 합니다."),t},[]),_=(0,s.useCallback)((e,t,a)=>{let r=d.find(e=>e.id===a);return!!r&&!(t<r.firstDate)&&!(t>r.endDate)&&!!j(a,e)},[d,j]),w=(0,s.useCallback)(async(e,t,a,r)=>{try{n(!0),i(null);let s=d.find(e=>e.id===a);if(!s?.phases[e])throw Error("프로젝트 단계를 찾을 수 없습니다.");let l=t;r&&r>0&&(l=new Date(t)).setDate(l.getDate()+r),await u({projectId:a,phaseKey:e,startDate:t,endDate:l})}catch(e){throw i(e.message||"프로젝트 단계 이동에 실패했습니다."),e}finally{n(!1)}},[d,u]);return{projects:d,filteredProjects:c,selectedProjectIds:t,filterProjects:m,updatePhase:u,isUpdating:r,error:o,getProjectPhase:p,getProjectProgress:h,getProjectsByPhase:y,getUpcomingDeadlines:v,getOverdueProjects:g,isPhaseEditable:j,getPhaseValidationErrors:x,canDropPhase:_,movePhase:w,clearError:(0,s.useCallback)(()=>{i(null)},[])}};var X=a(5509);let J=()=>(0,r.jsxs)("div",{className:"calendar-skeleton",children:[r.jsx("div",{className:"skeleton-header"}),r.jsx("div",{className:"skeleton-body"}),r.jsx("div",{className:"skeleton-stats"})]}),Q=()=>{let e=(0,o.useRouter)(),t=(0,l.I0)(),a=(0,o.useSearchParams)(),{project_list:n,this_month_project:i,next_month_project:d,user_memos:c}=(0,l.v9)(e=>e.ProjectStore),{state:m,handlers:u,navigation:p,modal:h,stats:y,isLoading:v,error:g,refetch:j}=G(a?.get("view")||"월"),{projects:x,filteredProjects:b,selectedProjectIds:k,filterProjects:P}=W();(0,s.useEffect)(()=>{(0,X.J_)(t,e)},[t,e]),(0,s.useEffect)(()=>{let e=a?.get("view");e&&["월","주","일"].includes(e)&&u.onViewChange(e)},[a,u]);let N=()=>{(0,X.J_)(t,e)},C=e=>{"prev"===e?p.navigatePrev():p.navigateNext()},M=b.length>0?b:x;return g?r.jsx(f.Z,{leftItems:[],auth:!1,props:{},noLogin:!1,children:(0,r.jsxs)("div",{className:"cms_wrap",children:[r.jsx(D.Z,{tab:"calendar",on_menu:!1}),(0,r.jsxs)("main",{children:[r.jsx("div",{className:"title",children:"전체 일정"}),r.jsx("div",{className:"content calendar",children:(0,r.jsxs)("div",{className:"error-message",children:[r.jsx("h3",{children:"오류가 발생했습니다"}),r.jsx("p",{children:g}),r.jsx("button",{onClick:N,className:"btn-retry",children:"다시 시도"})]})})]})]})}):r.jsx(f.Z,{leftItems:[],auth:!1,props:{},noLogin:!1,children:(0,r.jsxs)("div",{className:"cms_wrap",children:[r.jsx(D.Z,{tab:"calendar",on_menu:!1}),(0,r.jsxs)("main",{children:[r.jsx("div",{className:"title",children:"전체 일정"}),(0,r.jsxs)("div",{className:"content calendar",children:[(0,r.jsxs)("div",{className:"filter flex space_between align_center",children:[(0,r.jsxs)("div",{className:"date flex space_between align_center",children:[p.year,".",String(p.month+1).padStart(2,"0"),(0,r.jsxs)("div",{className:"move",children:[r.jsx("span",{onClick:()=>C("prev"),className:"prev",role:"button",tabIndex:0,"aria-label":"이전",onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),C("prev"))}}),r.jsx("span",{onClick:()=>C("next"),className:"next",role:"button",tabIndex:0,"aria-label":"다음",onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),C("next"))}})]})]}),r.jsx("div",{className:"type",children:(0,r.jsxs)(_,{wrap:!0,children:[(0,r.jsxs)(w.default,{placeholder:"프로젝트 선택",className:"project-filter-select",style:{width:140},value:(()=>{if(0===k.length)return"전체";if(1!==k.length)return`${k.length}개 선택됨`;{let e=x.find(e=>e.id===k[0]);return e?.name||"전체"}})(),onChange:e=>{"전체"===e||-1===e?P([]):P(["string"==typeof e?parseInt(e):e])},getPopupContainer:e=>e.parentNode,children:[r.jsx(w.default.Option,{value:"전체",children:"전체"}),x.map(e=>r.jsx(w.default.Option,{value:e.id,children:e.name},e.id))]}),r.jsx(w.default,{value:m.currentView,style:{width:140},onChange:u.onViewChange,options:["월","주","일"].map(e=>({label:e,value:e})),getPopupContainer:e=>e.parentNode})]})})]}),v?r.jsx(J,{}):r.jsx(O,{viewData:m.viewData,currentView:m.currentView,navigation:p,projects:M,userMemos:m.userMemos,isAdmin:!0,onEventClick:u.onEventClick,onDateClick:u.onDateClick,onRefetch:N}),r.jsx("div",{className:"list_mark",children:r.jsx("ul",{children:M.map((e,t)=>(0,r.jsxs)("li",{children:[r.jsx("span",{style:{background:e.color}}),e.name]},e.id||t))})}),r.jsx(q,{stats:{totalProjects:n?.length||0,thisMonthProjects:i?.length||0,nextMonthProjects:d?.length||0,activeProjects:y.activeProjects,completedProjects:y.completedProjects,overdueProjects:y.overdueProjects}}),r.jsx(Z,{projects:M})]})]})]})})},ee=()=>r.jsx(s.Suspense,{fallback:r.jsx(J,{}),children:r.jsx(Q,{})})},1758:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});let r=(0,a(8570).createProxy)(String.raw`C:\Users\유석근PD\Desktop\developments\Videoplanet\app\(main)\calendar\page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[787,84,70,597,486,925,852],()=>a(5440));module.exports=r})();
(()=>{var e={};e.id=21,e.ids=[21],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},7790:e=>{"use strict";e.exports=require("assert")},4770:e=>{"use strict";e.exports=require("crypto")},7702:e=>{"use strict";e.exports=require("events")},2048:e=>{"use strict";e.exports=require("fs")},2615:e=>{"use strict";e.exports=require("http")},8791:e=>{"use strict";e.exports=require("https")},9801:e=>{"use strict";e.exports=require("os")},5315:e=>{"use strict";e.exports=require("path")},6162:e=>{"use strict";e.exports=require("stream")},4175:e=>{"use strict";e.exports=require("tty")},7360:e=>{"use strict";e.exports=require("url")},1764:e=>{"use strict";e.exports=require("util")},1568:e=>{"use strict";e.exports=require("zlib")},8364:(e,a,t)=>{"use strict";t.r(a),t.d(a,{GlobalError:()=>l.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>d,routeModule:()=>h,tree:()=>o}),t(5635),t(5866),t(4752);var s=t(3191),r=t(8716),n=t(7922),l=t.n(n),c=t(5231),i={};for(let e in c)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>c[e]);t.d(a,i);let o=["",{children:["(main)",{children:["feedback",{children:["[projectId]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,5635)),"C:\\Users\\유석근PD\\Desktop\\developments\\Videoplanet\\app\\(main)\\feedback\\[projectId]\\page.tsx"]}]},{}]},{}]},{"not-found":[()=>Promise.resolve().then(t.t.bind(t,5866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,4752)),"C:\\Users\\유석근PD\\Desktop\\developments\\Videoplanet\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,5866,23)),"next/dist/client/components/not-found-error"]}],d=["C:\\Users\\유석근PD\\Desktop\\developments\\Videoplanet\\app\\(main)\\feedback\\[projectId]\\page.tsx"],m="/(main)/feedback/[projectId]/page",u={require:t,loadChunk:()=>Promise.resolve()},h=new s.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/(main)/feedback/[projectId]/page",pathname:"/feedback/[projectId]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},2020:(e,a,t)=>{Promise.resolve().then(t.bind(t,4173))},4173:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>I});var s=t(326),r=t(7577),n=t(5047),l=t(9543),c=t(7967),i=t.n(c),o=t(3077),d=t(6803);let m=(e=0,a)=>{let[t,s]=(0,r.useState)(e),n=a?a[t]:null;return{currentTab:t,changeTab:e=>{s(e)},currentItem:n,changeItem:e=>{s(e)}}};var u=t(4099);let h=process.env.NEXT_PUBLIC_BACKEND_API_URL||process.env.REACT_APP_BACKEND_API_URL,p=u.Z.create({...h&&{baseURL:h},timeout:3e4,headers:{"Content-Type":"application/json"}});function x(e){let a=Error(e.response?.data?.message||e.message||"Unknown error");return a.code=e.response?.data?.code||"UNKNOWN_ERROR",a.status=e.response?.status,a.details=e.response?.data,a}async function b(e){try{let a=await p.get(`/feedbacks/${e}`);if(a.data.data?.result)return a.data.data.result;if(a.data.result)return a.data.result;throw Error("Invalid response format")}catch(e){throw x(e)}}async function j(e,a){try{let t=await p.put(`/feedbacks/${a}`,e);if(t.data.result)return t.data.result;throw Error("Invalid response format")}catch(e){throw x(e)}}async function g(e){try{await p.delete(`/feedbacks/${e}`)}catch(e){throw x(e)}}async function f(e,a,t){try{let s=new FormData;s.append("files",e);let r={headers:{"Content-Type":"multipart/form-data"},...t&&{onUploadProgress:t}};return(await p.post(`/feedbacks/${a}`,s,r)).data}catch(e){throw x(e)}}async function v(e){try{await p.delete(`/feedbacks/file/${e}`)}catch(e){throw x(e)}}p.interceptors.request.use(e=>{let a=localStorage.getItem("accessToken")||localStorage.getItem("token");return a&&(e.headers.Authorization=`Bearer ${a}`),e},e=>Promise.reject(e)),p.interceptors.response.use(e=>e,async e=>{let a=e.config;if(e.response?.status===401&&!a._retry){a._retry=!0;try{let e=localStorage.getItem("refreshToken");if(e){let{access:t}=(await u.Z.post(`${h}/auth/refresh/`,{refresh:e})).data;return localStorage.setItem("accessToken",t),a.headers.Authorization=`Bearer ${t}`,p(a)}}catch(e){return localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),window.location.href="/login",Promise.reject(e)}}return Promise.reject(x(e))});let k={MAX_MESSAGE_LENGTH:1e3,MAX_SECTION_LENGTH:10,MAX_FILE_SIZE:104857600,ALLOWED_VIDEO_TYPES:["video/mp4","video/webm","video/quicktime","video/x-msvideo"],SOCKET_RECONNECT_INTERVAL:3e3,MAX_RECONNECT_ATTEMPTS:5,SESSION_STORAGE_KEY:"feedback_chat_session"},{SESSION_STORAGE_KEY:N,SOCKET_RECONNECT_INTERVAL:y,MAX_RECONNECT_ATTEMPTS:_}=k,w={secret:!1,title:"",section:"",contents:""},C=(0,r.memo)(({project_id:e,refetch:a,onSubmit:t})=>{let{values:n,errors:l,isValid:c,isSubmitting:i,handleChange:o,handleSubmit:d,getFieldError:m}=function({onSubmit:e,initialValues:a={},validateOnChange:t=!1}){let[s,n]=(0,r.useState)({...w,...a}),[l,c]=(0,r.useState)({}),[i,o]=(0,r.useState)(!1),[d,m]=(0,r.useState)({secret:!1,title:!1,section:!1,contents:!1}),u=(0,r.useCallback)(e=>{let a=s[e],t="";switch(e){case"secret":!0!==a&&!1!==a&&"true"!==a&&"false"!==a&&(t="익명 여부를 선택해주세요.");break;case"section":if(a&&("string"!=typeof a||""!==a.trim())){var r;"string"!=typeof a||(r=a.trim(),/^(?:(?:([01]?\d|2[0-3]):)?([0-5]?\d):)?([0-5]?\d)$/.test(r))||(t="올바른 시간 형식을 입력해주세요. (예: 05:30)")}else t="구간을 입력해주세요.";break;case"contents":a&&("string"!=typeof a||""!==a.trim())?"string"==typeof a&&a.trim().length<2?t="내용은 최소 2자 이상 입력해주세요.":"string"==typeof a&&a.length>1e3&&(t="내용은 1000자를 초과할 수 없습니다."):t="내용을 입력해주세요."}return c(a=>({...a,[e]:t||void 0})),!t},[s]),h=(0,r.useCallback)(()=>{let e=Object.values({secret:u("secret"),title:u("title"),section:u("section"),contents:u("contents")}).every(Boolean);return e?c(e=>{let{general:a,...t}=e;return t}):c(e=>({...e,general:"입력란을 올바르게 채워주세요."})),e},[u]),p=(0,r.useCallback)((e,a)=>{n(t=>({...t,[e]:a})),m(a=>({...a,[e]:!0})),t&&setTimeout(()=>u(e),0)},[u,t]),x=(0,r.useCallback)(e=>{n(a=>({...a,...e}));let a=Object.keys(e);m(e=>{let t={...e};return a.forEach(e=>{t[e]=!0}),t})},[]),b=(0,r.useCallback)(()=>{n({...w,...a}),c({}),m({secret:!1,title:!1,section:!1,contents:!1}),o(!1);try{document.getElementsByName("secret").forEach(e=>{e.checked=!1})}catch(e){console.warn("Failed to reset radio buttons:",e)}},[a]),j=(0,r.useCallback)(async()=>{if(m({secret:!0,title:!0,section:!0,contents:!0}),h()){o(!0),c(e=>{let{general:a,...t}=e;return t});try{let a={secret:!0===s.secret||"true"===s.secret,title:s.title,section:s.section.toString().trim(),contents:s.contents.toString().trim()};await e(a),b()}catch(a){console.error("Form submission error:",a);let e=a instanceof Error?a.message:"피드백 등록 중 오류가 발생했습니다.";c(a=>({...a,general:e}))}finally{o(!1)}}},[s,h,e,b]),g=(0,r.useMemo)(()=>{let e=(!0===s.secret||!1===s.secret||"true"===s.secret||"false"===s.secret)&&""!==s.section.toString().trim()&&""!==s.contents.toString().trim(),a=0===Object.keys(l).length||1===Object.keys(l).length&&l.general;return!!(e&&a)},[s,l]),f=(0,r.useCallback)(e=>d[e]&&l[e],[d,l]),v=(0,r.useCallback)(e=>f(e)?l[e]:void 0,[f,l]),k=(0,r.useMemo)(()=>i?"submitting":g?Object.values(d).some(Boolean)?"dirty":"pristine":"invalid",[i,g,d]);return{values:s,errors:l,isValid:g,isSubmitting:i,handleChange:p,handleSubmit:j,reset:b,setValues:x,validateField:u,validateForm:h,touched:d,shouldShowError:f,getFieldError:v,formStatus:k}}({onSubmit:async e=>{t&&await t(e),a()},validateOnChange:!0}),{secret:u,section:h,contents:p}=n,x=e=>{o("secret","true"===e.target.value)},b=e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),d())};return(0,s.jsxs)("div",{className:"form",children:[(0,s.jsxs)("div",{className:"flex align_center",children:[(0,s.jsxs)("div",{children:[s.jsx("input",{type:"radio",id:"user_type_anonymous",name:"secret",value:"true",checked:!0===u||"true"===u,onChange:x,className:"ty02","aria-label":"익명으로 피드백 등록"}),s.jsx("label",{htmlFor:"user_type_anonymous",children:"익명"})]}),(0,s.jsxs)("div",{children:[s.jsx("input",{type:"radio",id:"user_type_normal",name:"secret",value:"false",checked:!1===u||"false"===u,onChange:x,className:"ty02","aria-label":"일반으로 피드백 등록"}),s.jsx("label",{htmlFor:"user_type_normal",children:"일반"})]})]}),m("secret")&&s.jsx("div",{className:"error-message mt10",role:"alert",children:m("secret")}),(0,s.jsxs)("div",{className:"input-group mt20",children:[s.jsx("input",{type:"text",name:"section",value:h,placeholder:"구간 입력 (예: 05:30)",onChange:e=>o("section",e.target.value),onKeyDown:b,className:`ty01 ${m("section")?"error":""}`,maxLength:10,"aria-label":"피드백 구간 타임스탬프","aria-describedby":m("section")?"section-error":void 0}),m("section")&&s.jsx("div",{id:"section-error",className:"error-message mt5",role:"alert",children:m("section")})]}),(0,s.jsxs)("div",{className:"input-group mt20",children:[s.jsx("input",{type:"text",name:"contents",value:p,placeholder:"내용 입력",onChange:e=>o("contents",e.target.value),onKeyDown:b,className:`ty01 ${m("contents")?"error":""}`,maxLength:1e3,"aria-label":"피드백 내용","aria-describedby":m("contents")?"contents-error":void 0}),m("contents")&&s.jsx("div",{id:"contents-error",className:"error-message mt5",role:"alert",children:m("contents")})]}),l.general&&s.jsx("div",{className:"error-message mt20",role:"alert",children:l.general}),s.jsx("button",{onClick:d,disabled:!c||i,className:`submit mt40 ${i?"loading":""}`,"aria-label":"피드백 등록",children:i?"등록 중...":"피드백 등록"}),s.jsx("div",{className:"sr-only","aria-live":"polite",children:i&&"피드백을 등록하고 있습니다. 잠시만 기다려주세요."})]})});C.displayName="FeedbackInput";let S=(0,r.memo)(({projectId:e,currentUser:a,onMessage:t})=>{let[n,l]=(0,r.useState)(""),c=(0,r.useRef)(null),i=(0,r.useRef)(null),{connected:o,messages:d,sendMessage:m,reconnecting:u}=function({projectId:e,autoReconnect:a=!0,onConnect:t,onDisconnect:s,onError:n,onMessage:l}){let c=(0,r.useRef)(null),i=(0,r.useRef)(null),o=(0,r.useRef)(0),d=(0,r.useRef)(!0),[m,u]=(0,r.useState)(!1),[h,p]=(0,r.useState)([]),[x,b]=(0,r.useState)(!1),j=(0,r.useCallback)(()=>{try{let a=sessionStorage.getItem(N);if(a){let t=JSON.parse(a);t.id===e&&Array.isArray(t.items)&&p(t.items)}}catch(e){console.warn("Failed to load messages from session storage:",e)}},[e]),g=(0,r.useCallback)(a=>{try{if(a.length>0){let t={id:e,items:a,lastUpdated:new Date().toISOString()};sessionStorage.setItem(N,JSON.stringify(t))}}catch(e){console.warn("Failed to save messages to session storage:",e)}},[e]),f=(0,r.useCallback)(()=>{i.current&&(clearTimeout(i.current),i.current=null),c.current&&(c.current.close(),c.current=null),u(!1),b(!1)},[]),v=(0,r.useCallback)(()=>{if(d.current&&a){if(o.current>=_){console.error("Max reconnection attempts reached"),b(!1);return}b(!0),i.current=setTimeout(()=>{d.current&&(o.current+=1,console.log(`Attempting to reconnect... (${o.current}/${_})`),w())},y)}},[a]),w=(0,r.useCallback)(()=>{if(e&&c.current?.readyState!==WebSocket.OPEN){f();try{let r=function(e){let a=process.env.NEXT_PUBLIC_SOCKET_URI||process.env.REACT_APP_SOCKET_URI;return`${a}/ws/chat/${e}/`}(e);c.current=new WebSocket(r),c.current.onopen=()=>{d.current&&(console.log("WebSocket connected to:",r),u(!0),b(!1),o.current=0,j(),t?.())},c.current.onmessage=e=>{if(d.current)try{let a=JSON.parse(e.data).result;a&&(p(e=>{let t=[...e,a];return g(t),t}),l?.(a))}catch(e){console.error("Failed to parse WebSocket message:",e)}},c.current.onclose=e=>{d.current&&(console.log("WebSocket disconnected:",e.code,e.reason),u(!1),s?.(),1e3!==e.code&&a&&d.current&&v())},c.current.onerror=e=>{d.current&&(console.error("WebSocket error:",e),u(!1),n?.(e),a&&d.current&&v())}}catch(e){console.error("Failed to create WebSocket connection:",e),a&&d.current&&v()}}},[e,f,j,g,t,s,n,l,a,v]),C=(0,r.useCallback)(e=>{if(!c.current||c.current.readyState!==WebSocket.OPEN){alert("채팅 서버가 불안정합니다. 재접속 해주세요.");return}if(e.message&&e.message.trim()){if(e.message.length>k.MAX_MESSAGE_LENGTH){alert(`메시지는 ${k.MAX_MESSAGE_LENGTH}자를 초과할 수 없습니다.`);return}try{let a={email:e.email,nickname:e.nickname,rating:e.rating,message:e.message.trim()};c.current.send(JSON.stringify(a))}catch(e){console.error("Failed to send message:",e),alert("메시지 전송에 실패했습니다.")}}},[]),S=(0,r.useCallback)(()=>{p([]);try{sessionStorage.removeItem(N)}catch(e){console.warn("Failed to clear session storage:",e)}},[]),E=(0,r.useCallback)(()=>{if(!c.current)return"disconnected";switch(c.current.readyState){case WebSocket.CONNECTING:return"connecting";case WebSocket.OPEN:return"connected";case WebSocket.CLOSING:return"closing";case WebSocket.CLOSED:return"disconnected";default:return"unknown"}},[]);return{connected:m,messages:h,reconnecting:x,sendMessage:C,connect:w,disconnect:f,clearMessages:S,ws:c,connectionStatus:E()}}({projectId:e,...t&&{onMessage:t}}),h=(0,r.useCallback)(()=>{let e=n.trim();if(!o){alert("채팅 서버가 불안정합니다. 재접속 해주세요.");return}if(!a){alert("로그인이 필요합니다.");return}e&&(m({email:a.email,nickname:a.nickname,rating:a.rating,message:e}),l(""),setTimeout(()=>{i.current?.focus()},0))},[n,o,a,m]),p=(0,r.useCallback)(e=>{"Enter"===e.key&&(e.preventDefault(),h())},[h]),x=(0,r.useCallback)(()=>{c.current&&c.current.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},[]);(0,r.useEffect)(()=>{x()},[d,x]);let b=(0,r.useCallback)(e=>"manager"===e?"관리자":"일반",[]),j=()=>u?"재연결 중...":o?"연결됨":"연결 끊김";return(0,s.jsxs)(s.Fragment,{children:[s.jsx("div",{className:`connection-status ${o?"connected":"disconnected"}`,children:s.jsx("span",{className:"status-indicator","aria-label":`채팅 상태: ${j()}`,children:j()})}),s.jsx("div",{className:"comment",role:"log","aria-live":"polite","aria-label":"채팅 메시지",children:(0,s.jsxs)("ul",{children:[d.length>0?d.map((e,t)=>(0,s.jsxs)("li",{className:`message-item ${e.email===a?.email?"own-message":""}`,children:[(0,s.jsxs)("div",{className:"flex align_center",children:[s.jsx("div",{className:"관리자"===b(e.rating)?"img_box admin":"img_box basic","aria-hidden":"true"}),(0,s.jsxs)("div",{className:"txt_box",children:[(0,s.jsxs)("span",{className:"name",children:[e.nickname,(0,s.jsxs)("small",{className:"관리자"===b(e.rating)?"admin":"basic",children:["(",b(e.rating),")"]})]}),s.jsx("span",{className:"email",children:e.email})]})]}),s.jsx("div",{className:"comment_box",children:e.message})]},`${e.id||t}-${e.email}-${t}`)):s.jsx("li",{className:"empty",children:s.jsx("div",{className:"empty-message",children:"웹페이지를 닫을 경우 대화 내용은 저장되지 않습니다."})}),s.jsx("div",{ref:c})]})}),a&&(0,s.jsxs)("div",{className:"pr",children:[(0,s.jsxs)("div",{className:"input-container",children:[s.jsx("input",{ref:i,type:"text",value:n,onChange:e=>l(e.target.value),onKeyUp:p,placeholder:o?"채팅 입력":"연결 중...",className:"ty01",style:{padding:"0 120px 0 15px"},disabled:!o||!a,maxLength:1e3,"aria-label":"채팅 메시지 입력","aria-describedby":"send-button"}),s.jsx("button",{id:"send-button",onClick:h,disabled:!o||!a||!n.trim(),className:"cert","aria-label":"메시지 전송",children:"입력"})]}),!o&&s.jsx("div",{className:"input-status error",role:"alert",children:"채팅 서버 연결 중입니다. 잠시만 기다려주세요."}),o&&n.length>900&&(0,s.jsxs)("div",{className:"input-status warning",role:"alert",children:[1e3-n.length,"자 남음"]})]}),!a&&s.jsx("div",{className:"login-required",role:"alert",children:"채팅에 참여하려면 로그인이 필요합니다."}),(0,s.jsxs)("div",{className:"sr-only","aria-live":"polite",children:[u&&"채팅 서버에 재연결하고 있습니다.",!o&&!u&&"채팅 서버 연결이 끊어졌습니다."]})]})});S.displayName="FeedbackMessage";let E=(0,r.memo)(({currentProject:e,currentUser:a,onDeleteFeedback:t,loading:n=!1})=>{let[l,c]=(0,r.useState)(new Set),i=(0,r.useMemo)(()=>e?.feedback&&a?e.feedback.filter(e=>e.email===a):[],[e?.feedback,a]),o=(0,r.useCallback)(async e=>{if(!l.has(e))try{c(a=>new Set(a).add(e)),await t(e)}catch(a){console.error("Failed to delete feedback:",a),c(a=>{let t=new Set(a);return t.delete(e),t})}finally{setTimeout(()=>{c(a=>{let t=new Set(a);return t.delete(e),t})},1e3)}},[t,l]),d=(0,r.useCallback)(e=>{if(/^\d{1,2}:\d{2}$/.test(e))return e;let a=e.replace(/\D/g,"");return a.length<=2?a:a.length<=4?`${a.slice(0,2)}:${a.slice(2)}`:e},[]);return n?s.jsx("div",{className:"history loading",children:(0,s.jsxs)("div",{className:"loading-indicator",children:[s.jsx("div",{className:"spinner"}),s.jsx("span",{children:"피드백을 불러오는 중..."})]})}):(0,s.jsxs)("div",{className:"history",children:[s.jsx("ul",{children:i.length>0?i.map(e=>{let a=l.has(e.id);return s.jsx("li",{className:`feedback-item ${a?"deleting":""}`,children:(0,s.jsxs)("div",{className:"flex align_center space_between",children:[(0,s.jsxs)("div",{className:"txt_box",children:[s.jsx("div",{className:"time",children:d(e.section)}),s.jsx("p",{className:"feedback-content",children:e.text||e.contents}),(0,s.jsxs)("div",{className:"metadata",children:[s.jsx("small",{className:"created-date",children:new Date(e.created).toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),(e.secret||e.security)&&s.jsx("span",{className:"anonymous-badge",children:"익명"})]})]}),s.jsx("button",{onClick:()=>o(e.id),disabled:a,className:`delete ${a?"loading":""}`,"aria-label":`피드백 삭제: ${d(e.section)}`,children:a?(0,s.jsxs)(s.Fragment,{children:[s.jsx("span",{className:"spinner-small"}),"삭제 중..."]}):"삭제"})]})},e.id)}):s.jsx("li",{className:"empty-state",children:(0,s.jsxs)("div",{className:"flex mt50 justify_center flex_column align_center",children:[s.jsx("div",{className:"empty-icon"}),s.jsx("p",{className:"empty-message",children:"작성한 피드백이 없습니다."}),s.jsx("small",{className:"empty-description",children:"피드백 등록 탭에서 새로운 피드백을 작성해보세요."})]})})}),i.length>0&&s.jsx("div",{className:"feedback-stats",children:(0,s.jsxs)("div",{className:"stats-item",children:[s.jsx("span",{className:"stats-label",children:"총 피드백"}),(0,s.jsxs)("span",{className:"stats-value",children:[i.length,"개"]})]})}),s.jsx("div",{className:"sr-only","aria-live":"polite",children:Array.from(l).length>0&&`${Array.from(l).length}개의 피드백을 삭제하고 있습니다.`})]})});E.displayName="FeedbackManage";let D=(0,r.memo)(({currentProject:e,onTimestampClick:a})=>{let[t,n]=(0,r.useState)(null),l=(0,r.useMemo)(()=>{if(!e?.feedback)return[];let a={};return e.feedback.forEach(e=>{let t=i()(e.created).format("YYYY.MM.DD.dd");a[t]?a[t].push(e):a[t]=[e]}),Object.entries(a).map(([e,a])=>({date:e,feedbacks:a.sort((e,a)=>new Date(a.created).getTime()-new Date(e.created).getTime())})).sort((e,a)=>i()(a.date,"YYYY.MM.DD.dd").valueOf()-i()(e.date,"YYYY.MM.DD.dd").valueOf())},[e?.feedback]),c=(0,r.useCallback)(e=>{n(e),a&&a(e.section)},[a]),o=(0,r.useCallback)(e=>{e.stopPropagation(),n(null)},[]),d=(0,r.useCallback)((e,a)=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),c(a))},[c]),m=(0,r.useCallback)(e=>{"Escape"===e.key&&n(null)},[]),u=(0,r.useCallback)(e=>{if(/^\d{1,2}:\d{2}$/.test(e))return e;let a=e.replace(/\D/g,"");return a.length<=2?a:a.length<=4?`${a.slice(0,2)}:${a.slice(2)}`:e},[]),h=(0,r.useCallback)(e=>"manager"===e?"관리자":"일반",[]);return 0===l.length?s.jsx("div",{className:"feedback-empty",children:(0,s.jsxs)("div",{className:"empty-state",children:[s.jsx("div",{className:"empty-icon"}),s.jsx("p",{children:"등록된 피드백이 없습니다."}),s.jsx("small",{children:"첫 번째 피드백을 등록해보세요."})]})}):(0,s.jsxs)(s.Fragment,{children:[l.map((e,a)=>(0,s.jsxs)("div",{className:"box",children:[s.jsx("div",{className:"day",children:e.date}),s.jsx("ul",{children:e.feedbacks.map((e,a)=>(0,s.jsxs)("li",{className:`feedback-timestamp ${t&&t.id===e.id?"on":""}`,onClick:()=>c(e),onKeyDown:a=>d(a,e),tabIndex:0,role:"button","aria-label":`피드백: ${u(e.section)} - ${e.nickname}`,"aria-expanded":t?.id===e.id,children:[s.jsx("span",{className:"timestamp-text",children:u(e.section)}),(e.secret||e.security)&&s.jsx("span",{className:"anonymous-indicator","aria-label":"익명",children:"\uD83D\uDD12"}),t&&t.id===e.id&&(0,s.jsxs)("div",{className:"view-container",onKeyDown:m,role:"dialog","aria-modal":"true","aria-labelledby":`feedback-title-${e.id}`,"aria-describedby":`feedback-content-${e.id}`,children:[s.jsx("div",{className:"view",children:(0,s.jsxs)("div",{children:[s.jsx("div",{className:"txt_box",children:t.security||t.secret?(0,s.jsxs)(s.Fragment,{children:[s.jsx("span",{className:"name",id:`feedback-title-${e.id}`,children:"익명"}),s.jsx("span",{className:"timestamp",children:u(t.section)})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("span",{className:"name",id:`feedback-title-${e.id}`,children:[t.nickname,(0,s.jsxs)("small",{className:"관리자"===h(t.rating)?"admin":"basic",children:["(",h(t.rating),")"]})]}),s.jsx("span",{className:"email",children:t.email}),s.jsx("span",{className:"timestamp",children:u(t.section)})]})}),s.jsx("div",{className:"comment_box",id:`feedback-content-${e.id}`,children:t.text||t.contents}),s.jsx("div",{className:"feedback-meta",children:s.jsx("small",{className:"created-time",children:i()(t.created).format("YYYY년 MM월 DD일 HH:mm")})})]})}),s.jsx("button",{className:"close-button",onClick:o,"aria-label":"피드백 상세보기 닫기",autoFocus:!0,children:"✕"})]})]},`${e.id}-${a}`))})]},e.date)),(0,s.jsxs)("div",{className:"feedback-summary",children:[(0,s.jsxs)("div",{className:"summary-item",children:[s.jsx("span",{className:"summary-label",children:"총 피드백"}),(0,s.jsxs)("span",{className:"summary-value",children:[l.reduce((e,a)=>e+a.feedbacks.length,0),"개"]})]}),(0,s.jsxs)("div",{className:"summary-item",children:[s.jsx("span",{className:"summary-label",children:"활동 일수"}),(0,s.jsxs)("span",{className:"summary-value",children:[l.length,"일"]})]})]}),s.jsx("div",{className:"sr-only","aria-live":"polite",children:t&&`${t.nickname}의 피드백이 열렸습니다. ESC 키를 눌러 닫을 수 있습니다.`})]})});D.displayName="FeedbackMore";let $=(0,r.memo)(({url:e,SetVideoLoad:a,onTimeUpdate:t,onSeek:n,onPlay:l,onPause:c,onLoadStart:i,onError:o,seekTime:d,className:m="",controls:u=!0,autoPlay:h=!1,muted:p=!1})=>{let x=(0,r.useRef)(null),[b,j]=(0,r.useState)(0),[g,f]=(0,r.useState)(0),[v,k]=(0,r.useState)(!1),[N,y]=(0,r.useState)(1),[_,w]=(0,r.useState)(null);(0,r.useEffect)(()=>{x.current&&e&&x.current.load()},[e]),(0,r.useEffect)(()=>{x.current&&"number"==typeof d&&d>=0&&(x.current.currentTime=d,n?.(d))},[d,n]);let C=(0,r.useCallback)(()=>{if(x.current){let e=x.current.currentTime;j(e),t?.(e)}},[t]),S=(0,r.useCallback)(()=>{x.current&&f(x.current.duration)},[]),E=(0,r.useCallback)(()=>{a(!1),w(null)},[a]),D=(0,r.useCallback)(()=>{a(!0),i?.()},[a,i]),$=(0,r.useCallback)(()=>{k(!0),l?.()},[l]),I=(0,r.useCallback)(()=>{k(!1),c?.()},[c]),M=(0,r.useCallback)(e=>{let t=e.target,s=t.error?`비디오 로드 오류 (코드: ${t.error.code})`:"알 수 없는 비디오 오류";w(s),a(!1);let r=Error(s);o?.(r),console.error("Video error:",t.error)},[a,o]),P=(0,r.useCallback)(()=>{x.current&&y(x.current.volume)},[]),T=(0,r.useCallback)(e=>{if(isNaN(e))return"00:00";let a=Math.floor(e/3600),t=Math.floor(e%3600/60),s=Math.floor(e%60);return a>0?`${a.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:`${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`},[]),F=(0,r.useCallback)(e=>{if(!x.current||!g)return;let a=e.currentTarget.getBoundingClientRect(),t=(e.clientX-a.left)/a.width*g;x.current.currentTime=t,n?.(t)},[g,n]),A=(0,r.useCallback)(e=>{if(x.current)switch(e.key){case" ":e.preventDefault(),v?x.current.pause():x.current.play();break;case"ArrowLeft":e.preventDefault(),x.current.currentTime=Math.max(0,b-5);break;case"ArrowRight":e.preventDefault(),x.current.currentTime=Math.min(g,b+5);break;case"ArrowUp":e.preventDefault(),x.current.volume=Math.min(1,N+.1);break;case"ArrowDown":e.preventDefault(),x.current.volume=Math.max(0,N-.1)}},[v,b,g,N]);return _?s.jsx("div",{className:`video-error ${m}`,children:(0,s.jsxs)("div",{className:"error-content",children:[s.jsx("div",{className:"error-icon",children:"⚠️"}),s.jsx("p",{className:"error-message",children:_}),s.jsx("button",{className:"retry-button",onClick:()=>{w(null),x.current&&x.current.load()},children:"다시 시도"})]})}):(0,s.jsxs)("div",{className:`video-player-container ${m}`,children:[(0,s.jsxs)("video",{ref:x,width:"100%",height:"100%",controls:u,autoPlay:h,muted:p,controlsList:"nodownload",onTimeUpdate:C,onLoadedMetadata:S,onLoadedData:E,onLoadStart:D,onPlay:$,onPause:I,onError:M,onVolumeChange:P,onKeyDown:A,tabIndex:0,"aria-label":"피드백 비디오 플레이어",children:[s.jsx("source",{src:e,type:"video/mp4"}),s.jsx("source",{src:e,type:"video/webm"}),s.jsx("source",{src:e,type:"video/quicktime"}),s.jsx("source",{src:e,type:"video/ogg"}),s.jsx("source",{src:e,type:"video/x-msvideo"}),s.jsx("source",{src:e,type:"video/x-mplayer2"}),s.jsx("track",{kind:"captions",src:"",srcLang:"ko",label:"한국어"}),(0,s.jsxs)("div",{className:"video-fallback",children:[s.jsx("p",{children:"이 브라우저는 비디오 재생을 지원하지 않습니다."}),s.jsx("a",{href:e,download:!0,children:"비디오 다운로드"})]})]}),!u&&(0,s.jsxs)("div",{className:"custom-controls",children:[s.jsx("div",{className:"progress-container",onClick:F,children:s.jsx("div",{className:"progress-bar",children:s.jsx("div",{className:"progress-filled",style:{width:`${g?b/g*100:0}%`}})})}),(0,s.jsxs)("div",{className:"control-buttons",children:[s.jsx("button",{className:"play-pause-btn",onClick:()=>{x.current&&(v?x.current.pause():x.current.play())},"aria-label":v?"일시정지":"재생",children:v?"⏸️":"▶️"}),(0,s.jsxs)("span",{className:"time-display",children:[T(b)," / ",T(g)]})]})]}),(0,s.jsxs)("div",{className:"sr-only","aria-live":"polite",children:["현재 재생 시간: ",T(b),void 0!==d&&`${T(d)}로 이동했습니다.`]})]})});function I({params:e}){let a=(0,n.useRouter)(),{projectId:t}=e,{user:c}=(0,l.v9)(e=>e.ProjectStore),[u,h]=(0,r.useState)(!1),[p,x]=(0,r.useState)(void 0),k=(0,r.useRef)(null),{currentProject:N,feedbacks:y,loading:_,error:w,createFeedback:I,deleteFeedback:M,uploadVideo:P,deleteVideo:T,refetch:F,permissions:A,currentUser:O}=function(e){let a=(0,n.useRouter)(),{user:t}=(0,l.v9)(e=>e.ProjectStore),[s,c]=(0,r.useState)(null),[i,o]=(0,r.useState)(!1),[d,m]=(0,r.useState)(null),[u,h]=(0,r.useState)(0),p=(0,r.useMemo)(()=>s?.feedback||[],[s]),x=(0,r.useMemo)(()=>{if(!s||!t)return{canManageFeedback:!1,canDeleteFeedback:!1,canUploadVideo:!1,canDeleteVideo:!1,canEditProject:!1,role:"basic"};let e=function(e,a){let t=e.owner_email===a,s=e.member_list.find(e=>e.email===a),r=t||s?.rating==="manager";return{isOwner:t,isManager:r,canManageFeedback:r,canDeleteFeedback:r,canUploadVideo:r,canDeleteVideo:r}}(s,t),a=e.isOwner,r=e.isManager;return{canManageFeedback:r,canDeleteFeedback:r,canUploadVideo:r,canDeleteVideo:r,canEditProject:r,role:a?"owner":r?"manager":"basic"}},[s,t]),k=(0,r.useCallback)(e=>{console.error("Feedback error:",e),m(e instanceof Error&&(({"Network Error":"네트워크 연결을 확인해주세요.","Invalid token":"로그인이 만료되었습니다. 다시 로그인해주세요.","Permission denied":"권한이 없습니다.","File too large":"파일 크기가 너무 큽니다.","Invalid file type":"지원하지 않는 파일 형식입니다.","Project not found":"프로젝트를 찾을 수 없습니다.","Feedback not found":"피드백을 찾을 수 없습니다."})[e.message]||e.message)||"알 수 없는 오류가 발생했습니다."),e?.status===401&&a.push("/login")},[a]),N=(0,r.useCallback)(e=>{m(null),window.alert&&window.alert(e)},[]),y=(0,r.useCallback)(async a=>{let t=a||e;if(t){o(!0),m(null);try{let e=await b(t);c(e)}catch(e){k(e)}finally{o(!1)}}},[e,k]),_=(0,r.useCallback)(async a=>{if(!e)throw Error("프로젝트 ID가 필요합니다.");o(!0),m(null);try{await j(a,e),N("피드백이 등록되었습니다."),await y()}catch(e){throw k(e),e}finally{o(!1)}},[e,y,k,N]),w=(0,r.useCallback)(async e=>{if(!x.canDeleteFeedback)throw Error("피드백을 삭제할 권한이 없습니다.");if(window.confirm("정말로 이 피드백을 삭제하시겠습니까?")){o(!0),m(null);try{await g(e),N("피드백이 삭제되었습니다."),await y()}catch(e){throw k(e),e}finally{o(!1)}}},[x.canDeleteFeedback,y,k,N]),C=(0,r.useCallback)(async a=>{if(!x.canUploadVideo)throw Error("비디오를 업로드할 권한이 없습니다.");if(!e)throw Error("프로젝트 ID가 필요합니다.");if(window.confirm("파일을 업로드 하시겠습니까?")){o(!0),m(null);try{await f(a,e,e=>{let a=Math.round(100*e.loaded/e.total);console.log(`Upload progress: ${a}%`)}),N("파일이 업로드되었습니다."),await y()}catch(e){throw k(e),e}finally{o(!1)}}},[x.canUploadVideo,e,y,k,N]),S=(0,r.useCallback)(async()=>{if(!x.canDeleteVideo)throw Error("비디오를 삭제할 권한이 없습니다.");if(!e)throw Error("프로젝트 ID가 필요합니다.");if(window.confirm("파일을 삭제 하시겠습니까?")){o(!0),m(null);try{await v(e),N("파일이 삭제되었습니다."),await y()}catch(e){throw k(e),e}finally{o(!1)}}},[x.canDeleteVideo,e,y,k,N]),E=(0,r.useCallback)(()=>{h(Date.now())},[]),D=(0,r.useMemo)(()=>{if(!s||!t)return null;if(s.owner_email===t)return{email:s.owner_email,nickname:s.owner_nickname,rating:"manager"};let e=s.member_list.find(e=>e.email===t);return e?{email:e.email,nickname:e.nickname,rating:e.rating}:null},[s,t]);return{currentProject:s,feedbacks:p,loading:i,error:d,fetchProject:y,createFeedback:_,deleteFeedback:w,uploadVideo:C,deleteVideo:S,refetch:E,permissions:x,currentUser:D}}(t),L=(0,r.useMemo)(()=>{if(!N||!c)return null;if(N.owner_email===c)return{email:N.owner_email,nickname:N.owner_nickname,rating:"manager"};let e=N.member_list.find(e=>e.email===c);return e?{email:e.email,nickname:e.nickname,rating:e.rating}:null},[N,c]),R=(0,r.useCallback)(e=>"manager"===e?"관리자":"일반",[]),U=(0,r.useCallback)(async e=>{let a=e.target.files?.[0];if(a)try{await P(a)}catch(e){console.error("File upload error:",e)}finally{e.target.value=""}},[P]),V=(0,r.useCallback)(async()=>{try{await T()}catch(e){console.error("File delete error:",e)}},[T]),Y=(0,r.useCallback)(e=>{navigator.clipboard?navigator.clipboard.writeText(e).then(()=>{alert("링크가 복사되었습니다.")}).catch(()=>{q(e)}):q(e)},[]),q=e=>{let a=document.createElement("textarea");a.value=e,document.body.appendChild(a),a.focus(),a.select();try{document.execCommand("copy"),alert("링크가 복사되었습니다.")}catch(e){console.error("Unable to copy:",e),alert("링크 복사에 실패했습니다.")}document.body.removeChild(a)},K=(0,r.useCallback)(e=>{let a=e.split(":").map(Number),t=0;2===a.length&&void 0!==a[0]&&void 0!==a[1]?t=60*a[0]+a[1]:3===a.length&&void 0!==a[0]&&void 0!==a[1]&&void 0!==a[2]&&(t=3600*a[0]+60*a[1]+a[2]),x(t),k.current&&k.current.scrollIntoView({behavior:"smooth"})},[]),G=(0,r.useCallback)(e=>{console.log("New chat message:",e)},[]),W=(0,r.useMemo)(()=>[{tab:"코멘트",content:N&&L&&s.jsx(S,{projectId:t,currentUser:L,onMessage:G})},{tab:"피드백 등록",content:s.jsx(C,{project_id:t,refetch:F,onSubmit:I})},{tab:"피드백 관리",content:N&&c&&s.jsx(E,{currentProject:N,currentUser:c,onDeleteFeedback:M,loading:_})},{tab:"멤버",content:N&&s.jsx("div",{className:"member",children:(0,s.jsxs)("ul",{children:[(0,s.jsxs)("li",{className:"admin",children:[s.jsx("div",{className:"img"}),(0,s.jsxs)("div",{className:"txt",children:[N.owner_nickname,"(관리자)",s.jsx("span",{children:N.owner_email})]})]}),N.member_list.map((e,a)=>(0,s.jsxs)("li",{className:"manager"===e.rating?"admin":"basic",children:[s.jsx("div",{className:"img"}),(0,s.jsxs)("div",{className:"txt",children:[e.nickname,"(",R(e.rating),")",s.jsx("span",{children:e.email})]})]},`${e.email}-${a}`))]})})},{tab:"프로젝트 정보",content:N&&(0,s.jsxs)("div",{className:"info",children:[(0,s.jsxs)("dl",{className:"flex align_center",children:[s.jsx("dt",{children:"담당자"}),s.jsx("dd",{children:N.manager})]}),(0,s.jsxs)("dl",{className:"flex align_center",children:[s.jsx("dt",{children:"고객사"}),s.jsx("dd",{children:N.consumer})]}),(0,s.jsxs)("dl",{className:"flex align_center",children:[s.jsx("dt",{children:"프로젝트 생성"}),s.jsx("dd",{children:i()(N.created).format("YYYY.MM.DD.dd")})]}),(0,s.jsxs)("dl",{className:"flex align_center",children:[s.jsx("dt",{children:"최종 업데이트"}),s.jsx("dd",{children:i()(N.updated).format("YYYY.MM.DD.dd")})]}),(0,s.jsxs)("dl",{children:[s.jsx("dt",{children:"프로젝트 세부 설명"}),s.jsx("dd",{className:"mt10",children:N.description})]}),A.canEditProject&&s.jsx("button",{className:"project_btn",onClick:()=>a.push(`/projects/${t}/edit`),children:"프로젝트 관리"})]})}],[N,L,t,G,F,I,c,M,_,R,A.canEditProject,a]),{currentItem:Z,changeItem:B}=m(0,W)||{currentItem:null,changeItem:()=>{}};return _&&!N?s.jsx(o.Z,{leftItems:[],auth:!1,props:{},noLogin:!1,children:(0,s.jsxs)("div",{className:"cms_wrap",children:[s.jsx(d.Z,{tab:"feedback",on_menu:!1}),s.jsx("main",{children:(0,s.jsxs)("div",{className:"loading-container",children:[s.jsx("div",{className:"loading-spinner"}),s.jsx("p",{children:"프로젝트를 불러오는 중..."})]})})]})}):w?s.jsx(o.Z,{leftItems:[],auth:!1,props:{},noLogin:!1,children:(0,s.jsxs)("div",{className:"cms_wrap",children:[s.jsx(d.Z,{tab:"feedback",on_menu:!1}),s.jsx("main",{children:(0,s.jsxs)("div",{className:"error-container",children:[s.jsx("div",{className:"error-icon",children:"⚠️"}),s.jsx("h2",{children:"오류가 발생했습니다"}),s.jsx("p",{children:w}),s.jsx("button",{onClick:()=>F(),className:"retry-button",children:"다시 시도"})]})})]})}):N?s.jsx(o.Z,{leftItems:[],auth:!1,props:{},noLogin:!1,children:(0,s.jsxs)("div",{className:"cms_wrap",children:[s.jsx(d.Z,{tab:"feedback",on_menu:!1}),s.jsx("main",{children:(0,s.jsxs)("div",{className:"content feedback flex space_between",children:[(0,s.jsxs)("div",{className:"videobox",children:[(0,s.jsxs)("div",{ref:k,className:N.files?"video_inner active":"video_inner",children:[N.files?s.jsx($,{url:N.files,SetVideoLoad:h,seekTime:p||0,onSeek:()=>x(void 0),className:"feedback-video"}):A.canUploadVideo&&(0,s.jsxs)("div",{className:"upload_btn_wrap",children:[s.jsx("input",{type:"file",accept:"video/*",onChange:U,className:"video_upload",id:"video-upload",name:"files"}),s.jsx("label",{htmlFor:"video-upload",className:"video_upload_label",children:s.jsx("div",{children:"영상 추가"})})]}),u&&s.jsx("div",{className:"loading",children:s.jsx("div",{className:"animation"})})]}),(0,s.jsxs)("div",{className:"etc_box",children:[(0,s.jsxs)("div",{className:"flex space_between align_center",children:[s.jsx("button",{onClick:()=>a.push("/feedback/all",{}),className:"all",children:"피드백 전체 보기"}),A.canUploadVideo&&N.files&&(0,s.jsxs)("div",{className:"good",children:[(0,s.jsxs)("div",{className:"change_btn_wrap",children:[s.jsx("input",{type:"file",accept:"video/*",onChange:U,name:"files",className:"video_upload",id:"video-change"}),s.jsx("label",{htmlFor:"video-change",className:"video_upload_label",children:s.jsx("div",{children:"교체"})})]}),s.jsx("div",{className:"change_btn_wrap",children:s.jsx("div",{className:"video_upload_label",children:s.jsx("div",{onClick:V,className:"delete",children:"삭제"})})})]}),N.files&&s.jsx("div",{onClick:()=>Y(N.files),className:"share",role:"button",tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),Y(N.files))},children:"공유"})]}),s.jsx("div",{className:"list",children:s.jsx(D,{currentProject:N,onTimestampClick:K})})]})]}),(0,s.jsxs)("div",{className:"sidebox",children:[s.jsx("div",{className:"b_title",children:s.jsx("div",{className:"s_title",children:Z.tab})}),(0,s.jsxs)("div",{className:"top_box",children:[s.jsx("ul",{className:"tab_menu",children:W.map((e,a)=>s.jsx("li",{className:Z.tab===e.tab?"active":"",onClick:()=>B(a),role:"button",tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),B(a))},children:e.tab},a))}),s.jsx("div",{className:"edit"})]}),s.jsx("div",{className:"tab_content",children:Z.content})]})]})})]})}):s.jsx(o.Z,{leftItems:[],auth:!1,props:{},noLogin:!1,children:(0,s.jsxs)("div",{className:"cms_wrap",children:[s.jsx(d.Z,{tab:"feedback",on_menu:!1}),s.jsx("main",{children:(0,s.jsxs)("div",{className:"not-found-container",children:[s.jsx("div",{className:"not-found-icon",children:"\uD83D\uDCC2"}),s.jsx("h2",{children:"프로젝트를 찾을 수 없습니다"}),s.jsx("p",{children:"요청하신 프로젝트가 존재하지 않거나 접근 권한이 없습니다."}),s.jsx("button",{onClick:()=>a.push("/projects"),className:"back-button",children:"프로젝트 목록으로 돌아가기"})]})})]})})}$.displayName="VideoPlayer"},5635:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>s});let s=(0,t(8570).createProxy)(String.raw`C:\Users\유석근PD\Desktop\developments\Videoplanet\app\(main)\feedback\[projectId]\page.tsx#default`)}};var a=require("../../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),s=a.X(0,[223,399,70,531],()=>t(8364));module.exports=s})();
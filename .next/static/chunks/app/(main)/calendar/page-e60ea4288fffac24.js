(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{52606:function(e,t,a){Promise.resolve().then(a.bind(a,89526))},89526:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return ea}});var r=a(57437),n=a(2265),l=a(32603),s=a(99376),o=a(36760),i=a.n(o),d=a(45287);function c(e){return["small","middle","large"].includes(e)}function m(e){return!!e&&"number"==typeof e&&!Number.isNaN(e)}var u=a(71744),h=a(65658);let v=n.createContext({latestIndex:0}),p=v.Provider;var y=e=>{let{className:t,index:a,children:r,split:l,style:s}=e,{latestIndex:o}=n.useContext(v);return null==r?null:n.createElement(n.Fragment,null,n.createElement("div",{className:t,style:s},r),a<o&&l&&n.createElement("span",{className:"".concat(t,"-split")},l))},g=a(4924),j=function(e,t){var a={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(a[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,r=Object.getOwnPropertySymbols(e);n<r.length;n++)0>t.indexOf(r[n])&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(a[r[n]]=e[r[n]]);return a};let w=n.forwardRef((e,t)=>{var a,r,l;let{getPrefixCls:s,space:o,direction:h}=n.useContext(u.E_),{size:v=null!==(a=null==o?void 0:o.size)&&void 0!==a?a:"small",align:w,className:_,rootClassName:f,children:x,direction:D="horizontal",prefixCls:k,split:b,style:N,wrap:P=!1,classNames:M,styles:C}=e,I=j(e,["size","align","className","rootClassName","children","direction","prefixCls","split","style","wrap","classNames","styles"]),[S,E]=Array.isArray(v)?v:[v,v],T=c(E),O=c(S),V=m(E),A=m(S),F=(0,d.Z)(x,{keepEmpty:!0}),U=void 0===w&&"horizontal"===D?"center":w,Y=s("space",k),[L,H,B]=(0,g.Z)(Y),R=i()(Y,null==o?void 0:o.className,H,"".concat(Y,"-").concat(D),{["".concat(Y,"-rtl")]:"rtl"===h,["".concat(Y,"-align-").concat(U)]:U,["".concat(Y,"-gap-row-").concat(E)]:T,["".concat(Y,"-gap-col-").concat(S)]:O},_,f,B),Z=i()("".concat(Y,"-item"),null!==(r=null==M?void 0:M.item)&&void 0!==r?r:null===(l=null==o?void 0:o.classNames)||void 0===l?void 0:l.item),K=0,z=F.map((e,t)=>{var a,r;null!=e&&(K=t);let l=(null==e?void 0:e.key)||"".concat(Z,"-").concat(t);return n.createElement(y,{className:Z,key:l,index:t,split:b,style:null!==(a=null==C?void 0:C.item)&&void 0!==a?a:null===(r=null==o?void 0:o.styles)||void 0===r?void 0:r.item},e)}),q=n.useMemo(()=>({latestIndex:K}),[K]);if(0===F.length)return null;let W={};return P&&(W.flexWrap="wrap"),!O&&A&&(W.columnGap=S),!T&&V&&(W.rowGap=E),L(n.createElement("div",Object.assign({ref:t,className:R,style:Object.assign(Object.assign(Object.assign({},W),null==o?void 0:o.style),N)},I),n.createElement(p,{value:q},z)))});w.Compact=h.ZP;var _=a(4848),f=a(16323),x=a(80589);let D={basic_plan:{name:"기초기획안 작성",color:"#0131ff",order:1},story_board:{name:"스토리보드 작성",color:"#ff6b35",order:2},filming:{name:"촬영(계획/진행)",color:"#f7931e",order:3},video_edit:{name:"비디오 편집",color:"#ffcd3c",order:4},post_work:{name:"후반 작업",color:"#c5d86d",order:5},video_preview:{name:"비디오 시사",color:"#00a8cc",order:6},confirmation:{name:"최종 컨펌",color:"#0085c3",order:7},video_delivery:{name:"영상 납품",color:"#4c5c68",order:8}},k={currentView:"월",currentDate:new Date,selectedDate:null,viewData:[],projects:[],filteredProjects:[],selectedProjectIds:[],userMemos:[],isLoading:!1,error:null},{Option:b}=_.default;var N=a(85994),P=a.n(N),M=a(89991),C=(0,n.memo)(e=>{let{ModalTitle:t,ModalText:a,visible:n=!1,onCancel:l,width:s,style:o,className:i}=e;return(0,r.jsxs)(M.Z,{footer:!1,centered:!0,...s&&{width:s},...o&&{style:o},open:n,...l&&{onCancel:l},closable:!1,...i&&{className:i},maskClosable:!0,destroyOnClose:!0,children:[t&&(0,r.jsx)("div",{className:"modal-title",children:t}),a&&(0,r.jsx)("div",{className:"modal-content",children:a})]})}),I=a(83464),S=a(25566);let E=(()=>{let e=I.Z.create({baseURL:S.env.NEXT_PUBLIC_BACKEND_API_URL||"http://localhost:8000",timeout:1e4,headers:{"Content-Type":"application/json"}});return e.interceptors.request.use(e=>{{let t=localStorage.getItem("access_token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e},e=>(console.error("Request interceptor error:",e),Promise.reject(e))),e.interceptors.response.use(e=>e,async t=>{var a;let r=t.config;if((null===(a=t.response)||void 0===a?void 0:a.status)===401&&!r._retry){r._retry=!0;try{let t=localStorage.getItem("refresh_token");if(t){let a=(await I.Z.post("".concat(S.env.NEXT_PUBLIC_BACKEND_API_URL,"/auth/token/refresh/"),{refresh:t})).data.access;return localStorage.setItem("access_token",a),r.headers.Authorization="Bearer ".concat(a),e(r)}}catch(e){console.error("Token refresh failed:",e),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),window.location.href="/login"}}return Promise.reject(t)}),e})(),T=e=>{if(e.response){var t,a;return{message:(null===(t=e.response.data)||void 0===t?void 0:t.message)||"API 오류가 발생했습니다.",status:e.response.status,field:null===(a=e.response.data)||void 0===a?void 0:a.field}}return e.request?{message:"네트워크 오류가 발생했습니다.",status:0}:{message:e.message||"알 수 없는 오류가 발생했습니다.",status:-1}},O=e=>"object"==typeof e&&null!==e&&"number"==typeof e.id&&"string"==typeof e.memo&&e.date,V=async function(e){let t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;for(let n=0;n<=a;n++)try{return await e()}catch(l){if(t=l,n===a)break;let e=T(l);if(e.status>=400&&e.status<500)break;await new Promise(e=>setTimeout(e,r*Math.pow(2,n)))}throw t};var A={updateProjectPhase:async e=>{try{let{projectId:t,phaseKey:a,startDate:r,endDate:n}=e,l={[a]:{start_date:null==r?void 0:r.toISOString(),end_date:null==n?void 0:n.toISOString()}},s=await E.post("/projects/date_update/".concat(t),l);if(s.data.success&&s.data.phase)return s.data.phase;throw Error("프로젝트 단계 업데이트에 실패했습니다.")}catch(e){throw console.error("프로젝트 단계 업데이트 실패:",e),T(e)}},createProjectMemo:async(e,t)=>{try{let a=await E.post("/projects/memo/".concat(t),e);if(a.data.success&&O(a.data.memo))return a.data.memo;throw Error("메모 작성에 실패했습니다.")}catch(e){throw console.error("프로젝트 메모 작성 실패:",e),T(e)}},deleteProjectMemo:async(e,t)=>{try{if(!(await E.delete("/projects/memo/".concat(t),{data:{memo_id:e}})).data.success)throw Error("메모 삭제에 실패했습니다.")}catch(e){throw console.error("프로젝트 메모 삭제 실패:",e),T(e)}},createUserMemo:async e=>{try{let t=await E.post("/auth/user_memo",e);if(t.data.success&&O(t.data.memo))return t.data.memo;throw Error("사용자 메모 작성에 실패했습니다.")}catch(e){throw console.error("사용자 메모 작성 실패:",e),T(e)}},deleteUserMemo:async e=>{try{if(!(await E.delete("/auth/user_memo/".concat(e))).data.success)throw Error("사용자 메모 삭제에 실패했습니다.")}catch(e){throw console.error("사용자 메모 삭제 실패:",e),T(e)}},formatDateForApi:e=>{let t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(r)}};let F=e=>{let{day:t,month:a,year:l,current_project:o,project_list:d,user_memos:c,is_admin:m,refetch:u}=e,h=(0,s.useRouter)(),v=(0,s.useParams)(),p=null==v?void 0:v.project_id,[y,g]=(0,n.useState)(!1),[j,w]=(0,n.useState)(null),[_,f]=(0,n.useState)(null),[x,D]=(0,n.useState)(null),[k,b]=(0,n.useState)(""),N=e=>new Date(e).setHours(0,0,0,0),M=e=>e===t.setHours(0,0,0,0),I=t.getMonth()===new Date().getMonth()&&t.getFullYear()===new Date().getFullYear()&&t.getDate()===new Date().getDate(),S=async()=>{if(0===k.length){alert("메모를 작성해주세요.");return}try{let e={date:"".concat(l,"-").concat(a+1,"-").concat(t.getDate()),memo:k};m&&p?await A.createProjectMemo(e,parseInt(p)):window.location.pathname.includes("/calendar")&&await A.createUserMemo(e),b(""),u(),g(!1)}catch(t){var e,r;(null===(r=t.response)||void 0===r?void 0:null===(e=r.data)||void 0===e?void 0:e.message)?alert(t.response.data.message):alert("메모 작성에 실패했습니다.")}},E=async e=>{try{m&&p?await A.deleteProjectMemo(e.id,parseInt(p)):window.location.pathname.includes("/calendar")&&await A.deleteUserMemo(e.id),u(),w(null)}catch(e){var t,a;(null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.message)?alert(e.response.data.message):alert("메모 삭제에 실패했습니다.")}},T=async()=>{if(!_.start_date||!_.end_date){alert("날짜를 입력해주세요.");return}if(new Date(_.start_date)>=new Date(_.end_date)){alert("종료 날짜는 시작 날짜보다 늦어야 합니다.");return}try{await A.updateProjectPhase({projectId:parseInt(p),phaseKey:_.phase_key,startDate:new Date(_.start_date),endDate:new Date(_.end_date)}),u(),f(null)}catch(a){var e,t;(null===(t=a.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)?alert(a.response.data.message):alert("일정 변경에 실패했습니다.")}},O=e=>{let t=new Date;return e>=t||e.toDateString()===t.toDateString()},V=y&&(0,r.jsx)(C,{visible:!0,ModalTitle:(0,r.jsx)(r.Fragment,{}),ModalText:(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"day",children:[l,"년 ",a+1,"월 ",t.getDate(),"일"]}),(0,r.jsx)("textarea",{className:"mt20",name:"textarea",placeholder:"메모를 입력해주세요.",cols:30,rows:10,value:k,onChange:e=>b(e.target.value)}),(0,r.jsxs)("div",{className:"btn_wrap",children:[(0,r.jsx)("button",{className:"submit",onClick:S,children:"등록"}),(0,r.jsx)("button",{className:"cancel",onClick:()=>g(!1),children:"닫기"})]})]})}),F=j&&(0,r.jsx)(C,{visible:!0,ModalTitle:(0,r.jsx)(r.Fragment,{}),ModalText:(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"memo_txt",children:j.memo}),(0,r.jsxs)("div",{className:"btn_wrap",children:[(m||window.location.pathname.includes("/calendar"))&&(0,r.jsx)("button",{className:"submit",onClick:()=>E(j),children:"삭제"}),(0,r.jsx)("button",{onClick:()=>w(null),className:"cancel",children:"닫기"})]})]})}),U=_&&(0,r.jsx)(C,{visible:!0,ModalTitle:(0,r.jsx)(r.Fragment,{}),ModalText:(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"selec_wrap",children:[(0,r.jsx)("div",{className:"select",children:(0,r.jsx)(P(),{placeholderText:"시작 날짜",selected:_.start_date?new Date(_.start_date):null,onChange:e=>f({..._,start_date:e}),showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:10,dateFormat:"yyyy-MM-dd HH:mm",filterDate:O})}),(0,r.jsx)("div",{className:"select",children:(0,r.jsx)(P(),{placeholderText:"종료 날짜",filterDate:e=>new Date(_.start_date).setHours(0,0,0,0)<=new Date(e).getTime()&&O(e),selected:_.end_date?new Date(_.end_date):null,onChange:e=>f({..._,end_date:e}),showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:10,dateFormat:"yyyy-MM-dd HH:mm",disabled:!_.start_date})})]}),(0,r.jsxs)("div",{className:"btn_wrap",children:[(0,r.jsx)("button",{className:"submit",onClick:T,children:"변경하기"}),(0,r.jsx)("button",{className:"cancel",onClick:()=>f(null),children:"닫기"})]})]})});return(0,r.jsxs)("div",{...(()=>{let e=0===t.getDay()||6===t.getDay();return{style:{opacity:t.getMonth()<a||t.getFullYear()<l||t.getMonth()>a||t.getFullYear()>l?"0.3":"1",color:e?"red":"#000"}}})(),children:[V,F,U,(0,r.jsx)("p",{style:{cursor:m||window.location.pathname.includes("/calendar")?"pointer":"auto"},onClick:()=>{(m||window.location.pathname.includes("/calendar"))&&g(!0)},children:I?(0,r.jsx)("div",{className:"today",children:t.getDate()}):t.getDate()}),o?[{key:"basic_plan",name:"기초기획안 작성",className:"first"},{key:"story_board",name:"스토리보드 작성",className:"second"},{key:"filming",name:"촬영(계획/진행)",className:"third"},{key:"video_edit",name:"비디오 편집",className:"fourth"},{key:"post_work",name:"후반 작업",className:"fifth"},{key:"video_preview",name:"비디오 시사",className:"sixth"},{key:"confirmation",name:"최종 컨펌",className:"seven"},{key:"video_delivery",name:"영상 납품",className:"eighth"}].map(e=>{let a=o[e.key];if(!(null==a?void 0:a.start_date)||!(null==a?void 0:a.end_date))return(0,r.jsx)("span",{},e.key);let l=N(a.start_date),s=N(a.end_date),d=N(t);return d<l||d>s?(0,r.jsx)("span",{},e.key):(0,r.jsxs)(n.Fragment,{children:[(0,r.jsx)("span",{onClick:()=>{m&&f({...a,phase_key:e.key})},onMouseOver:()=>D(e.name),onMouseLeave:()=>D(null),style:{cursor:m?"pointer":"auto"},className:i()(e.className,{start:M(l),end:M(s)})}),x===e.name&&(0,r.jsx)("div",{className:"Modal",children:x})]},e.key)}):null,d?d.map((e,a)=>{let l=N(e.first_date),s=N(e.end_date),o=N(t);return o<l||o>s?(0,r.jsx)("span",{},a):(0,r.jsxs)(n.Fragment,{children:[(0,r.jsx)("span",{onMouseOver:()=>D(a),onMouseLeave:()=>D(null),onClick:()=>h.push("/projects/".concat(e.id,"/view")),className:i()({start:M(l),end:M(s)}),style:{background:e.color,cursor:"pointer"}}),x===a&&(0,r.jsx)("div",{className:"Modal",children:e.name})]},a)}):null,[...(null==o?void 0:o.memo)||[],...c||[]].map((e,a)=>N(e.date)!==N(t)?null:(0,r.jsx)("span",{className:"memo",onClick:()=>w(e),style:{color:"#23262d",cursor:"pointer"},children:e.memo},a))]})};var U=(0,n.memo)(e=>{let{index:t,week:a,month:n,year:l,type:s,day:o,current_project:i,project_list:d,user_memos:c,is_admin:m,refetch:u}=e,h=["일","월","화","수","목","금","토"];return(0,r.jsxs)(r.Fragment,{children:[0===t&&(0,r.jsx)("div",{className:"th",children:"일"!==s?h.map((e,t)=>(0,r.jsx)("div",{className:0===t||6===t?"holiday":"",children:e},t)):(0,r.jsx)("div",{className:o&&(0===o.getDay()||6===o.getDay())?"holiday":"",children:o&&h[o.getDay()]})}),"월"===s&&a&&(0,r.jsx)("div",{className:"td",children:(0,r.jsx)("div",{className:"week",children:a.map((e,t)=>(0,r.jsx)(F,{day:e,month:n,year:l,current_project:i,project_list:d,user_memos:c,is_admin:m,refetch:u,index:0,type:s},t))})}),"주"===s&&a&&(0,r.jsx)("div",{className:"td",children:(0,r.jsx)("div",{className:"week",children:a.map((e,t)=>(0,r.jsx)(F,{day:e,month:n,year:l,current_project:i,project_list:d,user_memos:c,is_admin:m,refetch:u,index:0,type:s},t))})}),"일"===s&&o&&(0,r.jsx)("div",{className:"td",children:(0,r.jsx)("div",{className:"week",children:(0,r.jsx)(F,{day:o,month:n,year:l,current_project:i,project_list:d,user_memos:c,is_admin:m,refetch:u,index:0,type:s})})})]})}),Y=(0,n.memo)(e=>{let{viewData:t,currentView:a,navigation:n,projects:l,userMemos:s,isAdmin:o,onEventClick:i,onDateClick:d,onRefetch:c}=e,m=e=>e.map((e,t)=>Array.isArray(e.dates)?(0,r.jsx)(U,{index:t,week:e.dates.map(e=>e.date),month:n.month,year:n.year,type:a,current_project:void 0,project_list:l,user_memos:s,is_admin:o,refetch:c},t):null),u=e=>Array.isArray(e)?(0,r.jsx)(U,{index:0,week:e.map(e=>e.date),month:n.month,year:n.year,type:a,current_project:void 0,project_list:l,user_memos:s,is_admin:o,refetch:c}):null,h=e=>{var t;return Array.isArray(e)&&0!==e.length?(0,r.jsx)(U,{index:0,month:n.month,year:n.year,type:a,day:(null===(t=e[0])||void 0===t?void 0:t.date)||new Date,current_project:void 0,project_list:l,user_memos:s,is_admin:o,refetch:c}):null};return(0,r.jsx)("div",{className:"일"===a?"calendar_box day":"calendar_box",role:"main","aria-label":"캘린더 본체",children:(()=>{switch(a){case"월":return m(t);case"주":return u(t);case"일":return h(t);default:return null}})()})}),L=(0,n.memo)(e=>{let{stats:t,className:a=""}=e;return(0,r.jsx)("div",{className:"part mt100 ".concat(a),children:(0,r.jsxs)("ul",{className:"schedule",children:[(0,r.jsxs)("li",{children:["전체 ",(0,r.jsx)("br",{}),"프로젝트 ",(0,r.jsx)("span",{children:t.totalProjects})]}),(0,r.jsxs)("li",{children:["이번 달 ",(0,r.jsx)("br",{}),"프로젝트 ",(0,r.jsx)("span",{children:t.thisMonthProjects})]}),(0,r.jsxs)("li",{children:["다음 달 ",(0,r.jsx)("br",{}),"프로젝트 ",(0,r.jsx)("span",{children:t.nextMonthProjects})]}),(0,r.jsxs)("li",{children:["진행 중 ",(0,r.jsx)("br",{}),"프로젝트 ",(0,r.jsx)("span",{children:t.activeProjects})]})]})})}),H=a(77398),B=a.n(H),R=a(73377),Z=a(19764);let K=e=>{let{title:t,projects:a,phaseKey:n}=e,l=a.filter(e=>{let t=e.phases[n];return!t.endDate||t.endDate&&t.endDate.getTime()>=new Date().setHours(0,0,0,0)}).sort((e,t)=>{let a=e.phases[n].endDate,r=t.phases[n].endDate;return a||r?a?r?a.getTime()-r.getTime():-1:1:0});return(0,r.jsxs)("div",{className:"process flex space_between align_center",children:[(0,r.jsx)("div",{className:"s_title",dangerouslySetInnerHTML:{__html:t}}),(0,r.jsxs)(Z.tq,{modules:[R.W_,R.tl,R.LW,R.s5],spaceBetween:0,slidesPerView:5,pagination:{clickable:!0},scrollbar:{draggable:!0},navigation:!0,breakpoints:{320:{slidesPerView:1,spaceBetween:10},640:{slidesPerView:2,spaceBetween:15},768:{slidesPerView:3,spaceBetween:20},1024:{slidesPerView:4,spaceBetween:20},1200:{slidesPerView:5,spaceBetween:0}},children:[l.map(e=>{let t=e.phases[n];return(0,r.jsx)(Z.o5,{children:(0,r.jsxs)("div",{className:"inner03",children:[(0,r.jsx)("div",{className:"name",title:e.name,children:e.name}),t.startDate&&t.endDate?(0,r.jsxs)("div",{className:"day",children:[(0,r.jsx)("span",{children:B()(t.startDate).format("YYYY.MM.DD.dd")}),(0,r.jsxs)("span",{children:["~ ",B()(t.endDate).format("YYYY.MM.DD.dd")]})]}):(0,r.jsx)("span",{className:"no-date",children:"날짜를 입력해주세요."}),(0,r.jsx)("div",{className:"project-color-indicator",style:{backgroundColor:e.color}})]})},e.id)}),0===l.length&&(0,r.jsx)(Z.o5,{children:(0,r.jsx)("div",{className:"inner03 no-projects",children:(0,r.jsx)("div",{className:"name",children:"진행 중인 프로젝트가 없습니다."})})})]})]})};var z=(0,n.memo)(e=>{let{projects:t=[],className:a=""}=e;return(0,r.jsx)("div",{className:"list_box mt100 ".concat(a),children:[{key:"basic_plan",title:"기초기획안 <br />작성"},{key:"story_board",title:"스토리보드 <br />작성"},{key:"filming",title:"촬영 <br />(계획/진행)"},{key:"video_edit",title:"비디오 편집"},{key:"post_work",title:"후반 작업"},{key:"video_preview",title:"비디오 시사 <br />(피드백)"},{key:"confirmation",title:"최종 컨펌"},{key:"video_delivery",title:"영상 납품"}].map(e=>(0,r.jsx)(K,{title:e.title,projects:t,phaseKey:e.key},e.key))})});let q=(e,t)=>{let a=e.getFullYear(),r=e.getMonth(),n=e.getDate(),l=e.getDay(),s=new Date;return{year:a,month:r,date:n,day:l,isToday:e.toDateString()===s.toDateString(),isCurrentMonth:r===t,isWeekend:0===l||6===l}},W=(e,t)=>{let a=new Date(e,t,1),r=new Date(e,t+1,0),n=a.getDay(),l=r.getDate(),s=[],o=0===t?11:t-1,i=0===t?e-1:e,d=new Date(i,o+1,0).getDate();for(let e=n-1;e>=0;e--)s.push(new Date(i,o,d-e));for(let a=1;a<=l;a++)s.push(new Date(e,t,a));let c=42-s.length,m=11===t?0:t+1,u=11===t?e+1:e;for(let e=1;e<=c;e++)s.push(new Date(u,m,e));return s},G=(e,t,a)=>{let r=W(e,t),n=7*a;return r.slice(n,n+7)},J=(e,t,a)=>W(e,t)[a]||new Date(e,t,1),X=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"월",t=(0,s.useRouter)(),a=(0,s.useSearchParams)(),r=(0,l.I0)(),{project_list:o,this_month_project:i,next_month_project:d,user_memos:c}=(0,l.v9)(e=>e.ProjectStore),[m,u]=(0,n.useState)({...k,currentView:e}),[h,v]=(0,n.useState)({year:new Date().getFullYear(),month:new Date().getMonth(),week:0,day:new Date().getDate()-1,weekIndex:0,navigatePrev:()=>{},navigateNext:()=>{}}),[p,y]=(0,n.useState)({isVisible:!1,type:null,data:null}),[g,j]=(0,n.useState)({isDragging:!1,draggedEvent:null,draggedPhase:null,dropTarget:null}),[w,_]=(0,n.useState)(!1),[f,x]=(0,n.useState)(null),D=(0,n.useMemo)(()=>(null==o?void 0:o.filter(e=>{let t=new Date(e.end_date).getMonth(),a=new Date(e.first_date).getMonth();return t===h.month||a===h.month}))||[],[o,h.month]),b=(0,n.useMemo)(()=>0===m.selectedProjectIds.length?D:D.filter(e=>m.selectedProjectIds.includes(e.id)),[D,m.selectedProjectIds]),N=(0,n.useMemo)(()=>{let{year:e,month:t,weekIndex:a,day:r}=h;switch(m.currentView){case"월":{let a=W(e,t),r=[];for(let e=0;e<a.length;e+=7){let n=a.slice(e,e+7).map(e=>({date:e,dateInfo:q(e,t),events:[],memos:[]}));r.push({dates:n,weekIndex:e/7})}return r}case"주":return G(e,t,a).map(e=>({date:e,dateInfo:q(e,t),events:[],memos:[]}));case"일":{let a=J(e,t,r);return[{date:a,dateInfo:q(a,t),events:[],memos:[]}]}default:return[]}},[m.currentView,h]),P=(0,n.useMemo)(()=>{var e,t;return{totalProjects:(null==o?void 0:o.length)||0,thisMonthProjects:(null==i?void 0:i.length)||0,nextMonthProjects:(null==d?void 0:d.length)||0,activeProjects:(null==o?void 0:null===(e=o.filter(e=>e.isActive))||void 0===e?void 0:e.length)||0,completedProjects:(null==o?void 0:null===(t=o.filter(e=>!e.isActive))||void 0===t?void 0:t.length)||0,overdueProjects:0}},[o,i,d]),M=(0,n.useCallback)(e=>{u(t=>({...t,currentView:e}));let r=new URLSearchParams(null==a?void 0:a.toString());r.set("view",e),t.push("/calendar?".concat(r.toString()))},[t,a]),C=(0,n.useCallback)(e=>{v(t=>({...t,year:e.getFullYear(),month:e.getMonth(),day:e.getDate()-1})),u(t=>({...t,selectedDate:e}))},[]),I=(0,n.useCallback)(e=>{e.includes(-1)?u(e=>({...e,selectedProjectIds:[]})):u(t=>({...t,selectedProjectIds:e}))},[]),S=(0,n.useCallback)(async e=>{try{if(_(!0),x(null),e.projectId){let t={memo:e.memo,date:A.formatDateForApi(e.date),projectId:e.projectId};await A.createProjectMemo(t,e.projectId)}else{let t={memo:e.memo,date:A.formatDateForApi(e.date)};await A.createUserMemo(t)}await B(),y({isVisible:!1,type:null,data:null})}catch(e){x(e.message||"메모 작성에 실패했습니다.")}finally{_(!1)}},[]),E=(0,n.useCallback)(async(e,t)=>{try{_(!0),x(null);let a=null==c?void 0:c.find(t=>t.id===e);a&&(a.isUserMemo?await A.deleteUserMemo(e):await A.deleteProjectMemo(e,a.projectId),t.memo&&await S({memo:t.memo,date:t.date||a.date,projectId:a.projectId}))}catch(e){x(e.message||"메모 수정에 실패했습니다.")}finally{_(!1)}},[c,S]),T=(0,n.useCallback)(async e=>{try{_(!0),x(null);let t=null==c?void 0:c.find(t=>t.id===e);t&&(t.isUserMemo?await A.deleteUserMemo(e):await A.deleteProjectMemo(e,t.projectId),await B(),y({isVisible:!1,type:null,data:null}))}catch(e){x(e.message||"메모 삭제에 실패했습니다.")}finally{_(!1)}},[c]),O=(0,n.useCallback)(async e=>{try{_(!0),x(null),await A.updateProjectPhase(e),await B(),y({isVisible:!1,type:null,data:null})}catch(e){x(e.message||"프로젝트 단계 업데이트에 실패했습니다.")}finally{_(!1)}},[]),V=(0,n.useCallback)(e=>{u(t=>({...t,selectedDate:e})),y({isVisible:!0,type:"memo",data:{date:e,isUserMemo:!0}})},[]),F=(0,n.useCallback)(e=>{"memo"===e.type&&y({isVisible:!0,type:"memo",data:{date:e.startDate,existingMemo:e}})},[]),U=(0,n.useCallback)(e=>{"type"in e&&"title"in e?j({isDragging:!0,draggedEvent:e,draggedPhase:null,dropTarget:null}):j({isDragging:!0,draggedEvent:null,draggedPhase:e,dropTarget:null})},[]),Y=(0,n.useCallback)(async e=>{try{_(!0),x(null),"phase"===e.eventType&&e.phaseKey&&(await A.updateProjectPhase({projectId:e.projectId,phaseKey:e.phaseKey,startDate:e.targetDate,endDate:e.targetDate}),await B())}catch(e){x(e.message||"드래그 앤 드롭 업데이트에 실패했습니다.")}finally{_(!1),j({isDragging:!1,draggedEvent:null,draggedPhase:null,dropTarget:null})}},[]),L=(0,n.useCallback)(()=>{v(e=>{let{currentView:t}=m;switch(t){case"월":{let t=0===e.month?11:e.month-1,a=0===e.month?e.year-1:e.year;return{...e,year:a,month:t,weekIndex:0,day:0}}case"주":if(0!==e.weekIndex)return{...e,weekIndex:e.weekIndex-1};{let t=0===e.month?11:e.month-1,a=0===e.month?e.year-1:e.year,r=Math.ceil(W(a,t).length/7)-1;return{...e,year:a,month:t,weekIndex:r}}case"일":if(0!==e.day)return{...e,day:e.day-1};{let t=0===e.month?11:e.month-1,a=0===e.month?e.year-1:e.year,r=W(a,t);return{...e,year:a,month:t,day:r.length-1}}default:return e}})},[m.currentView]),H=(0,n.useCallback)(()=>{v(e=>{let{currentView:t}=m;switch(t){case"월":{let t=11===e.month?0:e.month+1,a=11===e.month?e.year+1:e.year;return{...e,year:a,month:t,weekIndex:0,day:0}}case"주":{let t=Math.ceil(W(e.year,e.month).length/7)-1;if(e.weekIndex!==t)return{...e,weekIndex:e.weekIndex+1};{let t=11===e.month?0:e.month+1,a=11===e.month?e.year+1:e.year;return{...e,year:a,month:t,weekIndex:0}}}case"일":{let t=W(e.year,e.month);if(e.day!==t.length-1)return{...e,day:e.day+1};{let t=11===e.month?0:e.month+1,a=11===e.month?e.year+1:e.year;return{...e,year:a,month:t,day:0}}}default:return e}})},[m.currentView]),B=(0,n.useCallback)(async()=>{try{_(!0),x(null)}catch(e){x(e.message||"데이터를 불러오는데 실패했습니다.")}finally{_(!1)}},[r]);return(0,n.useEffect)(()=>{let e=null==a?void 0:a.get("view");e&&["월","주","일"].includes(e)&&u(t=>({...t,currentView:e}))},[a]),{state:{...m,projects:D,filteredProjects:b,userMemos:c||[],viewData:N},handlers:{onViewChange:M,onDateChange:C,onProjectFilter:I,onMemoCreate:S,onMemoUpdate:E,onMemoDelete:T,onPhaseUpdate:O,onDateClick:V,onEventClick:F,onDragStart:U,onDragEnd:Y},navigation:{...h,navigatePrev:L,navigateNext:H},modal:p,stats:P,isLoading:w,error:f,refetch:B,setModal:y}},Q=()=>{(0,l.I0)();let{project_list:e}=(0,l.v9)(e=>e.ProjectStore),[t,a]=(0,n.useState)([]),[r,s]=(0,n.useState)(!1),[o,i]=(0,n.useState)(null),d=(0,n.useMemo)(()=>(null==e?void 0:e.map(e=>{var t,a,r,n,l,s,o,i,d,c,m,u,h,v,p,y,g;return{...e,firstDate:new Date(e.first_date),endDate:new Date(e.end_date),phases:{basic_plan:{id:"".concat(e.id,"-basic_plan"),name:D.basic_plan.name,key:"basic_plan",startDate:(null===(t=e.basic_plan)||void 0===t?void 0:t.start_date)?new Date(e.basic_plan.start_date):null,endDate:(null===(a=e.basic_plan)||void 0===a?void 0:a.end_date)?new Date(e.basic_plan.end_date):null,color:D.basic_plan.color,order:D.basic_plan.order},story_board:{id:"".concat(e.id,"-story_board"),name:D.story_board.name,key:"story_board",startDate:(null===(r=e.story_board)||void 0===r?void 0:r.start_date)?new Date(e.story_board.start_date):null,endDate:(null===(n=e.story_board)||void 0===n?void 0:n.end_date)?new Date(e.story_board.end_date):null,color:D.story_board.color,order:D.story_board.order},filming:{id:"".concat(e.id,"-filming"),name:D.filming.name,key:"filming",startDate:(null===(l=e.filming)||void 0===l?void 0:l.start_date)?new Date(e.filming.start_date):null,endDate:(null===(s=e.filming)||void 0===s?void 0:s.end_date)?new Date(e.filming.end_date):null,color:D.filming.color,order:D.filming.order},video_edit:{id:"".concat(e.id,"-video_edit"),name:D.video_edit.name,key:"video_edit",startDate:(null===(o=e.video_edit)||void 0===o?void 0:o.start_date)?new Date(e.video_edit.start_date):null,endDate:(null===(i=e.video_edit)||void 0===i?void 0:i.end_date)?new Date(e.video_edit.end_date):null,color:D.video_edit.color,order:D.video_edit.order},post_work:{id:"".concat(e.id,"-post_work"),name:D.post_work.name,key:"post_work",startDate:(null===(d=e.post_work)||void 0===d?void 0:d.start_date)?new Date(e.post_work.start_date):null,endDate:(null===(c=e.post_work)||void 0===c?void 0:c.end_date)?new Date(e.post_work.end_date):null,color:D.post_work.color,order:D.post_work.order},video_preview:{id:"".concat(e.id,"-video_preview"),name:D.video_preview.name,key:"video_preview",startDate:(null===(m=e.video_preview)||void 0===m?void 0:m.start_date)?new Date(e.video_preview.start_date):null,endDate:(null===(u=e.video_preview)||void 0===u?void 0:u.end_date)?new Date(e.video_preview.end_date):null,color:D.video_preview.color,order:D.video_preview.order},confirmation:{id:"".concat(e.id,"-confirmation"),name:D.confirmation.name,key:"confirmation",startDate:(null===(h=e.confirmation)||void 0===h?void 0:h.start_date)?new Date(e.confirmation.start_date):null,endDate:(null===(v=e.confirmation)||void 0===v?void 0:v.end_date)?new Date(e.confirmation.end_date):null,color:D.confirmation.color,order:D.confirmation.order},video_delivery:{id:"".concat(e.id,"-video_delivery"),name:D.video_delivery.name,key:"video_delivery",startDate:(null===(p=e.video_delivery)||void 0===p?void 0:p.start_date)?new Date(e.video_delivery.start_date):null,endDate:(null===(y=e.video_delivery)||void 0===y?void 0:y.end_date)?new Date(e.video_delivery.end_date):null,color:D.video_delivery.color,order:D.video_delivery.order}},memo:(null===(g=e.memo)||void 0===g?void 0:g.map(e=>({...e,date:new Date(e.date),createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at),isUserMemo:!1})))||[],isActive:!0,owner:e.owner||{id:0,name:"",email:""},members:e.members||[]}}))||[],[e]),c=(0,n.useMemo)(()=>0===t.length?d:d.filter(e=>t.includes(e.id)),[d,t]),m=(0,n.useCallback)(e=>{a(e)},[]),u=(0,n.useCallback)(async e=>{try{s(!0),i(null),await A.updateProjectPhase(e)}catch(e){throw i(e.message||"프로젝트 단계 업데이트에 실패했습니다."),e}finally{s(!1)}},[]),h=(0,n.useCallback)((e,t)=>{let a=d.find(t=>t.id===e);return(null==a?void 0:a.phases[t])||null},[d]),v=(0,n.useCallback)(e=>{let t=d.find(t=>t.id===e);if(!t)return 0;let a=Object.values(t.phases);return a.filter(e=>e.startDate&&e.endDate&&new Date>e.endDate).length/a.length*100},[d]),p=(0,n.useCallback)(e=>d.map(t=>({project:t,phase:t.phases[e]})).filter(e=>{let{phase:t}=e;return t.startDate&&t.endDate}),[d]),y=(0,n.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,t=new Date,a=new Date;a.setDate(t.getDate()+e);let r=[];return d.forEach(e=>{Object.values(e.phases).forEach(n=>{if(n.endDate&&n.endDate>=t&&n.endDate<=a){let a=Math.ceil((n.endDate.getTime()-t.getTime())/864e5);r.push({project:e,phase:n,daysLeft:a})}})}),r.sort((e,t)=>e.daysLeft-t.daysLeft)},[d]),g=(0,n.useCallback)(()=>{let e=new Date,t=[];return d.forEach(a=>{Object.values(a.phases).forEach(r=>{if(r.endDate&&r.endDate<e){let n=Math.ceil((e.getTime()-r.endDate.getTime())/864e5);t.push({project:a,phase:r,daysOverdue:n})}})}),t.sort((e,t)=>t.daysOverdue-e.daysOverdue)},[d]),j=(0,n.useCallback)((e,t)=>!0,[]),w=(0,n.useCallback)(e=>{let t=[];e.startDate||t.push("시작 날짜를 선택해주세요."),e.endDate||t.push("종료 날짜를 선택해주세요."),e.startDate&&e.endDate&&e.startDate>=e.endDate&&t.push("종료 날짜는 시작 날짜보다 늦어야 합니다.");let a=new Date;return a.setHours(0,0,0,0),e.startDate&&e.startDate<a&&t.push("시작 날짜는 오늘 이후여야 합니다."),t},[]),_=(0,n.useCallback)((e,t,a)=>{let r=d.find(e=>e.id===a);return!!r&&!(t<r.firstDate)&&!(t>r.endDate)&&!!j(a,e)},[d,j]),f=(0,n.useCallback)(async(e,t,a,r)=>{try{s(!0),i(null);let n=d.find(e=>e.id===a);if(!(null==n?void 0:n.phases[e]))throw Error("프로젝트 단계를 찾을 수 없습니다.");let l=t;r&&r>0&&(l=new Date(t)).setDate(l.getDate()+r),await u({projectId:a,phaseKey:e,startDate:t,endDate:l})}catch(e){throw i(e.message||"프로젝트 단계 이동에 실패했습니다."),e}finally{s(!1)}},[d,u]);return{projects:d,filteredProjects:c,selectedProjectIds:t,filterProjects:m,updatePhase:u,isUpdating:r,error:o,getProjectPhase:h,getProjectProgress:v,getProjectsByPhase:p,getUpcomingDeadlines:y,getOverdueProjects:g,isPhaseEditable:j,getPhaseValidationErrors:w,canDropPhase:_,movePhase:f,clearError:(0,n.useCallback)(()=>{i(null)},[])}};var $=a(85763);let ee=()=>(0,r.jsxs)("div",{className:"calendar-skeleton",children:[(0,r.jsx)("div",{className:"skeleton-header"}),(0,r.jsx)("div",{className:"skeleton-body"}),(0,r.jsx)("div",{className:"skeleton-stats"})]}),et=()=>{let e=(0,s.useRouter)(),t=(0,l.I0)(),a=(0,s.useSearchParams)(),{project_list:o,this_month_project:i,next_month_project:d,user_memos:c}=(0,l.v9)(e=>e.ProjectStore),{state:m,handlers:u,navigation:h,modal:v,stats:p,isLoading:y,error:g,refetch:j}=X((null==a?void 0:a.get("view"))||"월"),{projects:D,filteredProjects:k,selectedProjectIds:b,filterProjects:N}=Q();(0,n.useEffect)(()=>{(0,$.J_)(t,e)},[t,e]),(0,n.useEffect)(()=>{let e=null==a?void 0:a.get("view");e&&["월","주","일"].includes(e)&&u.onViewChange(e)},[a,u]);let P=()=>{(0,$.J_)(t,e)},M=e=>{"prev"===e?h.navigatePrev():h.navigateNext()},C=k.length>0?k:D;return g?(0,r.jsx)(f.Z,{leftItems:[],auth:!1,props:{},noLogin:!1,children:(0,r.jsxs)("div",{className:"cms_wrap",children:[(0,r.jsx)(x.Z,{tab:"calendar",on_menu:!1}),(0,r.jsxs)("main",{children:[(0,r.jsx)("div",{className:"title",children:"전체 일정"}),(0,r.jsx)("div",{className:"content calendar",children:(0,r.jsxs)("div",{className:"error-message",children:[(0,r.jsx)("h3",{children:"오류가 발생했습니다"}),(0,r.jsx)("p",{children:g}),(0,r.jsx)("button",{onClick:P,className:"btn-retry",children:"다시 시도"})]})})]})]})}):(0,r.jsx)(f.Z,{leftItems:[],auth:!1,props:{},noLogin:!1,children:(0,r.jsxs)("div",{className:"cms_wrap",children:[(0,r.jsx)(x.Z,{tab:"calendar",on_menu:!1}),(0,r.jsxs)("main",{children:[(0,r.jsx)("div",{className:"title",children:"전체 일정"}),(0,r.jsxs)("div",{className:"content calendar",children:[(0,r.jsxs)("div",{className:"filter flex space_between align_center",children:[(0,r.jsxs)("div",{className:"date flex space_between align_center",children:[h.year,".",String(h.month+1).padStart(2,"0"),(0,r.jsxs)("div",{className:"move",children:[(0,r.jsx)("span",{onClick:()=>M("prev"),className:"prev",role:"button",tabIndex:0,"aria-label":"이전",onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),M("prev"))}}),(0,r.jsx)("span",{onClick:()=>M("next"),className:"next",role:"button",tabIndex:0,"aria-label":"다음",onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),M("next"))}})]})]}),(0,r.jsx)("div",{className:"type",children:(0,r.jsxs)(w,{wrap:!0,children:[(0,r.jsxs)(_.default,{placeholder:"프로젝트 선택",className:"project-filter-select",style:{width:140},value:(()=>{if(0===b.length)return"전체";if(1!==b.length)return"".concat(b.length,"개 선택됨");{let e=D.find(e=>e.id===b[0]);return(null==e?void 0:e.name)||"전체"}})(),onChange:e=>{"전체"===e||-1===e?N([]):N(["string"==typeof e?parseInt(e):e])},getPopupContainer:e=>e.parentNode,children:[(0,r.jsx)(_.default.Option,{value:"전체",children:"전체"}),D.map(e=>(0,r.jsx)(_.default.Option,{value:e.id,children:e.name},e.id))]}),(0,r.jsx)(_.default,{value:m.currentView,style:{width:140},onChange:u.onViewChange,options:["월","주","일"].map(e=>({label:e,value:e})),getPopupContainer:e=>e.parentNode})]})})]}),y?(0,r.jsx)(ee,{}):(0,r.jsx)(Y,{viewData:m.viewData,currentView:m.currentView,navigation:h,projects:C,userMemos:m.userMemos,isAdmin:!0,onEventClick:u.onEventClick,onDateClick:u.onDateClick,onRefetch:P}),(0,r.jsx)("div",{className:"list_mark",children:(0,r.jsx)("ul",{children:C.map((e,t)=>(0,r.jsxs)("li",{children:[(0,r.jsx)("span",{style:{background:e.color}}),e.name]},e.id||t))})}),(0,r.jsx)(L,{stats:{totalProjects:(null==o?void 0:o.length)||0,thisMonthProjects:(null==i?void 0:i.length)||0,nextMonthProjects:(null==d?void 0:d.length)||0,activeProjects:p.activeProjects,completedProjects:p.completedProjects,overdueProjects:p.overdueProjects}}),(0,r.jsx)(z,{projects:C})]})]})]})})};var ea=()=>(0,r.jsx)(n.Suspense,{fallback:(0,r.jsx)(ee,{}),children:(0,r.jsx)(et,{})})}},function(e){e.O(0,[711,990,500,41,919,991,848,985,971,117,744],function(){return e(e.s=52606)}),_N_E=e.O()}]);
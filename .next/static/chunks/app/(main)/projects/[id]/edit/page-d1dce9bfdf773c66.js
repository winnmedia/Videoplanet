(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[988],{96351:function(e,s,a){Promise.resolve().then(a.bind(a,591))},591:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return h}});var l=a(57437),i=a(2265),n=a(99376),c=a(32603),t=a(94242),r=a(16323),d=a(80589),o=a(76524),m=a(81374),x=a(79916);function h(){let e=(0,n.useRouter)(),s=(0,n.useParams)(),a=null==s?void 0:s.id,{sample_files:h}=(0,c.v9)(e=>e.ProjectStore),{currentProject:p,loading:j,fetchProject:u,deleteProject:b,updateMemberRating:N,deleteFile:f}=(0,m.Z0)(),v=(0,m.ti)(p),{inputs:_,process:g,validation:w,isSubmitting:y,onChange:C,setProcess:k,handleSubmit:E}=(0,m.b5)(p),{files:F,onFileChange:Z,onFileDelete:q}=(0,m.FL)();(0,i.useEffect)(()=>{p&&!v.canEdit&&(t.Am.error("프로젝트 편집 권한이 없습니다."),e.push("/projects/".concat(a,"/view")))},[p,v.canEdit,a,e]),(0,i.useEffect)(()=>{a&&u(a).catch(()=>{e.push("/Calendar")})},[a]);let L=async(e,s)=>{let l=e.target.value;try{await N(a,s,l)}catch(e){}},z=async(e,s)=>{if(window.confirm("'".concat(s,"' 파일을 삭제하시겠습니까?")))try{await f(e)}catch(e){}},I=async e=>{if(e.preventDefault(),!w.isValid){t.Am.error("모든 필수 항목을 입력해주세요.");return}try{await E("update",a)}catch(e){}},P=async()=>{try{await b(a)}catch(e){}},A=(e,s)=>{x.qx.downloadFile(e,s)};return j||!p?(0,l.jsx)(r.Z,{leftItems:[],auth:!1,props:{},noLogin:!1,children:(0,l.jsxs)("div",{className:"cms_wrap",children:[(0,l.jsx)(d.Z,{tab:"projects",on_menu:!1}),(0,l.jsx)("main",{className:"project edit",children:(0,l.jsxs)("div",{className:"loading-spinner",children:[(0,l.jsx)("div",{className:"spinner"}),(0,l.jsx)("p",{children:"프로젝트를 불러오는 중..."})]})})]})}):v.canEdit?(0,l.jsx)(r.Z,{leftItems:[],auth:!1,props:{},noLogin:!1,children:(0,l.jsxs)("div",{className:"cms_wrap",children:[(0,l.jsx)(d.Z,{tab:"projects",on_menu:!1}),(0,l.jsxs)("main",{className:"project edit",children:[(0,l.jsx)("div",{className:"title",children:"프로젝트 편집"}),(0,l.jsxs)("form",{onSubmit:I,className:"content",children:[(0,l.jsx)("div",{className:"group grid",children:(0,l.jsx)(o.$b,{inputs:_,onChange:C,errors:w.errors,disabled:y})}),(0,l.jsxs)("div",{className:"group grid mt50",children:[(0,l.jsxs)("div",{className:"part",children:[(0,l.jsx)("div",{className:"s_title",children:"멤버 초대"}),(0,l.jsx)(o.b3,{project_id:a,set_current_project:e=>{e&&u(a)},pending_list:p.pending_list,disabled:y})]}),(0,l.jsxs)("div",{className:"part authority",children:[(0,l.jsx)("div",{className:"s_title",children:"멤버 관리"}),(0,l.jsx)("ul",{children:p.member_list.map(e=>(0,l.jsxs)("li",{className:"flex align_center space_between",children:[(0,l.jsxs)("span",{className:"member-info",children:[(0,l.jsx)("strong",{children:e.nickname}),(0,l.jsxs)("span",{className:"email",children:["(",e.email,")"]})]}),(0,l.jsxs)("select",{onChange:s=>L(s,e.id),name:"rating",value:e.rating,disabled:y,"aria-label":"".concat(e.nickname," 권한 변경"),children:[(0,l.jsx)("option",{value:"manager",children:"관리자"}),(0,l.jsx)("option",{value:"normal",children:"일반"})]})]},e.id))})]})]}),(0,l.jsx)("div",{className:"group mt50",children:(0,l.jsxs)("div",{className:"part day",children:[(0,l.jsx)("div",{className:"s_title",children:"프로젝트 일정"}),(0,l.jsx)(o.fx,{process:g,set_process:k,disabled:y})]})}),(0,l.jsxs)("div",{className:"group grid mt50",children:[(0,l.jsxs)("div",{className:"part file",children:[(0,l.jsx)("div",{className:"s_title",children:"문서 양식"}),(0,l.jsx)("ul",{className:"sample",children:0===h.length?(0,l.jsx)("li",{className:"no-files",children:"등록된 샘플 파일이 없습니다."}):(0,l.jsx)("li",{children:h.map(e=>{let s=x.qx.extractFileName(e.file_name);return(0,l.jsx)("button",{type:"button",onClick:()=>A(e.files,s),className:"sample-file","aria-label":"".concat(s," 샘플 파일 다운로드"),children:s},e.id)})})})]}),(0,l.jsxs)("div",{className:"part file",children:[(0,l.jsx)("div",{className:"s_title",children:"파일 등록"}),(0,l.jsxs)("ul",{className:"sample",children:[p.files.map(e=>{let s=x.qx.extractFileName(e.file_name);return(0,l.jsxs)("li",{className:"existing-file",children:[(0,l.jsx)("button",{type:"button",onClick:()=>x.qx.downloadFile(e.files,s),className:"file-download",children:s}),(0,l.jsx)("button",{type:"button",onClick:()=>z(e.id,s),disabled:y,className:"delete-btn","aria-label":"".concat(s," 파일 삭제"),children:"삭제"})]},e.id)}),F.map((e,s)=>(0,l.jsxs)("li",{className:"new-file",children:[(0,l.jsx)("span",{className:"file-name",children:e.name}),(0,l.jsxs)("span",{className:"file-size",children:["(",(e.size/1024/1024).toFixed(2),"MB)"]}),(0,l.jsx)("button",{type:"button",onClick:()=>q(s),disabled:y,className:"delete-btn","aria-label":"".concat(e.name," 파일 삭제"),children:"삭제"})]},"new-".concat(s))),(0,l.jsxs)("li",{className:"upload_button",children:[(0,l.jsx)("label",{htmlFor:"file",className:"file-upload-label",children:(0,l.jsx)("div",{className:"btn-upload",children:"파일 업로드"})}),(0,l.jsx)("input",{type:"file",name:"file",id:"file",onChange:Z,disabled:y,multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.zip,.rar","aria-label":"파일 선택"})]})]})]})]}),(0,l.jsxs)("div",{className:"btn_wrap",children:[(0,l.jsx)("button",{type:"submit",className:"submit",disabled:y||!w.isValid,children:y?"수정 중...":"수정"}),(0,l.jsx)("button",{type:"button",onClick:P,className:"submit del",disabled:y,children:"삭제"}),(0,l.jsx)("button",{type:"button",onClick:()=>{e.push("/projects/".concat(a,"/view"))},className:"submit cancel",disabled:y,children:"취소"})]})]})]})]})}):(0,l.jsx)(r.Z,{leftItems:[],auth:!1,props:{},noLogin:!1,children:(0,l.jsxs)("div",{className:"cms_wrap",children:[(0,l.jsx)(d.Z,{tab:"projects",on_menu:!1}),(0,l.jsx)("main",{className:"project edit",children:(0,l.jsxs)("div",{className:"error-message",children:[(0,l.jsx)("h2",{children:"접근 권한이 없습니다"}),(0,l.jsx)("p",{children:"이 프로젝트를 편집할 권한이 없습니다."}),(0,l.jsx)("button",{onClick:()=>e.push("/Calendar"),className:"submit",children:"프로젝트 목록으로 돌아가기"})]})})]})})}}},function(e){e.O(0,[711,990,500,41,919,145,565,985,524,971,117,744],function(){return e(e.s=96351)}),_N_E=e.O()}]);
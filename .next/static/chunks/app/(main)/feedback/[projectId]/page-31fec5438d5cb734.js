(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[21],{52696:function(e,a,t){Promise.resolve().then(t.bind(t,97939))},97939:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return T}});var s=t(57437),n=t(2265),r=t(99376),l=t(32603),c=t(77398),i=t.n(c),o=t(16323),d=t(80589),u=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1?arguments[1]:void 0,[t,s]=(0,n.useState)(e),r=a?a[t]:null;return{currentTab:t,changeTab:e=>{s(e)},currentItem:r,changeItem:e=>{s(e)}}},m=t(83464),h=t(25566);let x=h.env.NEXT_PUBLIC_BACKEND_API_URL||h.env.REACT_APP_BACKEND_API_URL,b=m.Z.create({...x&&{baseURL:x},timeout:3e4,headers:{"Content-Type":"application/json"}});function v(e){var a,t,s,n,r,l;let c=Error((null===(t=e.response)||void 0===t?void 0:null===(a=t.data)||void 0===a?void 0:a.message)||e.message||"Unknown error");return c.code=(null===(n=e.response)||void 0===n?void 0:null===(s=n.data)||void 0===s?void 0:s.code)||"UNKNOWN_ERROR",c.status=null===(r=e.response)||void 0===r?void 0:r.status,c.details=null===(l=e.response)||void 0===l?void 0:l.data,c}async function j(e){try{var a;let t=await b.get("/feedbacks/".concat(e));if(null===(a=t.data.data)||void 0===a?void 0:a.result)return t.data.data.result;if(t.data.result)return t.data.result;throw Error("Invalid response format")}catch(e){throw v(e)}}async function p(e,a){try{let t=await b.put("/feedbacks/".concat(a),e);if(t.data.result)return t.data.result;throw Error("Invalid response format")}catch(e){throw v(e)}}async function f(e){try{await b.delete("/feedbacks/".concat(e))}catch(e){throw v(e)}}async function g(e,a,t){try{let s=new FormData;s.append("files",e);let n={headers:{"Content-Type":"multipart/form-data"},...t&&{onUploadProgress:t}};return(await b.post("/feedbacks/".concat(a),s,n)).data}catch(e){throw v(e)}}async function N(e){try{await b.delete("/feedbacks/file/".concat(e))}catch(e){throw v(e)}}b.interceptors.request.use(e=>{let a=localStorage.getItem("accessToken")||localStorage.getItem("token");return a&&(e.headers.Authorization="Bearer ".concat(a)),e},e=>Promise.reject(e)),b.interceptors.response.use(e=>e,async e=>{var a;let t=e.config;if((null===(a=e.response)||void 0===a?void 0:a.status)===401&&!t._retry){t._retry=!0;try{let e=localStorage.getItem("refreshToken");if(e){let{access:a}=(await m.Z.post("".concat(x,"/auth/refresh/"),{refresh:e})).data;return localStorage.setItem("accessToken",a),t.headers.Authorization="Bearer ".concat(a),b(t)}}catch(e){return localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),window.location.href="/login",Promise.reject(e)}}return Promise.reject(v(e))});let k={MAX_MESSAGE_LENGTH:1e3,MAX_SECTION_LENGTH:10,MAX_FILE_SIZE:104857600,ALLOWED_VIDEO_TYPES:["video/mp4","video/webm","video/quicktime","video/x-msvideo"],SOCKET_RECONNECT_INTERVAL:3e3,MAX_RECONNECT_ATTEMPTS:5,SESSION_STORAGE_KEY:"feedback_chat_session"},{SESSION_STORAGE_KEY:y,SOCKET_RECONNECT_INTERVAL:w,MAX_RECONNECT_ATTEMPTS:_}=k,C={secret:!1,title:"",section:"",contents:""},S=(0,n.memo)(e=>{let{project_id:a,refetch:t,onSubmit:r}=e,{values:l,errors:c,isValid:i,isSubmitting:o,handleChange:d,handleSubmit:u,getFieldError:m}=function(e){let{onSubmit:a,initialValues:t={},validateOnChange:s=!1}=e,[r,l]=(0,n.useState)({...C,...t}),[c,i]=(0,n.useState)({}),[o,d]=(0,n.useState)(!1),[u,m]=(0,n.useState)({secret:!1,title:!1,section:!1,contents:!1}),h=(0,n.useCallback)(e=>{let a=r[e],t="";switch(e){case"secret":!0!==a&&!1!==a&&"true"!==a&&"false"!==a&&(t="익명 여부를 선택해주세요.");break;case"section":if(a&&("string"!=typeof a||""!==a.trim())){var s;"string"!=typeof a||(s=a.trim(),/^(?:(?:([01]?\d|2[0-3]):)?([0-5]?\d):)?([0-5]?\d)$/.test(s))||(t="올바른 시간 형식을 입력해주세요. (예: 05:30)")}else t="구간을 입력해주세요.";break;case"contents":a&&("string"!=typeof a||""!==a.trim())?"string"==typeof a&&a.trim().length<2?t="내용은 최소 2자 이상 입력해주세요.":"string"==typeof a&&a.length>1e3&&(t="내용은 1000자를 초과할 수 없습니다."):t="내용을 입력해주세요."}return i(a=>({...a,[e]:t||void 0})),!t},[r]),x=(0,n.useCallback)(()=>{let e=Object.values({secret:h("secret"),title:h("title"),section:h("section"),contents:h("contents")}).every(Boolean);return e?i(e=>{let{general:a,...t}=e;return t}):i(e=>({...e,general:"입력란을 올바르게 채워주세요."})),e},[h]),b=(0,n.useCallback)((e,a)=>{l(t=>({...t,[e]:a})),m(a=>({...a,[e]:!0})),s&&setTimeout(()=>h(e),0)},[h,s]),v=(0,n.useCallback)(e=>{l(a=>({...a,...e}));let a=Object.keys(e);m(e=>{let t={...e};return a.forEach(e=>{t[e]=!0}),t})},[]),j=(0,n.useCallback)(()=>{l({...C,...t}),i({}),m({secret:!1,title:!1,section:!1,contents:!1}),d(!1);try{document.getElementsByName("secret").forEach(e=>{e.checked=!1})}catch(e){console.warn("Failed to reset radio buttons:",e)}},[t]),p=(0,n.useCallback)(async()=>{if(m({secret:!0,title:!0,section:!0,contents:!0}),x()){d(!0),i(e=>{let{general:a,...t}=e;return t});try{let e={secret:!0===r.secret||"true"===r.secret,title:r.title,section:r.section.toString().trim(),contents:r.contents.toString().trim()};await a(e),j()}catch(a){console.error("Form submission error:",a);let e=a instanceof Error?a.message:"피드백 등록 중 오류가 발생했습니다.";i(a=>({...a,general:e}))}finally{d(!1)}}},[r,x,a,j]),f=(0,n.useMemo)(()=>{let e=(!0===r.secret||!1===r.secret||"true"===r.secret||"false"===r.secret)&&""!==r.section.toString().trim()&&""!==r.contents.toString().trim(),a=0===Object.keys(c).length||1===Object.keys(c).length&&c.general;return!!(e&&a)},[r,c]),g=(0,n.useCallback)(e=>u[e]&&c[e],[u,c]),N=(0,n.useCallback)(e=>g(e)?c[e]:void 0,[g,c]),k=(0,n.useMemo)(()=>o?"submitting":f?Object.values(u).some(Boolean)?"dirty":"pristine":"invalid",[o,f,u]);return{values:r,errors:c,isValid:f,isSubmitting:o,handleChange:b,handleSubmit:p,reset:j,setValues:v,validateField:h,validateForm:x,touched:u,shouldShowError:g,getFieldError:N,formStatus:k}}({onSubmit:async e=>{r&&await r(e),t()},validateOnChange:!0}),{secret:h,section:x,contents:b}=l,v=e=>{d("secret","true"===e.target.value)},j=e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),u())};return(0,s.jsxs)("div",{className:"form",children:[(0,s.jsxs)("div",{className:"flex align_center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("input",{type:"radio",id:"user_type_anonymous",name:"secret",value:"true",checked:!0===h||"true"===h,onChange:v,className:"ty02","aria-label":"익명으로 피드백 등록"}),(0,s.jsx)("label",{htmlFor:"user_type_anonymous",children:"익명"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("input",{type:"radio",id:"user_type_normal",name:"secret",value:"false",checked:!1===h||"false"===h,onChange:v,className:"ty02","aria-label":"일반으로 피드백 등록"}),(0,s.jsx)("label",{htmlFor:"user_type_normal",children:"일반"})]})]}),m("secret")&&(0,s.jsx)("div",{className:"error-message mt10",role:"alert",children:m("secret")}),(0,s.jsxs)("div",{className:"input-group mt20",children:[(0,s.jsx)("input",{type:"text",name:"section",value:x,placeholder:"구간 입력 (예: 05:30)",onChange:e=>d("section",e.target.value),onKeyDown:j,className:"ty01 ".concat(m("section")?"error":""),maxLength:10,"aria-label":"피드백 구간 타임스탬프","aria-describedby":m("section")?"section-error":void 0}),m("section")&&(0,s.jsx)("div",{id:"section-error",className:"error-message mt5",role:"alert",children:m("section")})]}),(0,s.jsxs)("div",{className:"input-group mt20",children:[(0,s.jsx)("input",{type:"text",name:"contents",value:b,placeholder:"내용 입력",onChange:e=>d("contents",e.target.value),onKeyDown:j,className:"ty01 ".concat(m("contents")?"error":""),maxLength:1e3,"aria-label":"피드백 내용","aria-describedby":m("contents")?"contents-error":void 0}),m("contents")&&(0,s.jsx)("div",{id:"contents-error",className:"error-message mt5",role:"alert",children:m("contents")})]}),c.general&&(0,s.jsx)("div",{className:"error-message mt20",role:"alert",children:c.general}),(0,s.jsx)("button",{onClick:u,disabled:!i||o,className:"submit mt40 ".concat(o?"loading":""),"aria-label":"피드백 등록",children:o?"등록 중...":"피드백 등록"}),(0,s.jsx)("div",{className:"sr-only","aria-live":"polite",children:o&&"피드백을 등록하고 있습니다. 잠시만 기다려주세요."})]})});S.displayName="FeedbackInput";let E=(0,n.memo)(e=>{let{projectId:a,currentUser:t,onMessage:r}=e,[l,c]=(0,n.useState)(""),i=(0,n.useRef)(null),o=(0,n.useRef)(null),{connected:d,messages:u,sendMessage:m,reconnecting:x}=function(e){let{projectId:a,autoReconnect:t=!0,onConnect:s,onDisconnect:r,onError:l,onMessage:c}=e,i=(0,n.useRef)(null),o=(0,n.useRef)(null),d=(0,n.useRef)(0),u=(0,n.useRef)(!0),[m,x]=(0,n.useState)(!1),[b,v]=(0,n.useState)([]),[j,p]=(0,n.useState)(!1),f=(0,n.useCallback)(()=>{try{let e=sessionStorage.getItem(y);if(e){let t=JSON.parse(e);t.id===a&&Array.isArray(t.items)&&v(t.items)}}catch(e){console.warn("Failed to load messages from session storage:",e)}},[a]),g=(0,n.useCallback)(e=>{try{if(e.length>0){let t={id:a,items:e,lastUpdated:new Date().toISOString()};sessionStorage.setItem(y,JSON.stringify(t))}}catch(e){console.warn("Failed to save messages to session storage:",e)}},[a]),N=(0,n.useCallback)(()=>{o.current&&(clearTimeout(o.current),o.current=null),i.current&&(i.current.close(),i.current=null),x(!1),p(!1)},[]),C=(0,n.useCallback)(()=>{if(u.current&&t){if(d.current>=_){console.error("Max reconnection attempts reached"),p(!1);return}p(!0),o.current=setTimeout(()=>{u.current&&(d.current+=1,console.log("Attempting to reconnect... (".concat(d.current,"/").concat(_,")")),S())},w)}},[t]),S=(0,n.useCallback)(()=>{var e;if(a&&(null===(e=i.current)||void 0===e?void 0:e.readyState)!==WebSocket.OPEN){N();try{let e=function(e){let a=h.env.NEXT_PUBLIC_SOCKET_URI||h.env.REACT_APP_SOCKET_URI;return"".concat(a,"/ws/chat/").concat(e,"/")}(a);i.current=new WebSocket(e),i.current.onopen=()=>{u.current&&(console.log("WebSocket connected to:",e),x(!0),p(!1),d.current=0,f(),null==s||s())},i.current.onmessage=e=>{if(u.current)try{let a=JSON.parse(e.data).result;a&&(v(e=>{let t=[...e,a];return g(t),t}),null==c||c(a))}catch(e){console.error("Failed to parse WebSocket message:",e)}},i.current.onclose=e=>{u.current&&(console.log("WebSocket disconnected:",e.code,e.reason),x(!1),null==r||r(),1e3!==e.code&&t&&u.current&&C())},i.current.onerror=e=>{u.current&&(console.error("WebSocket error:",e),x(!1),null==l||l(e),t&&u.current&&C())}}catch(e){console.error("Failed to create WebSocket connection:",e),t&&u.current&&C()}}},[a,N,f,g,s,r,l,c,t,C]),E=(0,n.useCallback)(e=>{if(!i.current||i.current.readyState!==WebSocket.OPEN){alert("채팅 서버가 불안정합니다. 재접속 해주세요.");return}if(e.message&&e.message.trim()){if(e.message.length>k.MAX_MESSAGE_LENGTH){alert("메시지는 ".concat(k.MAX_MESSAGE_LENGTH,"자를 초과할 수 없습니다."));return}try{let a={email:e.email,nickname:e.nickname,rating:e.rating,message:e.message.trim()};i.current.send(JSON.stringify(a))}catch(e){console.error("Failed to send message:",e),alert("메시지 전송에 실패했습니다.")}}},[]),D=(0,n.useCallback)(()=>{v([]);try{sessionStorage.removeItem(y)}catch(e){console.warn("Failed to clear session storage:",e)}},[]),M=(0,n.useCallback)(()=>{if(!i.current)return"disconnected";switch(i.current.readyState){case WebSocket.CONNECTING:return"connecting";case WebSocket.OPEN:return"connected";case WebSocket.CLOSING:return"closing";case WebSocket.CLOSED:return"disconnected";default:return"unknown"}},[]);return(0,n.useEffect)(()=>(u.current=!0,a&&S(),()=>{u.current=!1,N()}),[a,S,N]),(0,n.useEffect)(()=>{D()},[a,D]),(0,n.useEffect)(()=>{b.length>0&&g(b)},[b,g]),{connected:m,messages:b,reconnecting:j,sendMessage:E,connect:S,disconnect:N,clearMessages:D,ws:i,connectionStatus:M()}}({projectId:a,...r&&{onMessage:r}}),b=(0,n.useCallback)(()=>{let e=l.trim();if(!d){alert("채팅 서버가 불안정합니다. 재접속 해주세요.");return}if(!t){alert("로그인이 필요합니다.");return}e&&(m({email:t.email,nickname:t.nickname,rating:t.rating,message:e}),c(""),setTimeout(()=>{var e;null===(e=o.current)||void 0===e||e.focus()},0))},[l,d,t,m]),v=(0,n.useCallback)(e=>{"Enter"===e.key&&(e.preventDefault(),b())},[b]),j=(0,n.useCallback)(()=>{i.current&&i.current.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},[]);(0,n.useEffect)(()=>{j()},[u,j]);let p=(0,n.useCallback)(e=>"manager"===e?"관리자":"일반",[]),f=()=>x?"재연결 중...":d?"연결됨":"연결 끊김";return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"connection-status ".concat(d?"connected":"disconnected"),children:(0,s.jsx)("span",{className:"status-indicator","aria-label":"채팅 상태: ".concat(f()),children:f()})}),(0,s.jsx)("div",{className:"comment",role:"log","aria-live":"polite","aria-label":"채팅 메시지",children:(0,s.jsxs)("ul",{children:[u.length>0?u.map((e,a)=>(0,s.jsxs)("li",{className:"message-item ".concat(e.email===(null==t?void 0:t.email)?"own-message":""),children:[(0,s.jsxs)("div",{className:"flex align_center",children:[(0,s.jsx)("div",{className:"관리자"===p(e.rating)?"img_box admin":"img_box basic","aria-hidden":"true"}),(0,s.jsxs)("div",{className:"txt_box",children:[(0,s.jsxs)("span",{className:"name",children:[e.nickname,(0,s.jsxs)("small",{className:"관리자"===p(e.rating)?"admin":"basic",children:["(",p(e.rating),")"]})]}),(0,s.jsx)("span",{className:"email",children:e.email})]})]}),(0,s.jsx)("div",{className:"comment_box",children:e.message})]},"".concat(e.id||a,"-").concat(e.email,"-").concat(a))):(0,s.jsx)("li",{className:"empty",children:(0,s.jsx)("div",{className:"empty-message",children:"웹페이지를 닫을 경우 대화 내용은 저장되지 않습니다."})}),(0,s.jsx)("div",{ref:i})]})}),t&&(0,s.jsxs)("div",{className:"pr",children:[(0,s.jsxs)("div",{className:"input-container",children:[(0,s.jsx)("input",{ref:o,type:"text",value:l,onChange:e=>c(e.target.value),onKeyUp:v,placeholder:d?"채팅 입력":"연결 중...",className:"ty01",style:{padding:"0 120px 0 15px"},disabled:!d||!t,maxLength:1e3,"aria-label":"채팅 메시지 입력","aria-describedby":"send-button"}),(0,s.jsx)("button",{id:"send-button",onClick:b,disabled:!d||!t||!l.trim(),className:"cert","aria-label":"메시지 전송",children:"입력"})]}),!d&&(0,s.jsx)("div",{className:"input-status error",role:"alert",children:"채팅 서버 연결 중입니다. 잠시만 기다려주세요."}),d&&l.length>900&&(0,s.jsxs)("div",{className:"input-status warning",role:"alert",children:[1e3-l.length,"자 남음"]})]}),!t&&(0,s.jsx)("div",{className:"login-required",role:"alert",children:"채팅에 참여하려면 로그인이 필요합니다."}),(0,s.jsxs)("div",{className:"sr-only","aria-live":"polite",children:[x&&"채팅 서버에 재연결하고 있습니다.",!d&&!x&&"채팅 서버 연결이 끊어졌습니다."]})]})});E.displayName="FeedbackMessage";let D=(0,n.memo)(e=>{let{currentProject:a,currentUser:t,onDeleteFeedback:r,loading:l=!1}=e,[c,i]=(0,n.useState)(new Set),o=(0,n.useMemo)(()=>(null==a?void 0:a.feedback)&&t?a.feedback.filter(e=>e.email===t):[],[null==a?void 0:a.feedback,t]),d=(0,n.useCallback)(async e=>{if(!c.has(e))try{i(a=>new Set(a).add(e)),await r(e)}catch(a){console.error("Failed to delete feedback:",a),i(a=>{let t=new Set(a);return t.delete(e),t})}finally{setTimeout(()=>{i(a=>{let t=new Set(a);return t.delete(e),t})},1e3)}},[r,c]),u=(0,n.useCallback)(e=>{if(/^\d{1,2}:\d{2}$/.test(e))return e;let a=e.replace(/\D/g,"");return a.length<=2?a:a.length<=4?"".concat(a.slice(0,2),":").concat(a.slice(2)):e},[]);return l?(0,s.jsx)("div",{className:"history loading",children:(0,s.jsxs)("div",{className:"loading-indicator",children:[(0,s.jsx)("div",{className:"spinner"}),(0,s.jsx)("span",{children:"피드백을 불러오는 중..."})]})}):(0,s.jsxs)("div",{className:"history",children:[(0,s.jsx)("ul",{children:o.length>0?o.map(e=>{let a=c.has(e.id);return(0,s.jsx)("li",{className:"feedback-item ".concat(a?"deleting":""),children:(0,s.jsxs)("div",{className:"flex align_center space_between",children:[(0,s.jsxs)("div",{className:"txt_box",children:[(0,s.jsx)("div",{className:"time",children:u(e.section)}),(0,s.jsx)("p",{className:"feedback-content",children:e.text||e.contents}),(0,s.jsxs)("div",{className:"metadata",children:[(0,s.jsx)("small",{className:"created-date",children:new Date(e.created).toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),(e.secret||e.security)&&(0,s.jsx)("span",{className:"anonymous-badge",children:"익명"})]})]}),(0,s.jsx)("button",{onClick:()=>d(e.id),disabled:a,className:"delete ".concat(a?"loading":""),"aria-label":"피드백 삭제: ".concat(u(e.section)),children:a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"spinner-small"}),"삭제 중..."]}):"삭제"})]})},e.id)}):(0,s.jsx)("li",{className:"empty-state",children:(0,s.jsxs)("div",{className:"flex mt50 justify_center flex_column align_center",children:[(0,s.jsx)("div",{className:"empty-icon"}),(0,s.jsx)("p",{className:"empty-message",children:"작성한 피드백이 없습니다."}),(0,s.jsx)("small",{className:"empty-description",children:"피드백 등록 탭에서 새로운 피드백을 작성해보세요."})]})})}),o.length>0&&(0,s.jsx)("div",{className:"feedback-stats",children:(0,s.jsxs)("div",{className:"stats-item",children:[(0,s.jsx)("span",{className:"stats-label",children:"총 피드백"}),(0,s.jsxs)("span",{className:"stats-value",children:[o.length,"개"]})]})}),(0,s.jsx)("div",{className:"sr-only","aria-live":"polite",children:Array.from(c).length>0&&"".concat(Array.from(c).length,"개의 피드백을 삭제하고 있습니다.")})]})});D.displayName="FeedbackManage";let M=(0,n.memo)(e=>{let{currentProject:a,onTimestampClick:t}=e,[r,l]=(0,n.useState)(null),c=(0,n.useMemo)(()=>{if(!(null==a?void 0:a.feedback))return[];let e={};return a.feedback.forEach(a=>{let t=i()(a.created).format("YYYY.MM.DD.dd");e[t]?e[t].push(a):e[t]=[a]}),Object.entries(e).map(e=>{let[a,t]=e;return{date:a,feedbacks:t.sort((e,a)=>new Date(a.created).getTime()-new Date(e.created).getTime())}}).sort((e,a)=>i()(a.date,"YYYY.MM.DD.dd").valueOf()-i()(e.date,"YYYY.MM.DD.dd").valueOf())},[null==a?void 0:a.feedback]),o=(0,n.useCallback)(e=>{l(e),t&&t(e.section)},[t]),d=(0,n.useCallback)(e=>{e.stopPropagation(),l(null)},[]),u=(0,n.useCallback)((e,a)=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),o(a))},[o]),m=(0,n.useCallback)(e=>{"Escape"===e.key&&l(null)},[]),h=(0,n.useCallback)(e=>{if(/^\d{1,2}:\d{2}$/.test(e))return e;let a=e.replace(/\D/g,"");return a.length<=2?a:a.length<=4?"".concat(a.slice(0,2),":").concat(a.slice(2)):e},[]),x=(0,n.useCallback)(e=>"manager"===e?"관리자":"일반",[]);return 0===c.length?(0,s.jsx)("div",{className:"feedback-empty",children:(0,s.jsxs)("div",{className:"empty-state",children:[(0,s.jsx)("div",{className:"empty-icon"}),(0,s.jsx)("p",{children:"등록된 피드백이 없습니다."}),(0,s.jsx)("small",{children:"첫 번째 피드백을 등록해보세요."})]})}):(0,s.jsxs)(s.Fragment,{children:[c.map((e,a)=>(0,s.jsxs)("div",{className:"box",children:[(0,s.jsx)("div",{className:"day",children:e.date}),(0,s.jsx)("ul",{children:e.feedbacks.map((e,a)=>(0,s.jsxs)("li",{className:"feedback-timestamp ".concat(r&&r.id===e.id?"on":""),onClick:()=>o(e),onKeyDown:a=>u(a,e),tabIndex:0,role:"button","aria-label":"피드백: ".concat(h(e.section)," - ").concat(e.nickname),"aria-expanded":(null==r?void 0:r.id)===e.id,children:[(0,s.jsx)("span",{className:"timestamp-text",children:h(e.section)}),(e.secret||e.security)&&(0,s.jsx)("span",{className:"anonymous-indicator","aria-label":"익명",children:"\uD83D\uDD12"}),r&&r.id===e.id&&(0,s.jsxs)("div",{className:"view-container",onKeyDown:m,role:"dialog","aria-modal":"true","aria-labelledby":"feedback-title-".concat(e.id),"aria-describedby":"feedback-content-".concat(e.id),children:[(0,s.jsx)("div",{className:"view",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"txt_box",children:r.security||r.secret?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"name",id:"feedback-title-".concat(e.id),children:"익명"}),(0,s.jsx)("span",{className:"timestamp",children:h(r.section)})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("span",{className:"name",id:"feedback-title-".concat(e.id),children:[r.nickname,(0,s.jsxs)("small",{className:"관리자"===x(r.rating)?"admin":"basic",children:["(",x(r.rating),")"]})]}),(0,s.jsx)("span",{className:"email",children:r.email}),(0,s.jsx)("span",{className:"timestamp",children:h(r.section)})]})}),(0,s.jsx)("div",{className:"comment_box",id:"feedback-content-".concat(e.id),children:r.text||r.contents}),(0,s.jsx)("div",{className:"feedback-meta",children:(0,s.jsx)("small",{className:"created-time",children:i()(r.created).format("YYYY년 MM월 DD일 HH:mm")})})]})}),(0,s.jsx)("button",{className:"close-button",onClick:d,"aria-label":"피드백 상세보기 닫기",autoFocus:!0,children:"✕"})]})]},"".concat(e.id,"-").concat(a)))})]},e.date)),(0,s.jsxs)("div",{className:"feedback-summary",children:[(0,s.jsxs)("div",{className:"summary-item",children:[(0,s.jsx)("span",{className:"summary-label",children:"총 피드백"}),(0,s.jsxs)("span",{className:"summary-value",children:[c.reduce((e,a)=>e+a.feedbacks.length,0),"개"]})]}),(0,s.jsxs)("div",{className:"summary-item",children:[(0,s.jsx)("span",{className:"summary-label",children:"활동 일수"}),(0,s.jsxs)("span",{className:"summary-value",children:[c.length,"일"]})]})]}),(0,s.jsx)("div",{className:"sr-only","aria-live":"polite",children:r&&"".concat(r.nickname,"의 피드백이 열렸습니다. ESC 키를 눌러 닫을 수 있습니다.")})]})});M.displayName="FeedbackMore";let I=(0,n.memo)(e=>{let{url:a,SetVideoLoad:t,onTimeUpdate:r,onSeek:l,onPlay:c,onPause:i,onLoadStart:o,onError:d,seekTime:u,className:m="",controls:h=!0,autoPlay:x=!1,muted:b=!1}=e,v=(0,n.useRef)(null),[j,p]=(0,n.useState)(0),[f,g]=(0,n.useState)(0),[N,k]=(0,n.useState)(!1),[y,w]=(0,n.useState)(1),[_,C]=(0,n.useState)(null);(0,n.useEffect)(()=>{v.current&&a&&v.current.load()},[a]),(0,n.useEffect)(()=>{v.current&&"number"==typeof u&&u>=0&&(v.current.currentTime=u,null==l||l(u))},[u,l]);let S=(0,n.useCallback)(()=>{if(v.current){let e=v.current.currentTime;p(e),null==r||r(e)}},[r]),E=(0,n.useCallback)(()=>{v.current&&g(v.current.duration)},[]),D=(0,n.useCallback)(()=>{t(!1),C(null)},[t]),M=(0,n.useCallback)(()=>{t(!0),null==o||o()},[t,o]),I=(0,n.useCallback)(()=>{k(!0),null==c||c()},[c]),T=(0,n.useCallback)(()=>{k(!1),null==i||i()},[i]),F=(0,n.useCallback)(e=>{let a=e.target,s=a.error?"비디오 로드 오류 (코드: ".concat(a.error.code,")"):"알 수 없는 비디오 오류";C(s),t(!1);let n=Error(s);null==d||d(n),console.error("Video error:",a.error)},[t,d]),O=(0,n.useCallback)(()=>{v.current&&w(v.current.volume)},[]),A=(0,n.useCallback)(e=>{if(isNaN(e))return"00:00";let a=Math.floor(e/3600),t=Math.floor(e%3600/60),s=Math.floor(e%60);return a>0?"".concat(a.toString().padStart(2,"0"),":").concat(t.toString().padStart(2,"0"),":").concat(s.toString().padStart(2,"0")):"".concat(t.toString().padStart(2,"0"),":").concat(s.toString().padStart(2,"0"))},[]),P=(0,n.useCallback)(e=>{if(!v.current||!f)return;let a=e.currentTarget.getBoundingClientRect(),t=(e.clientX-a.left)/a.width*f;v.current.currentTime=t,null==l||l(t)},[f,l]),L=(0,n.useCallback)(e=>{if(v.current)switch(e.key){case" ":e.preventDefault(),N?v.current.pause():v.current.play();break;case"ArrowLeft":e.preventDefault(),v.current.currentTime=Math.max(0,j-5);break;case"ArrowRight":e.preventDefault(),v.current.currentTime=Math.min(f,j+5);break;case"ArrowUp":e.preventDefault(),v.current.volume=Math.min(1,y+.1);break;case"ArrowDown":e.preventDefault(),v.current.volume=Math.max(0,y-.1)}},[N,j,f,y]);return _?(0,s.jsx)("div",{className:"video-error ".concat(m),children:(0,s.jsxs)("div",{className:"error-content",children:[(0,s.jsx)("div",{className:"error-icon",children:"⚠️"}),(0,s.jsx)("p",{className:"error-message",children:_}),(0,s.jsx)("button",{className:"retry-button",onClick:()=>{C(null),v.current&&v.current.load()},children:"다시 시도"})]})}):(0,s.jsxs)("div",{className:"video-player-container ".concat(m),children:[(0,s.jsxs)("video",{ref:v,width:"100%",height:"100%",controls:h,autoPlay:x,muted:b,controlsList:"nodownload",onTimeUpdate:S,onLoadedMetadata:E,onLoadedData:D,onLoadStart:M,onPlay:I,onPause:T,onError:F,onVolumeChange:O,onKeyDown:L,tabIndex:0,"aria-label":"피드백 비디오 플레이어",children:[(0,s.jsx)("source",{src:a,type:"video/mp4"}),(0,s.jsx)("source",{src:a,type:"video/webm"}),(0,s.jsx)("source",{src:a,type:"video/quicktime"}),(0,s.jsx)("source",{src:a,type:"video/ogg"}),(0,s.jsx)("source",{src:a,type:"video/x-msvideo"}),(0,s.jsx)("source",{src:a,type:"video/x-mplayer2"}),(0,s.jsx)("track",{kind:"captions",src:"",srcLang:"ko",label:"한국어"}),(0,s.jsxs)("div",{className:"video-fallback",children:[(0,s.jsx)("p",{children:"이 브라우저는 비디오 재생을 지원하지 않습니다."}),(0,s.jsx)("a",{href:a,download:!0,children:"비디오 다운로드"})]})]}),!h&&(0,s.jsxs)("div",{className:"custom-controls",children:[(0,s.jsx)("div",{className:"progress-container",onClick:P,children:(0,s.jsx)("div",{className:"progress-bar",children:(0,s.jsx)("div",{className:"progress-filled",style:{width:"".concat(f?j/f*100:0,"%")}})})}),(0,s.jsxs)("div",{className:"control-buttons",children:[(0,s.jsx)("button",{className:"play-pause-btn",onClick:()=>{v.current&&(N?v.current.pause():v.current.play())},"aria-label":N?"일시정지":"재생",children:N?"⏸️":"▶️"}),(0,s.jsxs)("span",{className:"time-display",children:[A(j)," / ",A(f)]})]})]}),(0,s.jsxs)("div",{className:"sr-only","aria-live":"polite",children:["현재 재생 시간: ",A(j),void 0!==u&&"".concat(A(u),"로 이동했습니다.")]})]})});function T(e){let{params:a}=e,t=(0,r.useRouter)(),{projectId:c}=a,{user:m}=(0,l.v9)(e=>e.ProjectStore),[h,x]=(0,n.useState)(!1),[b,v]=(0,n.useState)(void 0),k=(0,n.useRef)(null),{currentProject:y,feedbacks:w,loading:_,error:C,createFeedback:T,deleteFeedback:F,uploadVideo:O,deleteVideo:A,refetch:P,permissions:L,currentUser:R}=function(e){let a=(0,r.useRouter)(),{user:t}=(0,l.v9)(e=>e.ProjectStore),[s,c]=(0,n.useState)(null),[i,o]=(0,n.useState)(!1),[d,u]=(0,n.useState)(null),[m,h]=(0,n.useState)(0),x=(0,n.useMemo)(()=>(null==s?void 0:s.feedback)||[],[s]),b=(0,n.useMemo)(()=>{if(!s||!t)return{canManageFeedback:!1,canDeleteFeedback:!1,canUploadVideo:!1,canDeleteVideo:!1,canEditProject:!1,role:"basic"};let e=function(e,a){let t=e.owner_email===a,s=e.member_list.find(e=>e.email===a),n=t||(null==s?void 0:s.rating)==="manager";return{isOwner:t,isManager:n,canManageFeedback:n,canDeleteFeedback:n,canUploadVideo:n,canDeleteVideo:n}}(s,t),a=e.isOwner,n=e.isManager;return{canManageFeedback:n,canDeleteFeedback:n,canUploadVideo:n,canDeleteVideo:n,canEditProject:n,role:a?"owner":n?"manager":"basic"}},[s,t]),v=(0,n.useCallback)(e=>{console.error("Feedback error:",e),u(e instanceof Error&&(({"Network Error":"네트워크 연결을 확인해주세요.","Invalid token":"로그인이 만료되었습니다. 다시 로그인해주세요.","Permission denied":"권한이 없습니다.","File too large":"파일 크기가 너무 큽니다.","Invalid file type":"지원하지 않는 파일 형식입니다.","Project not found":"프로젝트를 찾을 수 없습니다.","Feedback not found":"피드백을 찾을 수 없습니다."})[e.message]||e.message)||"알 수 없는 오류가 발생했습니다."),(null==e?void 0:e.status)===401&&a.push("/login")},[a]),k=(0,n.useCallback)(e=>{u(null),window.alert&&window.alert(e)},[]),y=(0,n.useCallback)(async a=>{let t=a||e;if(t){o(!0),u(null);try{let e=await j(t);c(e)}catch(e){v(e)}finally{o(!1)}}},[e,v]),w=(0,n.useCallback)(async a=>{if(!e)throw Error("프로젝트 ID가 필요합니다.");o(!0),u(null);try{await p(a,e),k("피드백이 등록되었습니다."),await y()}catch(e){throw v(e),e}finally{o(!1)}},[e,y,v,k]),_=(0,n.useCallback)(async e=>{if(!b.canDeleteFeedback)throw Error("피드백을 삭제할 권한이 없습니다.");if(window.confirm("정말로 이 피드백을 삭제하시겠습니까?")){o(!0),u(null);try{await f(e),k("피드백이 삭제되었습니다."),await y()}catch(e){throw v(e),e}finally{o(!1)}}},[b.canDeleteFeedback,y,v,k]),C=(0,n.useCallback)(async a=>{if(!b.canUploadVideo)throw Error("비디오를 업로드할 권한이 없습니다.");if(!e)throw Error("프로젝트 ID가 필요합니다.");if(window.confirm("파일을 업로드 하시겠습니까?")){o(!0),u(null);try{await g(a,e,e=>{let a=Math.round(100*e.loaded/e.total);console.log("Upload progress: ".concat(a,"%"))}),k("파일이 업로드되었습니다."),await y()}catch(e){throw v(e),e}finally{o(!1)}}},[b.canUploadVideo,e,y,v,k]),S=(0,n.useCallback)(async()=>{if(!b.canDeleteVideo)throw Error("비디오를 삭제할 권한이 없습니다.");if(!e)throw Error("프로젝트 ID가 필요합니다.");if(window.confirm("파일을 삭제 하시겠습니까?")){o(!0),u(null);try{await N(e),k("파일이 삭제되었습니다."),await y()}catch(e){throw v(e),e}finally{o(!1)}}},[b.canDeleteVideo,e,y,v,k]),E=(0,n.useCallback)(()=>{h(Date.now())},[]),D=(0,n.useMemo)(()=>{if(!s||!t)return null;if(s.owner_email===t)return{email:s.owner_email,nickname:s.owner_nickname,rating:"manager"};let e=s.member_list.find(e=>e.email===t);return e?{email:e.email,nickname:e.nickname,rating:e.rating}:null},[s,t]);return(0,n.useEffect)(()=>{e&&y()},[e,m,y]),{currentProject:s,feedbacks:x,loading:i,error:d,fetchProject:y,createFeedback:w,deleteFeedback:_,uploadVideo:C,deleteVideo:S,refetch:E,permissions:b,currentUser:D}}(c),Y=(0,n.useMemo)(()=>{if(!y||!m)return null;if(y.owner_email===m)return{email:y.owner_email,nickname:y.owner_nickname,rating:"manager"};let e=y.member_list.find(e=>e.email===m);return e?{email:e.email,nickname:e.nickname,rating:e.rating}:null},[y,m]),U=(0,n.useCallback)(e=>"manager"===e?"관리자":"일반",[]),V=(0,n.useCallback)(async e=>{var a;let t=null===(a=e.target.files)||void 0===a?void 0:a[0];if(t)try{await O(t)}catch(e){console.error("File upload error:",e)}finally{e.target.value=""}},[O]),K=(0,n.useCallback)(async()=>{try{await A()}catch(e){console.error("File delete error:",e)}},[A]),W=(0,n.useCallback)(e=>{navigator.clipboard?navigator.clipboard.writeText(e).then(()=>{alert("링크가 복사되었습니다.")}).catch(()=>{Z(e)}):Z(e)},[]),Z=e=>{let a=document.createElement("textarea");a.value=e,document.body.appendChild(a),a.focus(),a.select();try{document.execCommand("copy"),alert("링크가 복사되었습니다.")}catch(e){console.error("Unable to copy:",e),alert("링크 복사에 실패했습니다.")}document.body.removeChild(a)},B=(0,n.useCallback)(e=>{let a=e.split(":").map(Number),t=0;2===a.length&&void 0!==a[0]&&void 0!==a[1]?t=60*a[0]+a[1]:3===a.length&&void 0!==a[0]&&void 0!==a[1]&&void 0!==a[2]&&(t=3600*a[0]+60*a[1]+a[2]),v(t),k.current&&k.current.scrollIntoView({behavior:"smooth"})},[]),G=(0,n.useCallback)(e=>{console.log("New chat message:",e)},[]),X=(0,n.useMemo)(()=>[{tab:"코멘트",content:y&&Y&&(0,s.jsx)(E,{projectId:c,currentUser:Y,onMessage:G})},{tab:"피드백 등록",content:(0,s.jsx)(S,{project_id:c,refetch:P,onSubmit:T})},{tab:"피드백 관리",content:y&&m&&(0,s.jsx)(D,{currentProject:y,currentUser:m,onDeleteFeedback:F,loading:_})},{tab:"멤버",content:y&&(0,s.jsx)("div",{className:"member",children:(0,s.jsxs)("ul",{children:[(0,s.jsxs)("li",{className:"admin",children:[(0,s.jsx)("div",{className:"img"}),(0,s.jsxs)("div",{className:"txt",children:[y.owner_nickname,"(관리자)",(0,s.jsx)("span",{children:y.owner_email})]})]}),y.member_list.map((e,a)=>(0,s.jsxs)("li",{className:"manager"===e.rating?"admin":"basic",children:[(0,s.jsx)("div",{className:"img"}),(0,s.jsxs)("div",{className:"txt",children:[e.nickname,"(",U(e.rating),")",(0,s.jsx)("span",{children:e.email})]})]},"".concat(e.email,"-").concat(a)))]})})},{tab:"프로젝트 정보",content:y&&(0,s.jsxs)("div",{className:"info",children:[(0,s.jsxs)("dl",{className:"flex align_center",children:[(0,s.jsx)("dt",{children:"담당자"}),(0,s.jsx)("dd",{children:y.manager})]}),(0,s.jsxs)("dl",{className:"flex align_center",children:[(0,s.jsx)("dt",{children:"고객사"}),(0,s.jsx)("dd",{children:y.consumer})]}),(0,s.jsxs)("dl",{className:"flex align_center",children:[(0,s.jsx)("dt",{children:"프로젝트 생성"}),(0,s.jsx)("dd",{children:i()(y.created).format("YYYY.MM.DD.dd")})]}),(0,s.jsxs)("dl",{className:"flex align_center",children:[(0,s.jsx)("dt",{children:"최종 업데이트"}),(0,s.jsx)("dd",{children:i()(y.updated).format("YYYY.MM.DD.dd")})]}),(0,s.jsxs)("dl",{children:[(0,s.jsx)("dt",{children:"프로젝트 세부 설명"}),(0,s.jsx)("dd",{className:"mt10",children:y.description})]}),L.canEditProject&&(0,s.jsx)("button",{className:"project_btn",onClick:()=>t.push("/projects/".concat(c,"/edit")),children:"프로젝트 관리"})]})}],[y,Y,c,G,P,T,m,F,_,U,L.canEditProject,t]),{currentItem:H,changeItem:q}=u(0,X)||{currentItem:null,changeItem:()=>{}};return _&&!y?(0,s.jsx)(o.Z,{leftItems:[],auth:!1,props:{},noLogin:!1,children:(0,s.jsxs)("div",{className:"cms_wrap",children:[(0,s.jsx)(d.Z,{tab:"feedback",on_menu:!1}),(0,s.jsx)("main",{children:(0,s.jsxs)("div",{className:"loading-container",children:[(0,s.jsx)("div",{className:"loading-spinner"}),(0,s.jsx)("p",{children:"프로젝트를 불러오는 중..."})]})})]})}):C?(0,s.jsx)(o.Z,{leftItems:[],auth:!1,props:{},noLogin:!1,children:(0,s.jsxs)("div",{className:"cms_wrap",children:[(0,s.jsx)(d.Z,{tab:"feedback",on_menu:!1}),(0,s.jsx)("main",{children:(0,s.jsxs)("div",{className:"error-container",children:[(0,s.jsx)("div",{className:"error-icon",children:"⚠️"}),(0,s.jsx)("h2",{children:"오류가 발생했습니다"}),(0,s.jsx)("p",{children:C}),(0,s.jsx)("button",{onClick:()=>P(),className:"retry-button",children:"다시 시도"})]})})]})}):y?(0,s.jsx)(o.Z,{leftItems:[],auth:!1,props:{},noLogin:!1,children:(0,s.jsxs)("div",{className:"cms_wrap",children:[(0,s.jsx)(d.Z,{tab:"feedback",on_menu:!1}),(0,s.jsx)("main",{children:(0,s.jsxs)("div",{className:"content feedback flex space_between",children:[(0,s.jsxs)("div",{className:"videobox",children:[(0,s.jsxs)("div",{ref:k,className:y.files?"video_inner active":"video_inner",children:[y.files?(0,s.jsx)(I,{url:y.files,SetVideoLoad:x,seekTime:b||0,onSeek:()=>v(void 0),className:"feedback-video"}):L.canUploadVideo&&(0,s.jsxs)("div",{className:"upload_btn_wrap",children:[(0,s.jsx)("input",{type:"file",accept:"video/*",onChange:V,className:"video_upload",id:"video-upload",name:"files"}),(0,s.jsx)("label",{htmlFor:"video-upload",className:"video_upload_label",children:(0,s.jsx)("div",{children:"영상 추가"})})]}),h&&(0,s.jsx)("div",{className:"loading",children:(0,s.jsx)("div",{className:"animation"})})]}),(0,s.jsxs)("div",{className:"etc_box",children:[(0,s.jsxs)("div",{className:"flex space_between align_center",children:[(0,s.jsx)("button",{onClick:()=>t.push("/feedback/all",{}),className:"all",children:"피드백 전체 보기"}),L.canUploadVideo&&y.files&&(0,s.jsxs)("div",{className:"good",children:[(0,s.jsxs)("div",{className:"change_btn_wrap",children:[(0,s.jsx)("input",{type:"file",accept:"video/*",onChange:V,name:"files",className:"video_upload",id:"video-change"}),(0,s.jsx)("label",{htmlFor:"video-change",className:"video_upload_label",children:(0,s.jsx)("div",{children:"교체"})})]}),(0,s.jsx)("div",{className:"change_btn_wrap",children:(0,s.jsx)("div",{className:"video_upload_label",children:(0,s.jsx)("div",{onClick:K,className:"delete",children:"삭제"})})})]}),y.files&&(0,s.jsx)("div",{onClick:()=>W(y.files),className:"share",role:"button",tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),W(y.files))},children:"공유"})]}),(0,s.jsx)("div",{className:"list",children:(0,s.jsx)(M,{currentProject:y,onTimestampClick:B})})]})]}),(0,s.jsxs)("div",{className:"sidebox",children:[(0,s.jsx)("div",{className:"b_title",children:(0,s.jsx)("div",{className:"s_title",children:H.tab})}),(0,s.jsxs)("div",{className:"top_box",children:[(0,s.jsx)("ul",{className:"tab_menu",children:X.map((e,a)=>(0,s.jsx)("li",{className:H.tab===e.tab?"active":"",onClick:()=>q(a),role:"button",tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),q(a))},children:e.tab},a))}),(0,s.jsx)("div",{className:"edit"})]}),(0,s.jsx)("div",{className:"tab_content",children:H.content})]})]})})]})}):(0,s.jsx)(o.Z,{leftItems:[],auth:!1,props:{},noLogin:!1,children:(0,s.jsxs)("div",{className:"cms_wrap",children:[(0,s.jsx)(d.Z,{tab:"feedback",on_menu:!1}),(0,s.jsx)("main",{children:(0,s.jsxs)("div",{className:"not-found-container",children:[(0,s.jsx)("div",{className:"not-found-icon",children:"\uD83D\uDCC2"}),(0,s.jsx)("h2",{children:"프로젝트를 찾을 수 없습니다"}),(0,s.jsx)("p",{children:"요청하신 프로젝트가 존재하지 않거나 접근 권한이 없습니다."}),(0,s.jsx)("button",{onClick:()=>t.push("/projects"),className:"back-button",children:"프로젝트 목록으로 돌아가기"})]})})]})})}I.displayName="VideoPlayer"}},function(e){e.O(0,[711,990,89,115,41,985,971,117,744],function(){return e(e.s=52696)}),_N_E=e.O()}]);
"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[524],{79916:function(e,a,t){t.d(a,{cancelProjectInvitation:function(){return c},qx:function(){return d}});var s=t(83464);let r=t(25566).env.NEXT_PUBLIC_BACKEND_API_URL||"http://localhost:8000",l=s.Z.create({baseURL:r,withCredentials:!0,timeout:3e4,headers:{"Content-Type":"application/json"}});l.interceptors.request.use(e=>{{let a=localStorage.getItem("access_token")||sessionStorage.getItem("access_token");a&&(e.headers.Authorization="Bearer ".concat(a))}return e},e=>Promise.reject(e)),l.interceptors.response.use(e=>e,async e=>{var a;let t=e.config;if((null===(a=e.response)||void 0===a?void 0:a.status)===401&&!t._retry){t._retry=!0;try{localStorage.getItem("refresh_token")}catch(e){localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),sessionStorage.clear(),window.location.href="/login"}}return Promise.reject(e)});let n=e=>{if(e.response){var a,t;return{message:(null===(a=e.response.data)||void 0===a?void 0:a.message)||"API 요청 중 오류가 발생했습니다.",code:null===(t=e.response.data)||void 0===t?void 0:t.code,status:e.response.status,details:e.response.data}}return e.request?{message:"서버에 연결할 수 없습니다. 네트워크를 확인해주세요.",status:0}:{message:e.message||"알 수 없는 오류가 발생했습니다.",status:-1}},i=async e=>{try{let a=await e();if(!a.data.success)throw Error(a.data.message||"API 요청이 실패했습니다.");return a.data.result}catch(e){throw n(e)}},c=async(e,a)=>i(()=>l.delete("/projects/invite_project/".concat(e),{data:{invitation_id:a}})),o=e=>{var a;return(null===(a=e.split("/").pop())||void 0===a?void 0:a.split("\\").pop())||"Unknown File"},d={fetchProjectList:async e=>i(async()=>{let a=new URLSearchParams;(null==e?void 0:e.query)&&a.append("search",e.query),(null==e?void 0:e.status)&&a.append("status",e.status),(null==e?void 0:e.manager)&&a.append("manager",e.manager),(null==e?void 0:e.consumer)&&a.append("consumer",e.consumer),(null==e?void 0:e.sortBy)&&a.append("sort_by",e.sortBy),(null==e?void 0:e.sortOrder)&&a.append("sort_order",e.sortOrder),(null==e?void 0:e.limit)&&a.append("limit",e.limit.toString()),(null==e?void 0:e.offset)&&a.append("offset",e.offset.toString());let t=a.toString();return l.get(t?"/projects/project_list?".concat(t):"/projects/project_list")}),fetchProject:async e=>i(()=>l.get("/projects/detail/".concat(e))),createProject:async e=>i(()=>l.post("/projects/create",e,{headers:{"Content-Type":"multipart/form-data"}})),updateProject:async(e,a)=>i(()=>l.post("/projects/detail/".concat(e),a,{headers:{"Content-Type":"multipart/form-data"}})),deleteProject:async e=>i(()=>l.delete("/projects/detail/".concat(e))),inviteProjectMember:async(e,a)=>i(()=>l.post("/projects/invite_project/".concat(e),{email:a})),cancelProjectInvitation:c,acceptProjectInvitation:async(e,a)=>i(()=>l.get("/projects/invite/".concat(e,"/").concat(a))),updateMemberRating:async(e,a,t)=>i(()=>l.post("/projects/member/".concat(e,"/").concat(a),{rating:t})),deleteProjectFile:async e=>i(()=>l.delete("/projects/file/delete/".concat(e))),uploadProjectFiles:async(e,a)=>{let t=new FormData;return a.forEach(e=>{t.append("files",e)}),t.append("project_id",e.toString()),i(()=>l.post("/projects/upload/".concat(e),t,{headers:{"Content-Type":"multipart/form-data"}}))},createProjectMemo:async(e,a,t)=>i(()=>l.post("/projects/memo/".concat(e),{content:a,date:t})),deleteProjectMemo:async e=>i(()=>l.delete("/projects/memo/".concat(e))),updateProjectDates:async(e,a)=>i(()=>l.post("/projects/date_update/".concat(e),a)),fetchProjectStatistics:async()=>i(()=>l.get("/projects/statistics")),fetchSampleFiles:async()=>i(()=>l.get("/projects/sample_files")),extractFileName:o,downloadFile:(e,a)=>{if(!e)return;let t=document.createElement("a");t.href=e,t.download=a||o(e),t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t)},createProjectFormData:(e,a,t,s)=>{let r=new FormData;return r.append("inputs",JSON.stringify(e)),r.append("process",JSON.stringify(a)),t.forEach(e=>{r.append("files",e)}),s&&r.append("members",JSON.stringify(s)),r},handleApiError:n,isProject:e=>e&&"object"==typeof e&&"number"==typeof e.id&&"string"==typeof e.name&&"string"==typeof e.description&&Array.isArray(e.files)&&Array.isArray(e.member_list),isApiError:e=>e&&"object"==typeof e&&"string"==typeof e.message&&"number"==typeof e.status};a.ZP=d},76524:function(e,a,t){t.d(a,{b3:function(){return I},fx:function(){return p},vz:function(){return C},$b:function(){return n},l2:function(){return _}});var s=t(57437),r=t(2265);let l=e=>{let{inputs:a,onChange:t,errors:r={},disabled:l=!1}=e,{name:n,manager:i,consumer:c,description:o}=a;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"part",children:[(0,s.jsx)("div",{className:"s_title",children:"프로젝트 이름"}),(0,s.jsx)("input",{type:"text",name:"name",placeholder:"프로젝트 이름",className:"ty01 mt10 ".concat(r.name?"error":""),value:n,onChange:t,maxLength:50,disabled:l,"aria-label":"프로젝트 이름","aria-describedby":r.name?"name-error":void 0,"aria-invalid":!!r.name}),r.name&&(0,s.jsx)("div",{id:"name-error",className:"error-message",role:"alert",children:r.name})]}),(0,s.jsxs)("div",{className:"part",children:[(0,s.jsx)("div",{className:"s_title",children:"담당자"}),(0,s.jsx)("input",{type:"text",name:"manager",placeholder:"담당자",className:"ty01 mt10 ".concat(r.manager?"error":""),value:i,onChange:t,maxLength:50,disabled:l,"aria-label":"담당자","aria-describedby":r.manager?"manager-error":void 0,"aria-invalid":!!r.manager}),r.manager&&(0,s.jsx)("div",{id:"manager-error",className:"error-message",role:"alert",children:r.manager})]}),(0,s.jsxs)("div",{className:"part",children:[(0,s.jsx)("div",{className:"s_title",children:"고객사"}),(0,s.jsx)("input",{type:"text",name:"consumer",placeholder:"고객사",className:"ty01 mt10 ".concat(r.consumer?"error":""),value:c,onChange:t,maxLength:50,disabled:l,"aria-label":"고객사","aria-describedby":r.consumer?"consumer-error":void 0,"aria-invalid":!!r.consumer}),r.consumer&&(0,s.jsx)("div",{id:"consumer-error",className:"error-message",role:"alert",children:r.consumer})]}),(0,s.jsxs)("div",{className:"part",children:[(0,s.jsx)("div",{className:"s_title",children:"프로젝트 세부 설명(100자)"}),(0,s.jsx)("textarea",{name:"description",className:"mt10 ".concat(r.description?"error":""),cols:30,rows:10,placeholder:"프로젝트 세부 설명",value:o,maxLength:100,onChange:t,disabled:l,"aria-label":"프로젝트 세부 설명","aria-describedby":r.description?"description-error":void 0,"aria-invalid":!!r.description}),r.description&&(0,s.jsx)("div",{id:"description-error",className:"error-message",role:"alert",children:r.description}),(0,s.jsxs)("div",{className:"char-count",children:[o.length,"/100"]})]})]})};l.displayName="ProjectInput";var n=(0,r.memo)(l),i=t(85994),c=t.n(i),o=t(65961);let d=[{key:"basic_plan",text:"기초기획안 작성"},{key:"story_board",text:"스토리보드 작성"},{key:"filming",text:"촬영 (계획/진행)"},{key:"video_edit",text:"비디오 편집"},{key:"post_work",text:"후반 작업"},{key:"video_preview",text:"비디오 시사 (피드백)"},{key:"confirmation",text:"최종 컨펌"},{key:"video_delivery",text:"영상 납품"}],m=(0,r.forwardRef)((e,a)=>{let{value:t,onClick:r,placeholder:l,disabled:n=!1}=e;return(0,s.jsx)("button",{type:"button",className:"example-custom-input ".concat(t?"":"off"," ").concat(n?"disabled":""),onClick:r,ref:a,disabled:n,"aria-label":l,children:t||l})});m.displayName="ExampleCustomInput";let u=e=>{let{process:a,set_process:t,disabled:l=!1}=e,n=(0,r.useCallback)((e,s,r)=>{var l,n,i;let c=[...a];c[e]={startDate:(null===(l=c[e])||void 0===l?void 0:l.startDate)||null,endDate:(null===(n=c[e])||void 0===n?void 0:n.endDate)||null,phase_name:(null===(i=c[e])||void 0===i?void 0:i.phase_name)||"",...c[e],[s]:r},"startDate"===s&&c[e].endDate&&r&&c[e].endDate&&r>c[e].endDate&&(c[e]={...c[e],endDate:r}),t(c)},[a,t]),i=(0,r.useCallback)((e,t)=>{var s;let r=null===(s=a[t])||void 0===s?void 0:s.startDate;return!!r&&new Date(r).setHours(0,0,0,0)<=new Date(e).setHours(0,0,0,0)},[a]),u=(0,r.useCallback)((e,t)=>{var s;let r=null===(s=a[t])||void 0===s?void 0:s.startDate;return!!r&&(new Date(r).setHours(0,0,0,0)!==new Date(e).setHours(0,0,0,0)||new Date(r)<new Date(e))},[a]);return(0,s.jsx)("ul",{className:"dataprocess",children:a.map((e,a)=>{let t=d[a]||{text:"단계 ".concat(a+1)};return(0,s.jsxs)("li",{children:[(0,s.jsx)("div",{className:"type",children:t.text}),(0,s.jsx)("div",{className:"select start",children:(0,s.jsx)(c(),{locale:o.Z,placeholderText:"시작 날짜",selected:e.startDate,onChange:e=>n(a,"startDate",e),showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:10,dateFormat:"yyyy-MM-dd HH:mm",customInput:(0,s.jsx)(m,{placeholder:"시작 날짜",disabled:l}),disabled:l,"aria-label":"".concat(t.text," 시작 날짜")})}),(0,s.jsx)("div",{className:"select end",children:(0,s.jsx)(c(),{locale:o.Z,placeholderText:"종료 날짜",selected:e.endDate,onChange:e=>n(a,"endDate",e),showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:10,dateFormat:"yyyy-MM-dd HH:mm",disabled:!e.startDate||l,filterDate:e=>i(e,a),filterTime:e=>u(e,a),customInput:(0,s.jsx)(m,{placeholder:"종료 날짜",disabled:!e.startDate||l}),"aria-label":"".concat(t.text," 종료 날짜")})})]},a)})})};u.displayName="ProcessDate";var p=(0,r.memo)(u),h=t(77398),j=t.n(h),v=t(73377),b=t(19764);let x={basic_plan:["기초기획안","작성"],story_board:["스토리보드","작성"],filming:["촬영","(계획/진행)"],video_edit:["비디오 편집"],post_work:["후반 작업"],video_preview:["비디오 시사","(피드백)"],confirmation:["최종 컨펌"],video_delivery:["영상 납품"]},y=(0,r.memo)(e=>{let{project:a,phase:t,onProjectClick:r}=e,l=a[t],n=()=>{null==r||r(a)};return(0,s.jsx)(b.o5,{children:(0,s.jsxs)("div",{className:"inner03",onClick:n,role:"button",tabIndex:0,onKeyPress:e=>{("Enter"===e.key||" "===e.key)&&n()},"aria-label":"".concat(a.name," 프로젝트"),children:[(0,s.jsx)("div",{className:"name",children:a.name}),(null==l?void 0:l.start_date)&&(null==l?void 0:l.end_date)?(0,s.jsxs)("div",{className:"day",children:[(0,s.jsx)("span",{children:j()(l.start_date).format("YYYY.MM.DD.dd")}),(0,s.jsxs)("span",{children:["~ ",j()(l.end_date).format("YYYY.MM.DD.dd")]})]}):(0,s.jsx)("span",{className:"no-date",children:"날짜를 입력해주세요."})]})})});y.displayName="ProjectSlide";let g=(0,r.memo)(e=>{let{phase:a,projects:t,onProjectClick:l}=e,n=(0,r.useMemo)(()=>{let e=new Date().setHours(0,0,0,0);return t.filter(t=>{let s=t[a];return null==s||!s.end_date||new Date(s.end_date).setHours(0,0,0,0)>=e}).sort((e,t)=>{let s=e[a],r=t[a],l=new Date((null==s?void 0:s.end_date)?s.end_date:"9999-12-31"),n=new Date((null==r?void 0:r.end_date)?r.end_date:"9999-12-31");return l.getTime()-n.getTime()})},[t,a]),i=x[a];return 0===n.length?null:(0,s.jsxs)("div",{className:"process flex space_between align_center",children:[(0,s.jsx)("div",{className:"s_title",children:i.map((e,a)=>(0,s.jsxs)(r.Fragment,{children:[e,a<i.length-1&&(0,s.jsx)("br",{})]},a))}),(0,s.jsx)(b.tq,{modules:[v.W_,v.tl,v.LW,v.s5],spaceBetween:0,slidesPerView:5,pagination:{clickable:!0},scrollbar:{draggable:!0},navigation:!0,breakpoints:{320:{slidesPerView:1},768:{slidesPerView:3},1024:{slidesPerView:4},1200:{slidesPerView:5}},className:"project-phase-swiper phase-".concat(a),children:n.map(e=>(0,s.jsx)(y,{project:e,phase:a,...l&&{onProjectClick:l}},"".concat(a,"-").concat(e.id)))})]})});g.displayName="ProjectPhase";let f=e=>{let{project_list:a,onProjectClick:t,showAllPhases:r=!0}=e;return a&&0!==a.length?(0,s.jsx)("div",{className:"list_box mt100",children:["basic_plan","story_board","filming","video_edit","post_work","video_preview","confirmation","video_delivery"].map(e=>(0,s.jsx)(g,{phase:e,projects:a,...t&&{onProjectClick:t}},e))}):(0,s.jsx)("div",{className:"list_box mt100",children:(0,s.jsx)("div",{className:"empty-state",children:(0,s.jsx)("p",{children:"표시할 프로젝트가 없습니다."})})})};f.displayName="ProjectList";var _=(0,r.memo)(f),N=t(33145),w=t(79916),k={src:"/_next/static/media/down_icon.40eeaf29.svg",height:512,width:512,blurWidth:0,blurHeight:0};let P=(0,r.memo)(e=>{let{current_project:a,isAdmin:t=!1,onEdit:l}=e,[n,i]=(0,r.useState)(!1),c=(0,r.useRef)(null),[o,d]=(0,r.useState)(0);(0,r.useEffect)(()=>{c.current&&d(c.current.scrollHeight)},[n,a]);let m=(0,r.useCallback)(()=>{i(e=>!e)},[]),u=(0,r.useCallback)(e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),m())},[m]),p=(0,r.useCallback)((e,a)=>{w.qx.downloadFile(e,a)},[]);return(0,s.jsxs)("div",{className:"info_wrap",children:[(0,s.jsxs)("div",{className:"name_box flex align_center space_between",children:[(0,s.jsxs)("div",{className:"flex align_center start",children:[(0,s.jsxs)("button",{type:"button",className:"toggle-btn ".concat(n?"on":""),onClick:m,onKeyPress:u,"aria-expanded":n,"aria-controls":"project-details","aria-label":"프로젝트 상세 정보 ".concat(n?"닫기":"열기"),children:[(0,s.jsx)("span",{className:"sr-only",children:n?"상세 정보 닫기":"상세 정보 열기"}),(0,s.jsx)("span",{className:"toggle-icon","aria-hidden":"true",children:n?"−":"+"})]}),(0,s.jsx)("h1",{className:"s_title",children:a.name})]}),(0,s.jsxs)("div",{className:"update-info",children:["최종 업데이트 날짜 |"," ",(0,s.jsx)("time",{dateTime:a.updated,children:j()(a.updated).format("YYYY.MM.DD")})]})]}),(0,s.jsx)("div",{id:"project-details",className:"box",style:{height:n?"".concat(o,"px"):"0",overflow:"hidden",transition:"height 0.3s ease-in-out"},role:"region","aria-labelledby":"project-name",children:(0,s.jsxs)("div",{ref:c,className:"inner",children:[(0,s.jsxs)("section",{className:"explanation",children:[(0,s.jsx)("div",{className:"ss_title",children:(0,s.jsx)("span",{children:"프로젝트 설명"})}),(0,s.jsx)("p",{children:a.description})]}),(0,s.jsxs)("section",{className:"member",children:[(0,s.jsx)("div",{className:"ss_title",children:(0,s.jsx)("span",{children:"멤버"})}),(0,s.jsxs)("ul",{children:[(0,s.jsxs)("li",{className:"admin",children:[(0,s.jsx)("div",{className:"img","aria-hidden":"true"}),(0,s.jsxs)("div",{className:"txt",children:[(0,s.jsx)("strong",{children:a.owner_nickname}),(0,s.jsx)("span",{className:"role",children:"(관리자)"}),(0,s.jsx)("span",{className:"email",children:a.owner_email})]})]}),a.member_list.map(e=>(0,s.jsxs)("li",{className:"manager"===e.rating?"admin":"basic",children:[(0,s.jsx)("div",{className:"img","aria-hidden":"true"}),(0,s.jsxs)("div",{className:"txt",children:[(0,s.jsx)("strong",{children:e.nickname}),(0,s.jsxs)("span",{className:"role",children:["(","manager"===e.rating?"관리자":"일반",")"]}),(0,s.jsx)("span",{className:"email",children:e.email})]})]},e.id))]})]}),(0,s.jsxs)("section",{className:"info",children:[(0,s.jsx)("div",{className:"ss_title",children:(0,s.jsx)("span",{children:"프로젝트 정보"})}),(0,s.jsxs)("dl",{className:"info-list",children:[(0,s.jsxs)("div",{className:"info-item",children:[(0,s.jsx)("dt",{children:"작업자"}),(0,s.jsx)("dd",{children:a.manager})]}),(0,s.jsxs)("div",{className:"info-item",children:[(0,s.jsx)("dt",{children:"고객사"}),(0,s.jsx)("dd",{children:a.consumer})]}),(0,s.jsxs)("div",{className:"info-item",children:[(0,s.jsxs)("dt",{children:["프로젝트",(0,s.jsx)("br",{}),"생성일"]}),(0,s.jsx)("dd",{children:(0,s.jsx)("time",{dateTime:a.created,children:j()(a.created).format("YYYY.MM.DD")})})]}),(0,s.jsxs)("div",{className:"info-item",children:[(0,s.jsx)("dt",{children:"등록 파일"}),(0,s.jsx)("dd",{children:0===a.files.length?(0,s.jsx)("span",{className:"no-files",children:"등록된 파일이 없습니다."}):(0,s.jsx)("div",{className:"files-list",children:a.files.map(e=>{let a=w.qx.extractFileName(e.file_name);return(0,s.jsxs)("button",{type:"button",className:"file-download",onClick:()=>p(e.files,a),"aria-label":"".concat(a," 다운로드"),children:[(0,s.jsx)("span",{className:"file-name",children:a}),(0,s.jsx)("i",{className:"download-icon","aria-hidden":"true",children:(0,s.jsx)(N.default,{src:k,alt:"",width:16,height:16})})]},e.id)})})})]})]})]}),t&&l&&(0,s.jsx)("div",{className:"action-buttons",children:(0,s.jsx)("button",{type:"button",className:"submit",onClick:l,"aria-label":"프로젝트 편집",children:"프로젝트 편집"})})]})})]})});P.displayName="ProjectInfo";var C=P,D=t(94242),A=t(81374);let S=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),E=(0,r.memo)(e=>{let{project_id:a,set_current_project:l,pending_list:n,disabled:i=!1}=e,[c,o]=(0,r.useState)([""]),[d,m]=(0,r.useState)({}),{fetchProject:u,inviteMember:p}=(0,A.Z0)(),h=(0,r.useCallback)((e,a)=>{let t=[...c];t[e]=a,o(t)},[c]),j=(0,r.useCallback)(()=>{o(e=>[...e,""])},[]),v=(0,r.useCallback)(e=>{if(c.length<=1)return;let a=[...c];a.splice(e,1),o(a)},[c]),b=(0,r.useCallback)(async(e,t)=>{if(!t.trim()){D.Am.error("이메일을 입력해주세요.");return}if(!S(t)){D.Am.error("올바른 이메일 형식을 입력해주세요.");return}if(n.some(e=>e.email===t)){D.Am.error("이미 초대된 이메일입니다.");return}try{m(a=>({...a,[e]:!0})),await p(a,t),h(e,""),await u(a)}catch(e){}finally{m(a=>({...a,[e]:!1}))}},[a,n,p,u,l,h]),x=(0,r.useCallback)(async e=>{if(window.confirm("초대를 취소하시겠습니까?"))try{let{cancelProjectInvitation:s}=await Promise.resolve().then(t.bind(t,79916));await s(a,e),await u(a),D.Am.success("초대가 취소되었습니다.")}catch(e){D.Am.error("초대 취소에 실패했습니다.")}},[a,u,l]),y=(0,r.useCallback)((e,a,t)=>{"Enter"===e.key&&(e.preventDefault(),b(a,t))},[b]);return(0,s.jsxs)("div",{className:"invite-input-container",children:[n.map((e,a)=>(0,s.jsxs)("div",{className:"pr mt10",children:[(0,s.jsx)("input",{type:"email",value:e.email,className:"ty01 pending",placeholder:"이메일 입력",readOnly:!0,"aria-label":"초대 대기중인 이메일: ".concat(e.email)}),(0,s.jsx)("span",{className:"pend","aria-label":"초대 상태",children:"초대됨"}),(0,s.jsx)("button",{type:"button",className:"del",onClick:()=>x(e.id),disabled:i,"aria-label":"".concat(e.email," 초대 취소"),children:"삭제"})]},"pending-".concat(e.id))),c.map((e,a)=>(0,s.jsxs)("div",{className:"pr mt10",children:[(0,s.jsx)("input",{type:"email",value:e,onChange:e=>h(a,e.target.value),onKeyPress:t=>y(t,a,e),className:"ty01",placeholder:"이메일 입력",disabled:i,"aria-label":"멤버 초대 이메일 ".concat(a+1),"aria-describedby":"email-help-".concat(a)}),(0,s.jsx)("button",{type:"button",className:"cert",onClick:()=>b(a,e),disabled:i||d[a]||!e.trim(),"aria-label":"초대 보내기",children:d[a]?"전송중...":"보내기"}),c.length>1&&(0,s.jsx)("button",{type:"button",className:"del",onClick:()=>v(a),disabled:i,"aria-label":"입력 필드 삭제",children:"삭제"}),(0,s.jsx)("div",{id:"email-help-".concat(a),className:"sr-only",children:"Enter 키를 눌러서 초대를 보낼 수 있습니다."})]},"email-".concat(a))),(0,s.jsx)("button",{type:"button",className:"add",onClick:j,disabled:i,"aria-label":"새 멤버 초대 필드 추가",children:"+ 멤버 추가"}),(0,s.jsx)("div",{className:"invite-help mt10",children:(0,s.jsx)("small",{children:"올바른 이메일 주소를 입력하고 '보내기'를 클릭하면 초대 메일이 발송됩니다."})})]})});E.displayName="InviteInput";var I=E},81374:function(e,a,t){t.d(a,{FL:function(){return d},Z0:function(){return c},b5:function(){return o},ti:function(){return m}});var s=t(2265),r=t(99376),l=t(32603),n=t(94242),i=t(79916);let c=()=>{let[e,a]=(0,s.useState)([]),[t,c]=(0,s.useState)(null),[o,d]=(0,s.useState)(!1),[m,u]=(0,s.useState)(null),p=(0,r.useRouter)(),h=(0,l.I0)(),{project_list:j}=(0,l.v9)(e=>e.ProjectStore),v=(0,s.useCallback)(async e=>{try{d(!0),u(null);let t=await i.ZP.fetchProjectList(e);a(t),h({type:"SET_PROJECT_LIST",payload:t})}catch(a){let e=i.ZP.isApiError(a)?a.message:"프로젝트 목록을 불러오는데 실패했습니다.";u(e),n.Am.error(e)}finally{d(!1)}},[h]),b=(0,s.useCallback)(async e=>{try{d(!0),u(null);let a=await i.ZP.fetchProject(e);return c(a),a}catch(a){let e=i.ZP.isApiError(a)?a.message:"프로젝트를 불러오는데 실패했습니다.";throw u(e),n.Am.error(e),a}finally{d(!1)}},[]),x=(0,s.useCallback)(async e=>{try{d(!0),u(null);let a=await i.ZP.createProject(e);return await v(),n.Am.success("프로젝트가 성공적으로 생성되었습니다."),p.push("/Calendar"),await b(a.id)}catch(a){let e=i.ZP.isApiError(a)?a.message:"프로젝트 생성에 실패했습니다.";throw u(e),n.Am.error(e),a}finally{d(!1)}},[v,b,p]),y=(0,s.useCallback)(async(e,a)=>{try{d(!0),u(null);let t=await i.ZP.updateProject(e,a);return c(t),await v(),n.Am.success("프로젝트가 성공적으로 업데이트되었습니다."),p.push("/Calendar"),t}catch(a){let e=i.ZP.isApiError(a)?a.message:"프로젝트 업데이트에 실패했습니다.";throw u(e),n.Am.error(e),a}finally{d(!1)}},[v,p]),g=(0,s.useCallback)(async e=>{if(window.confirm("프로젝트를 삭제하시겠습니까?"))try{d(!0),u(null),await i.ZP.deleteProject(e),(null==t?void 0:t.id)===Number(e)&&c(null),await v(),n.Am.success("프로젝트가 성공적으로 삭제되었습니다."),p.push("/Calendar")}catch(a){let e=i.ZP.isApiError(a)?a.message:"프로젝트 삭제에 실패했습니다.";throw u(e),n.Am.error(e),a}finally{d(!1)}},[t,v,p]),f=(0,s.useCallback)(async(e,a)=>{try{await i.ZP.inviteProjectMember(e,a),(null==t?void 0:t.id)===Number(e)&&await b(e),n.Am.success("멤버 초대가 완료되었습니다.")}catch(a){let e=i.ZP.isApiError(a)?a.message:"멤버 초대에 실패했습니다.";throw u(e),n.Am.error(e),a}},[t,b]),_=(0,s.useCallback)(async(e,a,s)=>{try{await i.ZP.updateMemberRating(e,a,s),(null==t?void 0:t.id)===Number(e)&&await b(e),n.Am.success("멤버 권한이 변경되었습니다.")}catch(a){let e=i.ZP.isApiError(a)?a.message:"멤버 권한 변경에 실패했습니다.";throw u(e),n.Am.error(e),a}},[t,b]),N=(0,s.useCallback)(async e=>{if(window.confirm("파일을 삭제하시겠습니까?"))try{await i.ZP.deleteProjectFile(e),t&&await b(t.id),n.Am.success("파일이 삭제되었습니다.")}catch(a){let e=i.ZP.isApiError(a)?a.message:"파일 삭제에 실패했습니다.";throw u(e),n.Am.error(e),a}},[t,b]),w=(0,s.useCallback)(async()=>{await v(),t&&await b(t.id)},[v,b,t]),k=(0,s.useCallback)(()=>{u(null)},[]);return(0,s.useEffect)(()=>{v()},[v]),{projects:e,currentProject:t,loading:o,error:m,fetchProjects:v,fetchProject:b,createProject:x,updateProject:y,deleteProject:g,inviteMember:f,updateMemberRating:_,deleteFile:N,refetch:w,clearError:k}},o=e=>{let a=()=>({name:(null==e?void 0:e.name)||"",description:(null==e?void 0:e.description)||"",manager:(null==e?void 0:e.manager)||"",consumer:(null==e?void 0:e.consumer)||""}),t=()=>[{startDate:null,endDate:null,phase_name:"basic_plan"},{startDate:null,endDate:null,phase_name:"story_board"},{startDate:null,endDate:null,phase_name:"filming"},{startDate:null,endDate:null,phase_name:"video_edit"},{startDate:null,endDate:null,phase_name:"post_work"},{startDate:null,endDate:null,phase_name:"video_preview"},{startDate:null,endDate:null,phase_name:"confirmation"},{startDate:null,endDate:null,phase_name:"video_delivery"}],[r,l]=(0,s.useState)(a),[o,d]=(0,s.useState)(t),[m,u]=(0,s.useState)([]),[p,h]=(0,s.useState)({isValid:!1,errors:{}}),[j,v]=(0,s.useState)(!1),{createProject:b,updateProject:x}=c(),y=(0,s.useCallback)(e=>{let{name:a,value:t}=e.target;l(e=>({...e,[a]:t})),_()},[]),g=(0,s.useCallback)(e=>{let a=Array.from(e.target.files||[]);u(e=>[...e,...a])},[]),f=(0,s.useCallback)(e=>{u(a=>a.filter((a,t)=>t!==e))},[]),_=(0,s.useCallback)(()=>{let e={};r.name.trim()?r.name.length>50&&(e.name="프로젝트 이름은 50자 이내로 입력해주세요."):e.name="프로젝트 이름을 입력해주세요.",r.description.trim()?r.description.length>100&&(e.description="프로젝트 설명은 100자 이내로 입력해주세요."):e.description="프로젝트 설명을 입력해주세요.",r.manager.trim()?r.manager.length>50&&(e.manager="담당자는 50자 이내로 입력해주세요."):e.manager="담당자를 입력해주세요.",r.consumer.trim()?r.consumer.length>50&&(e.consumer="고객사는 50자 이내로 입력해주세요."):e.consumer="고객사를 입력해주세요.";let a={isValid:0===Object.keys(e).length,errors:e};return h(a),a},[r]),N=(0,s.useCallback)(()=>{l(a()),d(t()),u([]),h({isValid:!1,errors:{}})},[]),w=(0,s.useCallback)(async(a,t)=>{if(!_().isValid){n.Am.error("입력란을 모두 채워주세요.");return}try{v(!0);let s=i.ZP.createProjectFormData(r,o,m,null==e?void 0:e.member_list);"create"===a?await b(s):"update"===a&&t&&await x(t,s),N()}catch(e){}finally{v(!1)}},[r,o,m,e,_,b,x,N]);return(0,s.useEffect)(()=>{e&&(l({name:e.name,description:e.description,manager:e.manager,consumer:e.consumer}),d(["basic_plan","story_board","filming","video_edit","post_work","video_preview","confirmation","video_delivery"].map(a=>{let t=e[a];return{startDate:(null==t?void 0:t.start_date)?new Date(t.start_date):null,endDate:(null==t?void 0:t.end_date)?new Date(t.end_date):null,phase_name:a}})))},[e]),{inputs:r,process:o,files:m,validation:p,isSubmitting:j,onChange:y,setProcess:d,onFileChange:g,onFileDelete:f,validateForm:_,resetForm:N,handleSubmit:w}},d=()=>{let[e,a]=(0,s.useState)([]),[t,r]=(0,s.useState)([]),l=(0,s.useCallback)(e=>{let t=Array.from(e.target.files||[]);a(e=>[...e,...t]);let s=t.map(e=>({file:e,status:"pending",progress:0}));r(e=>[...e,...s])},[]),n=(0,s.useCallback)(e=>{a(a=>a.filter((a,t)=>t!==e)),r(a=>a.filter((a,t)=>t!==e))},[]),c=(0,s.useCallback)(async a=>{if(0===e.length)return[];try{r(e=>e.map(e=>({...e,status:"uploading"})));let t=await i.ZP.uploadProjectFiles(a,e);return r(e=>e.map(e=>({...e,status:"completed",progress:100}))),t}catch(e){throw r(e=>e.map(e=>({...e,status:"error",error:"업로드에 실패했습니다."}))),e}},[e]);return{files:e,uploadStates:t,onFileChange:l,onFileDelete:n,uploadFiles:c,clearFiles:(0,s.useCallback)(()=>{a([]),r([])},[])}},m=e=>{let{user:a}=(0,l.v9)(e=>e.ProjectStore),t=(0,s.useCallback)(()=>!!e&&!!a&&(a===e.owner_email||e.member_list.some(e=>e.email===a&&"manager"===e.rating)),[e,a]),r=(0,s.useCallback)(()=>t(),[t]),n=(0,s.useCallback)(()=>t(),[t]),i=(0,s.useCallback)(()=>t(),[t]),c=(0,s.useCallback)(()=>t(),[t]);return{isAdmin:t(),canEdit:r(),canDelete:n(),canInvite:i(),canManageMembers:c()}}}}]);
"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[420],{24405:function(e,t,r){r.d(t,{iJ:function(){return s},sr:function(){return l}});var a=r(85763),o=r(25566);let n=o.env.NEXT_PUBLIC_BACKEND_API_URL||o.env.REACT_APP_BACKEND_API_URL,s={signIn:e=>(0,a.Fi)("post","".concat(n,"/users/login"),e),signUp:e=>(0,a.Fi)("post","".concat(n,"/users/signup"),e),sendAuthNumber:(e,t)=>(0,a.Fi)("post","".concat(n,"/users/send_authnumber/").concat(t),e),verifyEmail:(e,t)=>(0,a.Fi)("post","".concat(n,"/users/signup_emailauth/").concat(t),e),resetPassword:e=>(0,a.Fi)("post","".concat(n,"/users/password_reset"),e),refreshToken:e=>(0,a.Fi)("post","".concat(n,"/auth/token/refresh/"),{refresh:e}),signOut:e=>(0,a.Fi)("post","".concat(n,"/auth/logout/"),{refresh:e}),getUserProfile:()=>(0,a.Fi)("get","".concat(n,"/users/profile/")),updateUserProfile:e=>(0,a.Fi)("patch","".concat(n,"/users/profile/"),e),changePassword:e=>(0,a.Fi)("post","".concat(n,"/users/change-password/"),e),verifyInvitation:(e,t)=>(0,a.Fi)("get","".concat(n,"/users/verify-invitation/").concat(e,"/").concat(t,"/")),acceptInvitation:(e,t)=>(0,a.Fi)("post","".concat(n,"/users/accept-invitation/"),{uid:e,token:t}),writeUserMemo:e=>(0,a.Fi)("post","".concat(n,"/users/memo"),e),deleteUserMemo:e=>(0,a.Fi)("delete","".concat(n,"/users/memo/").concat(e)),getUserMemos:()=>(0,a.Fi)("get","".concat(n,"/users/memo")),deleteAccount:e=>(0,a.Fi)("delete","".concat(n,"/users/account/"),{password:e})},l=e=>{var t,r,a,o,n;if((null==e?void 0:null===(t=e.response)||void 0===t?void 0:t.status)===401){localStorage.removeItem("VGID"),window.location.href="/login";return}return(null==e?void 0:null===(a=e.response)||void 0===a?void 0:null===(r=a.data)||void 0===r?void 0:r.message)||(null==e?void 0:null===(n=e.response)||void 0===n?void 0:null===(o=n.data)||void 0===o?void 0:o.detail)||"알 수 없는 오류가 발생했습니다."}},91420:function(e,t,r){r.d(t,{aC:function(){return i},cU:function(){return d},lz:function(){return u}});var a=r(2265),o=r(99376),n=r(32603),s=r(24405),l=r(85763);let c={LOGIN_START:"auth/loginStart",LOGIN_SUCCESS:"auth/loginSuccess",LOGIN_FAILURE:"auth/loginFailure",LOGOUT:"auth/logout",SET_USER:"auth/setUser"},i=()=>{let e=(0,n.I0)(),t=(0,o.useRouter)(),r=(0,n.v9)(e=>e.auth||{}),[i,u]=(0,a.useState)(!1),[d,f]=(0,a.useState)(null),[p,_]=(0,a.useState)(r.user||null),[h,y]=(0,a.useState)(!1),m=(0,a.useCallback)(()=>{f(null)},[]),v=(0,a.useCallback)(()=>{try{let e=localStorage.getItem("VGID");return e?JSON.parse(e):null}catch(e){return console.error("Token parsing error:",e),null}},[]),g=(0,a.useCallback)(e=>{try{localStorage.setItem("VGID",JSON.stringify(e))}catch(e){console.error("Token storage error:",e)}},[]),w=(0,a.useCallback)(()=>{let e=(0,l.bV)();return y(!!e),!!e},[]),S=(0,a.useCallback)(async()=>{try{if(!w())return;let t=await s.iJ.getUserProfile();_(t.data),e({type:c.SET_USER,payload:t.data})}catch(t){console.error("Failed to refresh user data:",t);let e=(0,s.sr)(t);e&&f(e)}},[e,w]),I=(0,a.useCallback)(async r=>{try{u(!0),f(null),e({type:c.LOGIN_START});let a=await s.iJ.signIn(r),o=a.data.vridge_session;g(o),a.data.user&&(_(a.data.user),e({type:c.LOGIN_SUCCESS,payload:a.data.user})),y(!0),await (0,l.J_)(e,t)}catch(r){console.error("Login error:",r);let t=(0,s.sr)(r);throw f(t||"로그인에 실패했습니다."),e({type:c.LOGIN_FAILURE,payload:t}),r}finally{u(!1)}},[e,t,g]),C=(0,a.useCallback)(async()=>{try{u(!0);let r=v();if(null==r?void 0:r.refresh)try{await s.iJ.signOut(r.refresh)}catch(e){console.warn("Logout API call failed:",e)}localStorage.removeItem("VGID"),_(null),y(!1),f(null),e({type:c.LOGOUT}),t.push("/login")}catch(e){console.error("Logout error:",e),f("로그아웃 중 오류가 발생했습니다.")}finally{u(!1)}},[e,t,v]),E=(0,a.useCallback)(async t=>{try{u(!0),f(null);let r=await s.iJ.signUp(t);r.data.vridge_session&&(g(r.data.vridge_session),_(r.data.user),y(!0),e({type:c.LOGIN_SUCCESS,payload:r.data.user}))}catch(e){throw console.error("Signup error:",e),f((0,s.sr)(e)||"회원가입에 실패했습니다."),e}finally{u(!1)}},[e,g]),P=(0,a.useCallback)(async t=>{try{u(!0),f(null);let r=await s.iJ.updateUserProfile(t);_(r.data),e({type:c.SET_USER,payload:r.data})}catch(e){throw console.error("Profile update error:",e),f((0,s.sr)(e)||"프로필 업데이트에 실패했습니다."),e}finally{u(!1)}},[e]),A=(0,a.useCallback)(async e=>{try{u(!0),f(null),await s.iJ.changePassword(e)}catch(e){throw console.error("Password change error:",e),f((0,s.sr)(e)||"비밀번호 변경에 실패했습니다."),e}finally{u(!1)}},[]);return(0,a.useEffect)(()=>{(async()=>{if(w())try{await S()}catch(e){console.warn("Failed to load user data on init:",e),localStorage.removeItem("VGID"),y(!1)}})()},[w,S]),{user:p,isAuthenticated:h,loading:i,error:d,login:I,logout:C,signup:E,updateProfile:P,changePassword:A,clearError:m,checkAuthStatus:w,refreshUserData:S}},u=()=>{let[e,t]=(0,a.useState)(!1),[r,o]=(0,a.useState)(null);return{loading:e,error:r,verifyInvitation:(0,a.useCallback)(async e=>{try{return t(!0),o(null),(await s.iJ.verifyInvitation(e.uid,e.token)).data}catch(e){throw console.error("Invitation verification error:",e),o((0,s.sr)(e)||"초대 링크 확인에 실패했습니다."),e}finally{t(!1)}},[]),acceptInvitation:(0,a.useCallback)(async e=>{try{return t(!0),o(null),(await s.iJ.acceptInvitation(e.uid,e.token)).data}catch(e){throw console.error("Invitation acceptance error:",e),o((0,s.sr)(e)||"초대 수락에 실패했습니다."),e}finally{t(!1)}},[]),clearError:()=>o(null)}},d=()=>{let[e,t]=(0,a.useState)(!1),[r,o]=(0,a.useState)(null);return{loading:e,error:r,sendResetEmail:(0,a.useCallback)(async e=>{try{t(!0),o(null),await s.iJ.sendAuthNumber({email:e},"password_reset")}catch(e){throw console.error("Password reset email error:",e),o((0,s.sr)(e)||"비밀번호 재설정 이메일 전송에 실패했습니다."),e}finally{t(!1)}},[]),verifyResetCode:(0,a.useCallback)(async(e,r)=>{try{t(!0),o(null),await s.iJ.verifyEmail({email:e,auth_number:r},"password_reset")}catch(e){throw console.error("Password reset verification error:",e),o((0,s.sr)(e)||"인증번호 확인에 실패했습니다."),e}finally{t(!1)}},[]),resetPassword:(0,a.useCallback)(async e=>{try{t(!0),o(null),await s.iJ.resetPassword(e)}catch(e){throw console.error("Password reset error:",e),o((0,s.sr)(e)||"비밀번호 재설정에 실패했습니다."),e}finally{t(!1)}},[]),clearError:()=>o(null)}}},86631:function(e,t,r){r.d(t,{$s:function(){return s},CH:function(){return c},E0:function(){return l},l2:function(){return n}});var a=r(85763),o=r(25566);function n(){return(0,a.Fi)("get","".concat(o.env.REACT_APP_BACKEND_API_URL,"/projects/project_list"))}function s(e,t){return(0,a.Fi)("post","".concat(o.env.REACT_APP_BACKEND_API_URL,"/projects/memo/").concat(t),e)}function l(e,t){return(0,a.Fi)("delete","".concat(o.env.REACT_APP_BACKEND_API_URL,"/projects/memo/").concat(t),e)}function c(e,t){return(0,a.Fi)("post","".concat(o.env.REACT_APP_BACKEND_API_URL,"/projects/date_update/").concat(t),e)}},85763:function(e,t,r){r.d(t,{Fi:function(){return f},bV:function(){return p},J_:function(){return _}});var a=r(83464),o=r(61511);let n={user:null,nickname:null,sample_files:[],project_list:[],this_month_project:[],next_month_project:[]},s=(0,o.oM)({name:"project",initialState:n,reducers:{updateProjectStore:(e,t)=>e={...e,...t.payload},resetProjectStore:(e,t)=>n}}),{updateProjectStore:l,resetProjectStore:c}=s.actions;s.reducer;var i=r(86631),u=r(77398),d=r.n(u);function f(e,t,r,o){return(0,a.Z)({method:e,url:t,data:r,withCredentials:!0,timeout:3e4,crossDomain:!0,...o})}function p(){let e=window.localStorage.getItem("VGID");return e&&(e=JSON.parse(e)),e}function _(e,t){if(p()){let r=new Date;(0,i.l2)().then(t=>{let a=t.data.result.sort((e,t)=>new Date(t.created)-new Date(e.created)),o=r.getMonth()+1,n=a.filter((e,t)=>d()(e.first_date).format("M")==o||d()(e.end_date).format("M")==o),s=a.filter((e,t)=>d()(e.first_date).format("M")==o+1||d()(e.end_date).format("M")==o+1);e(l({user:t.data.user,nickname:t.data.nickname,sample_files:t.data.sample_files,project_list:a,this_month_project:n,next_month_project:s,user_memos:t.data.user_memos}))}).catch(e=>{console.log(e),e.response&&e.response.data&&"NEED_ACCESS_TOKEN"===e.response.data.message&&(window.localStorage.removeItem("VGID"),t.push("/login"))})}}r(43819)}}]);